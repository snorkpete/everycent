"use strict";(self.webpackChunkeverycent=self.webpackChunkeverycent||[]).push([[688],{44688:function(t,n,e){e.r(n),e.d(n,{TransactionsModule:function(){return pn}});var a=e(10232),i=e(32833),o=e(37716);let r=(()=>{class t{constructor(){}convertToTransactions(t,n,e){let a=this.convertInputToLines(t),i=a.length/3,o=[];for(let r=0;r<i;r++){let t,i=a[3*r+0],c=a[3*r+1],s=this.extractAmount(a[3*r+2]),u={transaction_date:this.extractDate(c),description:i.trim(),withdrawal_amount:s<0?-1*s:0,deposit_amount:s>0?s:0,status:"unpaid"};t=u.transaction_date instanceof Date?u.transaction_date:new Date(u.transaction_date),u.transaction_date>=n&&u.transaction_date<=e&&o.push(u)}return o}convertInputToLines(t){if(!t)return[];let n=t.trim().split(/[\n]/),e=[];for(let a=0;a<n.length;a++){let t=n[a].match(/(\d+ [A-z]{3})(\u20ac.*(Credit|Debit))/);if(t){let[n,a,i]=t;e.push(`${a} | 12:00`,i)}else e.push(n[a])}return e.filter(t=>""!==t.trim()&&"Reserved"!==t.trim()&&"Extra Card"!==t.trim())}currentDate(){return new Date}extractDate(t){let n=this.currentDate().getFullYear(),e=t.match(/(\d+) ([A-z]{3}) | .+/),[a,i,o]=e;const r=i.padStart(2,"0");return`${n}-${{Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"}[o]}-${r}`}extractAmount(t){let n=t.match(/\u20ac(.*)(Credit|Debit)/),[e,a,i]=n,o=Math.floor(100*Number(a.replace(".","").replace(",",".")));return"Credit"===i?o:-1*o}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})(),c=(()=>{class t{constructor(){}convertToTransactions(t,n,e){let a,i,o,r,c=new Date(n),s=new Date(e),u=[],l="";return this._convertInputToLines(t).forEach(t=>{if(this.isDate(t))i=this.extractDate(t);else{if(this.isNumber(t)){let n=this.extractNumberParts(t);"+"===n.sign?(r=n.amount,o=0):(r=0,o=n.amount)}else"NL"!==t.substr(0,2)&&(l+=t);this.isEndOfTransaction(t)&&(a={transaction_date:i,description:l,withdrawal_amount:o,deposit_amount:r,status:"unpaid"},(a.transaction_date<c||a.transaction_date>s)&&(a.deleted=!0),0===a.withdrawal_amount&&0===a.deposit_amount&&(a.deleted=!0),a.transaction_date=a.transaction_date.toISOString().substr(0,10),u.push(a),l="",o=0,r=0)}}),u}_convertInputToLines(t){return t?t.split(/[\n]/):[]}isDate(t){return!!t&&(t.match(/(\d\d?) ([A-z]{3}) `(\d\d)/)||this.isNewDateFormat(t))}isNewDateFormat(t){return t.match(/^(\d{2})\-(\d{2})\-(\d{4})/)}extractDate(t){if(!this.isDate(t))return;let n=this.isNewDateFormat(t);return n?new Date(`${n[3]}-${n[2]}-${n[1]}`):new Date(t.replace(/`/g,""))}isNumber(t){let n=t.trim().substr(0,1);return"-"===n||"+"===n||"\u20ac"===n}extractNumberParts(t){"\u20ac"===t.substr(0,1)&&(t=t.substr(1));let n=t.trim().substr(0,1),e=t.substring(1).trim().replace(/\./g,"").replace(/,/g,".");return{sign:n,amount:100*Number(e)}}isEndOfTransaction(t){return this.isNumber(t)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})(),s=(()=>{class t{constructor(t,n){this.creditCardImporter=t,this.oldImporter=n}convertFromCreditCardFormat(t,n,e){return this.creditCardImporter.convertToTransactions(t,n,e)}convertFromOldBankFormat(t,n,e){return this.oldImporter.convertToTransactions(t,n,e)}convertFromBankFormat(t,n,e){let a,i,o,r,c=new Date(n),s=new Date(e),u=[],l="";return this._convertInputToLines(t).forEach(t=>{if(!this.isBlank(t)){if(this.isDate(t))return void(i=this.extractDate(t));if(this.isNumber(t)){let n=this.extractAmount(t);return void(n<0?(o=Math.abs(n),r=0):(o=0,r=n))}this.isDescription(t)&&(l=t),this.isEndOfTransaction(t)&&(a={transaction_date:i,description:l,withdrawal_amount:o,deposit_amount:r,status:"paid"},(a.transaction_date<c||a.transaction_date>s)&&(a.deleted=!0),0===a.withdrawal_amount&&0===a.deposit_amount&&(a.deleted=!0),a.transaction_date&&a.transaction_date.toISOString&&(a.transaction_date=a.transaction_date.toISOString().substr(0,10)),u.push(a),l="",o=0,r=0)}}),u}_convertInputToLines(t){return t?t.split(/[\n]/):[]}isDate(t){return!!t&&("today"===t||"yesterday"===t||this.isFormattedDate(t))}isFormattedDate(t){const n={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11};let e=t.match(/^(\d{1,2}) ([A-z]+) (\d{4})/);return e?{day:e[1],month:n[e[2]],year:e[3]}:(e=t.match(/^([A-z]+) (\d{1,2}), (\d{4})/),!!e&&{month:n[e[1]],day:e[2],year:e[3]})}currentDate(){return new Date}extractDate(t,n=this.currentDate()){if(!this.isDate(t))return;if("today"===t)return n;if("yesterday"===t){let t=new Date(n.valueOf());return t.setDate(t.getDate()-1),t}let e=this.isFormattedDate(t);return new Date(e.year,e.month,e.day,10)}isAmount(t){return!this.isDate(t)&&t.trim().replace(/\./g,"").match(/\u20ac([+-]) (\d*,?\d*)/)}extractAmount(t){let n=this.isAmount(t);if(!n)return 0;let[e,a,i]=n,o=Number(i.replace(/,/g,"."));return o=Math.round(100*o),"-"===a?-1*o:o}isBlank(t){return!t||""===t.trim()}isDescription(t){return!this.isBlank(t)&&!this.isDate(t)&&!this.isAmount(t)}isNumber(t){let n=t.trim().substr(0,1);return"-"===n||"+"===n||"\u20ac"===n}isEndOfTransaction(t){return this.isDescription(t)}}return t.\u0275fac=function(n){return new(n||t)(o.LFG(r),o.LFG(c))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})(),u=(()=>{class t{constructor(){}convertFromCreditCardFormat(t,n,e){throw new Error("not implemented yet")}convertFromBankFormat(t,n,e){return this._convertInputToLines(t).map(t=>this._convertFCBankLineDataToTransaction(t,n,e))}_convertInputToLines(t){return t?t.split(/[\n]/):[]}_convertFCBankLineDataToTransaction(t,n,e){let a={},i=t.split("\t");a.transaction_date=new Date(i[0]),a.description=i[1];let o=i[3];a.withdrawal_amount=this.extractNumberFromDollarString(i[2]),a.deposit_amount=this.extractNumberFromDollarString(o);let r=new Date(n),c=new Date(e);return(a.transaction_date<r||a.transaction_date>c)&&(a.deleted=!0),0===a.withdrawal_amount&&0===a.deposit_amount&&(a.deleted=!0),a}extractNumberFromDollarString(t){if(!t)return 0;let n=t.replace(/\$/g,"");return 100*Number(n.replace(/,/g,""))}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})(),l=(()=>{class t{constructor(){}convertToTransactions(t,n,e,a){return this._convertFromNewTransactionFormat(t,n,e,a)}_convertFromNewTransactionFormat(t,n,e,a){let i=this._convertInputToLines(t),o=this._convertLinesToTransactionData(i);return this._convertTransactionArrayDataToTransactions(o,n,e,a)}_convertInputToLines(t){return t?t.split(/[\n]/):[]}_convertLinesToTransactionData(t){if(t===[])return[];let n=[],e=0,a=[];return t.forEach(t=>{a.push(t),e++,e>=4&&(n.push(a),a=[],e=0)}),n}_convertTransactionArrayDataToTransactions(t,n,e,a){return t.map(t=>this._convertTransactionArrayToTransaction(t,n,e,a))}_convertTransactionArrayToTransaction(t,n,e,a){if(4!==t.length)return{};let i=t[0],o=t[2],r=t[3],c=t[1].match(/^(\d{4})\s+(.*)$/),s="",u="";3!==c.length?(s="",u=""):(s=c[1],u=c[2]);let l=r.match(/^\s*(-?)\$(.*?)\sTTD/),d="",m="";3!==l.length?(d="",m="0"):(d=l[1],m=l[2]);let h={};h.transaction_date=new Date(i+" "+s),h.description=u+" "+o;let g=Number(m.replace(/,/g,""));if(""===d?(h.deposit_amount=100*g,h.withdrawal_amount=0):(h.deposit_amount=0,h.withdrawal_amount=100*g),"credit-card"===a){let t=h.withdrawal_amount;h.withdrawal_amount=h.deposit_amount,h.deposit_amount=t}let p=new Date(n),f=new Date(e);return(h.transaction_date<p||h.transaction_date>f)&&(h.deleted=!0),0===h.withdrawal_amount&&0===h.deposit_amount&&(h.deleted=!0),h}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})(),d=(()=>{class t{constructor(){}convertFromBankFormat(t,n,e){return this._convertInputToLines(t).map(t=>this.convertLineToTransaction(t,n,e))}_convertInputToLines(t){return t?t.trim().split(/[\n]/):[]}convertLineToTransaction(t,n,e){if(!t)return{};let a=t.trim().split(/[\t]/),i={withdrawal_amount:0,deposit_amount:0,status:"paid"},[o,r,c,s,u,l,d]=a;i.transaction_date=this.extractDate(r),i.description=s;let m=this.extractAmount(d);m<0?i.withdrawal_amount=-1*m:m>0&&(i.deposit_amount=m);let h=new Date(n),g=new Date(e);return(i.transaction_date<h||i.transaction_date>g)&&(i.deleted=!0),0===i.withdrawal_amount&&0===i.deposit_amount&&(i.deleted=!0),i.transaction_date&&i.transaction_date.toISOString&&(i.transaction_date=i.transaction_date.toISOString().substr(0,10)),i}extractDate(t){if(!t)return;let n=t.match(/(\d\d?)-(\d\d)-(\d\d\d\d)/);if(!n)return;let[e,a,i,o]=n;return new Date(Number(o),Number(i)-1,Number(a),10)}extractAmount(t){return 100*Number(t)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),m=(()=>{class t{constructor(t,n,e,a){this.fcbImporter=t,this.abnAmroImporter=n,this.scotiaImporter=e,this.republicImporter=a}convertToTransactions(t,n,e,a){return"fc-bank"===a?this.fcbImporter.convertFromBankFormat(t,n,e):"fc-creditcard"===a?this.fcbImporter.convertFromCreditCardFormat(t,n,e):"abn-amro-bank"===a?this.abnAmroImporter.convertFromBankFormat(t,n,e):"abn-amro-bank-old"===a?this.abnAmroImporter.convertFromOldBankFormat(t,n,e):"abn-amro-creditcard"===a?this.abnAmroImporter.convertFromCreditCardFormat(t,n,e):"republic-bank"===a?this.republicImporter.convertFromBankFormat(t,n,e):this.scotiaImporter.convertToTransactions(t,n,e,a)}}return t.\u0275fac=function(n){return new(n||t)(o.LFG(u),o.LFG(s),o.LFG(l),o.LFG(d))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})(),h=[m,u,l,s,c,r],g=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({providers:[...h],imports:[[i.m]]}),t})();var p=e(79765),f=e(9112),b=e(88002),_=e(87519),A=e(43190),T=e(75572);let Z=(()=>{class t{constructor(t){this.apiGateway=t}getTransactions(t={}){let n=Object.assign({no_bank_account:!0},t);return delete n.budget,delete n.bankAccount,this.apiGateway.get("/transactions",n)}save(t,n,e){let a=this.extractValidTransactionsInBudget(t,e);return this.apiGateway.post("/transactions",{bank_account_id:n.id,budget_id:e.id,transactions:a})}extractValidTransactionsInBudget(t,n){let e=new Date(n.start_date),a=new Date(n.end_date);return t.filter(t=>{let n;return n="string"==typeof t.transaction_date?new Date(t.transaction_date):t.transaction_date,!t.deleted&&n>=e&&n<=a})}}return t.\u0275fac=function(n){return new(n||t)(o.LFG(T.i))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})();var v=e(44900),w=e(6497);let k=(()=>{class t{constructor(t,n,e){this.transactionService=t,this.budgetService=n,this.bankAccountService=e,this.searchParamsSubject=new p.xQ}init(){this.searchParamsSubject=new p.xQ}searchParams$(){return this.searchParamsSubject.asObservable()}budgetId$(){return this.searchParams$().pipe((0,b.U)(t=>t.budget_id))}bankAccountId$(){return this.searchParams$().pipe((0,b.U)(t=>t.bank_account_id))}distinctBankAccountId$(){return this.bankAccountId$().pipe((0,_.x)())}distinctBudgetId$(){return this.budgetId$().pipe((0,_.x)())}transactions$(){return this.searchParams$().pipe((0,A.w)(t=>this.transactionService.getTransactions(t)))}allocations$(){return this.budgetId$().pipe((0,A.w)(t=>this.budgetService.getAllocations(t)))}sinkFundAllocation$(){return this.distinctBankAccountId$().pipe((0,A.w)(t=>this.bankAccountService.getSinkFundAllocations(t)))}refresh(t){this.searchParamsSubject.next(t)}allData$(){return(0,f.aj)(this.transactions$(),this.allocations$(),this.sinkFundAllocation$())}destroy(){this.searchParamsSubject.complete()}}return t.\u0275fac=function(n){return new(n||t)(o.LFG(Z),o.LFG(v.t),o.LFG(w.A))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})();var x=e(54655),M=e(46782),y=e(22238),C=e(35618),F=e(3679),D=e(98295),B=e(67441),q=e(38583),N=e(51095),J=e(72458);function I(t,n){if(1&t&&(o.TgZ(0,"mat-option",7),o._uU(1),o.qZA()),2&t){const t=n.$implicit;o.Q6J("value",t.value),o.xp6(1),o.Oqu(t.text)}}let O=(()=>{class t{constructor(t,n){this.importerService=t,this.dialogRef=n,this.options=[{text:"ABN Amro Bank Account",value:"abn-amro-bank"},{text:"ABN Amro Bank Account (old format)",value:"abn-amro-bank-old"},{text:"ABN Amro Credit Card",value:"abn-amro-creditcard"},{text:"Scotia Bank Account",value:"new-bank-account"},{text:"FCB Bank Account",value:"fc-bank"},{text:"FCB Credit Card (not implemented)",value:"fc-creditcard"},{text:"Republic Bank Account",value:"republic-bank"},{text:"Republic Credit Card (not implemented)",value:"republic-creditcard"}],this.importType="abn-amro-bank",this.import=new o.vpe}ngOnInit(){}importTransactions(){let t=this.importerService.convertToTransactions(this.input,this.startDate,this.endDate,this.importType);this.import.emit(t),this.dialogRef.close(t)}}return t.\u0275fac=function(n){return new(n||t)(o.Y36(m),o.Y36(y.so))},t.\u0275cmp=o.Xpm({type:t,selectors:[["ec-transaction-importer"]],inputs:{startDate:"startDate",endDate:"endDate",importType:"importType"},outputs:{import:"import"},decls:14,vars:3,consts:[["mat-dialog-title",""],["fxLayout","column","fxFlex",""],["rows","5","cols","10","placeholder","Copy the transactions from your bank here",3,"ngModel","ngModelChange"],["placeholder","Import Format",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"click"],["mat-raised-button","","mat-dialog-close",""],[3,"value"]],template:function(t,n){1&t&&(o.TgZ(0,"h1",0),o._uU(1,"Import Transactions"),o.qZA(),o.TgZ(2,"mat-dialog-content"),o.TgZ(3,"div",1),o.TgZ(4,"textarea",2),o.NdJ("ngModelChange",function(t){return n.input=t}),o._uU(5,"        "),o.qZA(),o.TgZ(6,"mat-form-field"),o.TgZ(7,"mat-select",3),o.NdJ("ngModelChange",function(t){return n.importType=t}),o.YNc(8,I,2,2,"mat-option",4),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(9,"mat-dialog-actions"),o.TgZ(10,"button",5),o.NdJ("click",function(){return n.importTransactions()}),o._uU(11," Import "),o.qZA(),o.TgZ(12,"button",6),o._uU(13,"Cancel"),o.qZA(),o.qZA()),2&t&&(o.xp6(4),o.Q6J("ngModel",n.input),o.xp6(3),o.Q6J("ngModel",n.importType),o.xp6(1),o.Q6J("ngForOf",n.options))},directives:[y.uh,y.xY,C.xw,C.yH,F.Fj,F.JJ,F.On,D.KE,B.gD,q.sg,y.H8,N.lW,y.ZT,J.ey],encapsulation:2}),t})();var Q=e(32789),S=e(65072),Y=e(93738),U=e(56326),L=e(7539),$=e(21637),E=e(93977),P=e(78759),H=e(76786),G=e(57576);function j(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"mat-checkbox",2),o.NdJ("change",function(n){return o.CHM(t),o.oxw().updateInnerValue(n)}),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("formControl",t.control)}}function R(t,n){if(1&t&&(o.TgZ(0,"span",3),o._uU(1),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.Oqu(t.paidStatusDisplay)}}let z=(()=>{class t{constructor(){this.editMode=!1,this.control=new F.NI(!1),this.onChange=t=>{},this.onTouch=()=>{}}get paidStatusDisplay(){return"paid"===this.innerValue?"Yes":"unpaid"===this.innerValue?"No":"Unknown"}get value(){return this.innerValue}set value(t){this.innerValue=t,this.control.setValue("paid"===this.value)}ngOnInit(){}updateInnerValue(t){this.innerValue=t.checked?"paid":"unpaid",this.onChange(this.innerValue)}writeValue(t){this.value=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouch=t}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["ec-paid-field"]],inputs:{editMode:"editMode",innerValue:"innerValue"},features:[o._Bn([{provide:F.JU,multi:!0,useExisting:(0,o.Gpc)(()=>t)}])],decls:3,vars:2,consts:[["color","primary",3,"formControl","change",4,"ngIf","ngIfElse"],["textDisplay",""],["color","primary",3,"formControl","change"],[1,"value"]],template:function(t,n){if(1&t&&(o.YNc(0,j,1,1,"mat-checkbox",0),o.YNc(1,R,2,1,"ng-template",null,1,o.W1O)),2&t){const t=o.MAs(2);o.Q6J("ngIf",n.editMode)("ngIfElse",t)}},directives:[q.O5,L.oG,F.JJ,F.oH],encapsulation:2}),t})();var V=e(27333),W=e(15552);function X(t,n){1&t&&o._UZ(0,"th",26)}function K(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"td",27),o._uU(1),o.TgZ(2,"mat-checkbox",28),o.NdJ("ngModelChange",function(n){return o.CHM(t).$implicit.selected=n}),o.qZA(),o.qZA()}if(2&t){const t=n.$implicit;o.xp6(1),o.hij(" ",t.item," "),o.xp6(1),o.Q6J("ngModel",t.selected)}}function tt(t,n){1&t&&o._UZ(0,"td",29)}function nt(t,n){1&t&&(o.TgZ(0,"th",30),o._uU(1,"Date"),o.qZA())}function et(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"td",31),o.TgZ(1,"ec-date-field",32),o.NdJ("ngModelChange",function(n){return o.CHM(t).$implicit.transaction_date=n}),o.qZA(),o.qZA()}if(2&t){const t=n.$implicit,e=o.oxw();o.xp6(1),o.Q6J("editMode",e.isEditMode)("ngModel",t.transaction_date)("ecValidateWithinBudget",e.budget)("errorMessage","test")}}function at(t,n){1&t&&o._UZ(0,"td",29)}function it(t,n){1&t&&(o.TgZ(0,"th",33),o._uU(1," Description "),o.qZA())}function ot(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"td",27),o.TgZ(1,"ec-text-field",34),o.NdJ("ngModelChange",function(n){return o.CHM(t).$implicit.description=n}),o.qZA(),o.qZA()}if(2&t){const t=n.$implicit,e=o.oxw();o.xp6(1),o.Q6J("editMode",e.isEditMode)("ngModel",t.description)}}function rt(t,n){1&t&&(o.TgZ(0,"td",29),o._uU(1,"Total"),o.qZA())}function ct(t,n){if(1&t&&(o.TgZ(0,"th",35),o._uU(1),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.hij(" ",t.allocationHeaderName()," ")}}function st(t,n){1&t&&o.GkF(0)}function ut(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"ec-list-field",39),o.NdJ("ngModelChange",function(n){return o.CHM(t),o.oxw().$implicit.sink_fund_allocation_id=n}),o.qZA()}if(2&t){const t=o.oxw().$implicit,n=o.oxw();o.Q6J("editMode",n.isEditMode)("items",n.sinkFundAllocations)("ngModel",t.sink_fund_allocation_id)}}function lt(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"ec-list-field",40),o.NdJ("change",function(){o.CHM(t);const n=o.oxw().$implicit;return o.oxw().updatePaidStatus(n)})("ngModelChange",function(n){return o.CHM(t),o.oxw().$implicit.allocation_id=n}),o.qZA()}if(2&t){const t=o.oxw().$implicit,n=o.oxw();o.Q6J("editMode",n.isEditMode)("items",n.allocations)("ngModel",t.allocation_id)}}function dt(t,n){if(1&t&&(o.TgZ(0,"td",27),o.YNc(1,st,1,0,"ng-container",36),o.YNc(2,ut,1,3,"ng-template",null,37,o.W1O),o.YNc(4,lt,1,3,"ng-template",null,38,o.W1O),o.qZA()),2&t){const t=o.MAs(3),n=o.MAs(5),e=o.oxw();o.xp6(1),o.Q6J("ngIf",null==e.bankAccount?null:e.bankAccount.is_sink_fund)("ngIfThen",t)("ngIfElse",n)}}function mt(t,n){1&t&&(o.TgZ(0,"td",29),o._uU(1,"Allocation"),o.qZA())}function ht(t,n){1&t&&(o.TgZ(0,"th",41),o._uU(1," Withdrawn "),o.qZA())}function gt(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"td",42),o.TgZ(1,"ec-money-field",34),o.NdJ("ngModelChange",function(n){return o.CHM(t).$implicit.withdrawal_amount=n}),o.qZA(),o.qZA()}if(2&t){const t=n.$implicit,e=o.oxw();o.xp6(1),o.Q6J("editMode",e.isEditMode)("ngModel",t.withdrawal_amount)}}function pt(t,n){1&t&&o._UZ(0,"td",29)}function ft(t,n){1&t&&(o.TgZ(0,"th",41),o._uU(1," Deposited "),o.qZA())}function bt(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"td",42),o.TgZ(1,"ec-money-field",34),o.NdJ("ngModelChange",function(n){return o.CHM(t).$implicit.deposit_amount=n}),o.qZA(),o.qZA()}if(2&t){const t=n.$implicit,e=o.oxw();o.xp6(1),o.Q6J("editMode",e.isEditMode)("ngModel",t.deposit_amount)}}function _t(t,n){1&t&&o._UZ(0,"td",29)}function At(t,n){1&t&&(o.TgZ(0,"th",26),o._uU(1,"Paid?"),o.qZA())}function Tt(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"td",43),o.TgZ(1,"ec-paid-field",34),o.NdJ("ngModelChange",function(n){return o.CHM(t).$implicit.status=n}),o.qZA(),o.qZA()}if(2&t){const t=n.$implicit,e=o.oxw();o.xp6(1),o.Q6J("editMode",e.isEditMode)("ngModel",t.status)}}function Zt(t,n){1&t&&o._UZ(0,"td",29)}function vt(t,n){1&t&&(o.TgZ(0,"th",26),o._uU(1," Action "),o.qZA())}function wt(t,n){if(1&t&&(o.TgZ(0,"td",43),o._UZ(1,"ec-delete-button",44),o.qZA()),2&t){const t=n.$implicit,e=o.oxw();o.xp6(1),o.Q6J("editMode",e.isEditMode)("item",t)}}function kt(t,n){1&t&&o._UZ(0,"td",29)}function xt(t,n){1&t&&o._UZ(0,"tr",45)}function Mt(t,n){1&t&&o._UZ(0,"tr",46),2&t&&o.Q6J("ecHighlightDeletedFor",n.$implicit)}function yt(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"button",47),o.NdJ("click",function(){return o.CHM(t),o.oxw().addTransaction()}),o._uU(1," Add New Transaction "),o.qZA()}}function Ct(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"button",48),o.NdJ("click",function(){return o.CHM(t),o.oxw().import.emit()}),o._uU(1," Import Transactions "),o.qZA()}}function Ft(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"button",49),o.NdJ("click",function(){return o.CHM(t),o.oxw().transfer.emit()}),o._uU(1," Transfer "),o.qZA()}}let Dt=(()=>{class t{constructor(t){this.transactions=[],this.allocations=[],this.sinkFundAllocations=[],this.isEditMode=!1,this.save=new o.vpe,this.transfer=new o.vpe,this.import=new o.vpe,this.cancel=new o.vpe,this.DESKTOP_COLUMNS=["selection","date","description","allocation","withdrawn","deposit","paid","action"],this.MOBILE_COLUMNS=["date","description","allocation","withdrawn","deposit","action"],this.displayedColumns=[],this._mobileQueryListener=t=>{this.displayedColumns=t.matches?this.MOBILE_COLUMNS:this.DESKTOP_COLUMNS},this.mobileQuery=t.matchMedia("(max-width: 600px)"),this.mobileQuery.addListener(this._mobileQueryListener)}ngOnInit(){this._mobileQueryListener(this.mobileQuery)}addTransaction(){this.transactions.push({withdrawal_amount:0,deposit_amount:0,status:this.bankAccount.is_credit_card?"unpaid":"paid"}),this.transactionList.renderRows()}allocationHeaderName(){return this.bankAccount&&this.bankAccount.is_sink_fund?"Sink Fund Allocation":"Allocation"}trackByFn(t,n){return n.id}switchToDisplayMode(){this.isEditMode=!1}linkToBudget(){return this.budget?`/budgets/${this.budget.id}`:"/budgets"}updatePaidStatus(t){t.status=t.allocation_id>0?"paid":"unpaid"}ngOnDestroy(){this.mobileQuery.removeListener(this._mobileQueryListener)}}return t.\u0275fac=function(n){return new(n||t)(o.Y36(S.vx))},t.\u0275cmp=o.Xpm({type:t,selectors:[["ec-transaction-list"]],viewQuery:function(t,n){if(1&t&&o.Gf(Q.BZ,7),2&t){let t;o.iGM(t=o.CRH())&&(n.transactionList=t.first)}},inputs:{transactions:"transactions",allocations:"allocations",sinkFundAllocations:"sinkFundAllocations",bankAccount:"bankAccount",budget:"budget",isEditMode:"isEditMode"},outputs:{save:"save",transfer:"transfer",import:"import",cancel:"cancel"},decls:43,vars:9,consts:[[1,"table-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource","trackBy"],["matColumnDef","selection"],["mat-header-cell","","style","width:5%;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","style","width:15%;",4,"matCellDef"],["matColumnDef","description"],["mat-header-cell","","style","width:30%;",4,"matHeaderCellDef"],["matColumnDef","allocation"],["mat-header-cell","","style","width:20%;",4,"matHeaderCellDef"],["matColumnDef","withdrawn"],["mat-header-cell","","style","width:10%;","class","right",4,"matHeaderCellDef"],["mat-cell","","class","right",4,"matCellDef"],["matColumnDef","deposit"],["matColumnDef","paid"],["mat-cell","","class","center",4,"matCellDef"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"ecHighlightDeletedFor",4,"matRowDef","matRowDefColumns"],[3,"editMode","editModeChange","save","cancel"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","class","transfer","color","accent",3,"click",4,"ngIf"],["mat-header-cell","",2,"width","5%"],["mat-cell",""],["color","primary",3,"ngModel","ngModelChange"],["mat-footer-cell",""],["mat-header-cell",""],["mat-cell","",2,"width","15%"],[3,"editMode","ngModel","ecValidateWithinBudget","errorMessage","ngModelChange"],["mat-header-cell","",2,"width","30%"],[3,"editMode","ngModel","ngModelChange"],["mat-header-cell","",2,"width","20%"],[4,"ngIf","ngIfThen","ngIfElse"],["sinkFundAllocationField",""],["allocationField",""],[3,"editMode","items","ngModel","ngModelChange"],["groupBy","allocation_category",3,"editMode","items","ngModel","change","ngModelChange"],["mat-header-cell","",1,"right",2,"width","10%"],["mat-cell","",1,"right"],["mat-cell","",1,"center"],[3,"editMode","item"],["mat-header-row",""],["mat-row","",3,"ecHighlightDeletedFor"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","accent",1,"transfer",3,"click"]],template:function(t,n){1&t&&(o.TgZ(0,"mat-card"),o.TgZ(1,"mat-card-content"),o.TgZ(2,"div",0),o.TgZ(3,"table",1),o.ynx(4,2),o.YNc(5,X,1,0,"th",3),o.YNc(6,K,3,2,"td",4),o.YNc(7,tt,1,0,"td",5),o.BQk(),o.ynx(8,6),o.YNc(9,nt,2,0,"th",7),o.YNc(10,et,2,4,"td",8),o.YNc(11,at,1,0,"td",5),o.BQk(),o.ynx(12,9),o.YNc(13,it,2,0,"th",10),o.YNc(14,ot,2,2,"td",4),o.YNc(15,rt,2,0,"td",5),o.BQk(),o.ynx(16,11),o.YNc(17,ct,2,1,"th",12),o.YNc(18,dt,6,3,"td",4),o.YNc(19,mt,2,0,"td",5),o.BQk(),o.ynx(20,13),o.YNc(21,ht,2,0,"th",14),o.YNc(22,gt,2,2,"td",15),o.YNc(23,pt,1,0,"td",5),o.BQk(),o.ynx(24,16),o.YNc(25,ft,2,0,"th",14),o.YNc(26,bt,2,2,"td",15),o.YNc(27,_t,1,0,"td",5),o.BQk(),o.ynx(28,17),o.YNc(29,At,2,0,"th",3),o.YNc(30,Tt,2,2,"td",18),o.YNc(31,Zt,1,0,"td",5),o.BQk(),o.ynx(32,19),o.YNc(33,vt,2,0,"th",3),o.YNc(34,wt,2,2,"td",18),o.YNc(35,kt,1,0,"td",5),o.BQk(),o.YNc(36,xt,1,0,"tr",20),o.YNc(37,Mt,1,1,"tr",21),o.qZA(),o.qZA(),o.qZA(),o.TgZ(38,"mat-card-actions"),o.TgZ(39,"ec-edit-actions",22),o.NdJ("editModeChange",function(t){return n.isEditMode=t})("save",function(){return n.save.emit(n.transactions)})("cancel",function(){return n.cancel.emit()}),o.YNc(40,yt,2,0,"button",23),o.YNc(41,Ct,2,0,"button",24),o.YNc(42,Ft,2,0,"button",25),o.qZA(),o.qZA(),o.qZA()),2&t&&(o.xp6(3),o.Q6J("dataSource",n.transactions)("trackBy",n.trackByFn),o.xp6(33),o.Q6J("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),o.xp6(1),o.Q6J("matRowDefColumns",n.displayedColumns),o.xp6(2),o.Q6J("editMode",n.isEditMode),o.xp6(1),o.Q6J("ngIf",n.isEditMode),o.xp6(1),o.Q6J("ngIf",n.isEditMode),o.xp6(1),o.Q6J("ngIf",n.isEditMode))},directives:[Y.a8,Y.dn,Q.BZ,Q.w1,Q.fO,Q.Dz,Q.mD,Q.as,Q.nj,Y.hq,U.Y,q.O5,Q.ge,Q.ev,L.oG,F.JJ,F.On,Q.yh,$.Q,E.Q,P.a,H.d,G.x,z,V.t,Q.XQ,Q.Gk,W.O,N.lW],styles:["table[_ngcontent-%COMP%]{width:100%;table-layout:fixed}ec-money-field[_ngcontent-%COMP%]{text-align:end}td[mat-cell][_ngcontent-%COMP%]{padding-left:5px;padding-right:5px}.mat-form-field-infix[_ngcontent-%COMP%]{width:5px}.menu-heading[_ngcontent-%COMP%]{justify-content:space-between}mat-card-content[_ngcontent-%COMP%]{margin-left:-24px;margin-right:-24px}mat-card[_ngcontent-%COMP%]{height:calc(100% - 48px);overflow:auto;display:flex;flex-direction:column}mat-card-content[_ngcontent-%COMP%]{height:calc(100% - 24px);overflow:auto}"]}),t})();var Bt=e(70749);let qt=(()=>{class t{constructor(t){this.apiGateway=t}transfer(t){return this.apiGateway.post(`/bank_accounts/${t.from}/transfer`,t)}}return t.\u0275fac=function(n){return new(n||t)(o.LFG(T.i))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Nt=e(28731),Jt=e(52205);const It=["amount"];function Ot(t,n){if(1&t&&(o.TgZ(0,"mat-option",16),o._uU(1),o.TgZ(2,"em"),o._uU(3),o.ALo(4,"ecMoney"),o.qZA(),o.qZA()),2&t){const t=n.$implicit;o.Q6J("value",t.id),o.xp6(1),o.hij("",t.name," "),o.xp6(2),o.hij("(",o.lcZ(4,3,t.current_balance),")")}}function Qt(t,n){1&t&&o.GkF(0)}function St(t,n){if(1&t&&(o.TgZ(0,"mat-option",16),o._uU(1),o.qZA()),2&t){const t=n.$implicit;o.Q6J("value",t.id),o.xp6(1),o.hij("",t.name," ")}}function Yt(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"mat-select",17),o.NdJ("ngModelChange",function(n){return o.CHM(t),o.oxw().accountTransfer.from_sink_fund_allocation=n}),o._UZ(1,"mat-option",16),o.YNc(2,St,2,2,"mat-option",2),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("ngModel",t.accountTransfer.from_sink_fund_allocation),o.xp6(1),o.Q6J("value",0),o.xp6(1),o.Q6J("ngForOf",t.sinkFundAllocationsFrom)}}function Ut(t,n){if(1&t&&(o.TgZ(0,"mat-option",16),o._uU(1),o.qZA()),2&t){const t=n.$implicit;o.Q6J("value",t.id),o.xp6(1),o.hij("",t.name," ")}}function Lt(t,n){if(1&t&&(o.TgZ(0,"mat-optgroup",20),o.YNc(1,Ut,2,2,"mat-option",2),o.qZA()),2&t){const t=n.$implicit;o.Q6J("label",t.name),o.xp6(1),o.Q6J("ngForOf",t.allocations)}}function $t(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"mat-select",18),o.NdJ("ngModelChange",function(n){return o.CHM(t),o.oxw().accountTransfer.from_allocation=n}),o._UZ(1,"mat-option",16),o.YNc(2,Lt,2,2,"mat-optgroup",19),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("ngModel",t.accountTransfer.from_allocation),o.xp6(1),o.Q6J("value",0),o.xp6(1),o.Q6J("ngForOf",t.allocationCategories)("ngForTrackBy",t.trackById)}}function Et(t,n){if(1&t&&(o.TgZ(0,"mat-option",16),o._uU(1),o.TgZ(2,"em"),o._uU(3),o.ALo(4,"ecMoney"),o.qZA(),o.qZA()),2&t){const t=n.$implicit;o.Q6J("value",t.id),o.xp6(1),o.hij("",t.name," "),o.xp6(2),o.hij("(",o.lcZ(4,3,t.current_balance),")")}}function Pt(t,n){1&t&&o.GkF(0)}function Ht(t,n){if(1&t&&(o.TgZ(0,"mat-option",16),o._uU(1),o.qZA()),2&t){const t=n.$implicit;o.Q6J("value",t.id),o.xp6(1),o.hij("",t.name," ")}}function Gt(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"mat-select",21),o.NdJ("ngModelChange",function(n){return o.CHM(t),o.oxw().accountTransfer.to_sink_fund_allocation=n}),o._UZ(1,"mat-option",16),o.YNc(2,Ht,2,2,"mat-option",2),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("ngModel",t.accountTransfer.to_sink_fund_allocation),o.xp6(1),o.Q6J("value",0),o.xp6(1),o.Q6J("ngForOf",t.sinkFundAllocationsTo)}}function jt(t,n){if(1&t&&(o.TgZ(0,"mat-option",16),o._uU(1),o.qZA()),2&t){const t=n.$implicit;o.Q6J("value",t.id),o.xp6(1),o.hij("",t.name," ")}}function Rt(t,n){if(1&t&&(o.TgZ(0,"mat-optgroup",20),o.YNc(1,jt,2,2,"mat-option",2),o.qZA()),2&t){const t=n.$implicit;o.Q6J("label",t.name),o.xp6(1),o.Q6J("ngForOf",t.allocations)}}function zt(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"mat-select",22),o.NdJ("ngModelChange",function(n){return o.CHM(t),o.oxw().accountTransfer.to_allocation=n}),o._UZ(1,"mat-option",16),o.YNc(2,Rt,2,2,"mat-optgroup",19),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("ngModel",t.accountTransfer.to_allocation),o.xp6(1),o.Q6J("value",0),o.xp6(1),o.Q6J("ngForOf",t.allocationCategories)("ngForTrackBy",t.trackById)}}let Vt=(()=>{class t{constructor(t,n,e,a){this.bankAccountService=t,this.transferService=n,this.messageService=e,this.dialogRef=a,this.fromAccount={},this.toAccount={},this.bankAccounts=[],this.budget={},this.allocations=[],this.allocationCategories=[],this.sinkFundAllocationsFrom=[],this.sinkFundAllocationsTo=[],this.accountTransfer={from:0,to:0,amount:0,description:"",date:(new Date).toISOString().substr(0,10)}}ngOnInit(){setTimeout(()=>{this.bankAccountService.getBankAccountsWithBalances().subscribe(t=>this.bankAccounts=t)},0)}findAccountById(t){return this.bankAccounts.find(n=>n.id===t)||{current_balance:0}}setBudget(t){this.budget=t,this.allocations=t.allocations;let n=(0,Bt.Z)(this.allocations,"allocation_category_id");this.allocationCategories=Object.keys(n).map(t=>{let e=n[t],a={id:Number(t)};return a.name=e[0].allocation_category.name,a.allocations=e,a}).sort((t,n)=>String(t.name).localeCompare(n.name)),this.accountTransfer.budget_id=this.budget.id}selectFromBankAccount(){const t=this.bankAccounts.find(t=>t.id===this.accountTransfer.from)||{};this.fromAccount=t,t.is_sink_fund?this.bankAccountService.getSinkFundAllocations(t.id).subscribe(t=>this.sinkFundAllocationsFrom=t):this.sinkFundAllocationsFrom=[]}selectToBankAccount(){const t=this.bankAccounts.find(t=>t.id===this.accountTransfer.to)||{};this.toAccount=t,t.is_sink_fund?this.bankAccountService.getSinkFundAllocations(t.id).subscribe(t=>this.sinkFundAllocationsTo=t):this.sinkFundAllocationsTo=[]}newFromBalance(){return this.findAccountById(this.accountTransfer.from).current_balance-this.accountTransfer.amount}newToBalance(){return this.findAccountById(this.accountTransfer.to).current_balance+this.accountTransfer.amount}save(){this.transferService.transfer(this.accountTransfer).subscribe(t=>{this.messageService.setMessage("Transfer completed."),this.dialogRef.close()},t=>{this.messageService.setErrorMessage("Error: "+(t.error&&t.error.reason)||0)})}cancel(){this.dialogRef.close()}trackById(t,n){return n.id}}return t.\u0275fac=function(n){return new(n||t)(o.Y36(w.A),o.Y36(qt),o.Y36(Nt.e),o.Y36(y.so))},t.\u0275cmp=o.Xpm({type:t,selectors:[["ec-transfer-form"]],viewQuery:function(t,n){if(1&t&&o.Gf(It,7,G.x),2&t){let t;o.iGM(t=o.CRH())&&(n.amountField=t.first)}},decls:36,vars:24,consts:[["mat-dialog-title",""],["placeholder","From","data-cy-from-field","",3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["align","end"],[4,"ngIf","ngIfThen","ngIfElse"],["sinkFundAllocationFrom",""],["allocationFrom",""],["placeholder","To","data-cy-to-field","",3,"ngModel","ngModelChange","selectionChange"],["sinkFundAllocationTo",""],["allocationTo",""],[3,"editMode","ngModel","ecValidateWithinBudget","errorMessage","ngModelChange"],["data-cy-description-field","","placeholder","Description",3,"editMode","ngModel","ngModelChange"],["data-cy-amount-field","","placeholder","Amount",3,"editMode","ngModel","ngModelChange"],["fxLayout","row","fxLayoutAlign","space-around",1,"actions"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"],[3,"value"],["placeholder","From Sink Fund Allocation",3,"ngModel","ngModelChange"],["placeholder","From Allocation",3,"ngModel","ngModelChange"],[3,"label",4,"ngFor","ngForOf","ngForTrackBy"],[3,"label"],["placeholder","To Sink Fund Allocation",3,"ngModel","ngModelChange"],["placeholder","To Allocation",3,"ngModel","ngModelChange"]],template:function(t,n){if(1&t&&(o.TgZ(0,"h1",0),o._uU(1,"Bank Account Transfer"),o.qZA(),o.TgZ(2,"mat-dialog-content"),o.TgZ(3,"mat-form-field"),o.TgZ(4,"mat-select",1),o.NdJ("ngModelChange",function(t){return n.accountTransfer.from=t})("selectionChange",function(){return n.selectFromBankAccount()}),o.YNc(5,Ot,5,5,"mat-option",2),o.qZA(),o.TgZ(6,"mat-hint",3),o._uU(7),o.ALo(8,"ecMoney"),o.qZA(),o.qZA(),o.TgZ(9,"mat-form-field"),o.YNc(10,Qt,1,0,"ng-container",4),o.YNc(11,Yt,3,3,"ng-template",null,5,o.W1O),o.YNc(13,$t,3,4,"ng-template",null,6,o.W1O),o.qZA(),o.TgZ(15,"mat-form-field"),o.TgZ(16,"mat-select",7),o.NdJ("ngModelChange",function(t){return n.accountTransfer.to=t})("selectionChange",function(){return n.selectToBankAccount()}),o.YNc(17,Et,5,5,"mat-option",2),o.qZA(),o.TgZ(18,"mat-hint",3),o._uU(19),o.ALo(20,"ecMoney"),o.qZA(),o.qZA(),o.TgZ(21,"mat-form-field"),o.YNc(22,Pt,1,0,"ng-container",4),o.YNc(23,Gt,3,3,"ng-template",null,8,o.W1O),o.YNc(25,zt,3,4,"ng-template",null,9,o.W1O),o.qZA(),o.TgZ(27,"ec-date-field",10),o.NdJ("ngModelChange",function(t){return n.accountTransfer.date=t}),o.qZA(),o.TgZ(28,"ec-text-field",11),o.NdJ("ngModelChange",function(t){return n.accountTransfer.description=t}),o.qZA(),o.TgZ(29,"ec-money-field",12),o.NdJ("ngModelChange",function(t){return n.accountTransfer.amount=t}),o.qZA(),o.qZA(),o.TgZ(30,"mat-dialog-actions"),o.TgZ(31,"div",13),o.TgZ(32,"button",14),o.NdJ("click",function(){return n.save()}),o._uU(33,"Save"),o.qZA(),o.TgZ(34,"button",15),o.NdJ("click",function(){return n.cancel()}),o._uU(35," Cancel "),o.qZA(),o.qZA(),o.qZA()),2&t){const t=o.MAs(12),e=o.MAs(14),a=o.MAs(24),i=o.MAs(26);o.xp6(4),o.Q6J("ngModel",n.accountTransfer.from),o.xp6(1),o.Q6J("ngForOf",n.bankAccounts),o.xp6(2),o.hij("New Balance: ",o.lcZ(8,20,n.newFromBalance()),""),o.xp6(3),o.Q6J("ngIf",n.fromAccount.is_sink_fund)("ngIfThen",t)("ngIfElse",e),o.xp6(6),o.Q6J("ngModel",n.accountTransfer.to),o.xp6(1),o.Q6J("ngForOf",n.bankAccounts),o.xp6(2),o.hij("New Balance: ",o.lcZ(20,22,n.newToBalance()),""),o.xp6(3),o.Q6J("ngIf",n.toAccount.is_sink_fund)("ngIfThen",a)("ngIfElse",i),o.xp6(5),o.Q6J("editMode",!0)("ngModel",n.accountTransfer.date)("ecValidateWithinBudget",n.budget)("errorMessage","test"),o.xp6(1),o.Q6J("editMode",!0)("ngModel",n.accountTransfer.description),o.xp6(1),o.Q6J("editMode",!0)("ngModel",n.accountTransfer.amount)}},directives:[y.uh,y.xY,D.KE,B.gD,F.JJ,F.On,q.sg,D.bx,q.O5,$.Q,P.a,G.x,y.H8,C.xw,C.Wh,N.lW,J.ey,J.Nv],pipes:[Jt.L],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),t})();var Wt=e(91161),Xt=e(29675),Kt=e(21906);function tn(t,n){if(1&t){const t=o.EpF();o.TgZ(0,"div",1),o.TgZ(1,"mat-card"),o.TgZ(2,"mat-card-title"),o._uU(3,"Selected Transaction Total"),o.qZA(),o.TgZ(4,"mat-card-content"),o._uU(5," Total: "),o.TgZ(6,"strong"),o._uU(7),o.ALo(8,"ecMoney"),o.qZA(),o.qZA(),o.TgZ(9,"mat-card-actions",2),o.TgZ(10,"button",3),o.NdJ("click",function(){return o.CHM(t),o.oxw().clearSelections()}),o._uU(11," Clear "),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=o.oxw();o.xp6(7),o.Oqu(o.lcZ(8,1,t.transactionTotal()))}}let nn=(()=>{class t{constructor(){this.transactions=[]}ngOnInit(){}transactionTotal(){return(0,Kt.M)(this.selectedTransactions(),"net_amount")}selectedTransactions(){return this.transactions?this.transactions.filter(t=>t.selected):[]}showCalculator(){return this.selectedTransactions().length>0}clearSelections(){this.selectedTransactions().forEach(t=>{t.selected=!1})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["ec-transaction-calculator"]],inputs:{transactions:"transactions"},decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],["fxLayoutAlign","end"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,n){1&t&&o.YNc(0,tn,12,3,"div",0),2&t&&o.Q6J("ngIf",n.showCalculator())},directives:[q.O5,Y.a8,Y.n5,Y.dn,Y.hq,C.Wh,N.lW],pipes:[Jt.L],styles:["div.container[_ngcontent-%COMP%]{position:fixed;top:60px;right:60px;z-index:1000}mat-card[_ngcontent-%COMP%]{background:#efdbdb}"]}),t})();var en=e(15257);function an(t,n){if(1&t&&(o.TgZ(0,"mat-option",9),o._uU(1),o.qZA()),2&t){const t=n.$implicit;o.Q6J("value",t.id),o.xp6(1),o.Oqu(t.name)}}function on(t,n){if(1&t&&(o.TgZ(0,"mat-option",9),o._uU(1),o.qZA()),2&t){const t=n.$implicit;o.Q6J("value",t.id),o.xp6(1),o.Oqu(t.name)}}let rn=(()=>{class t{constructor(t,n,e,a,i){this.bankAccountService=t,this.budgetService=n,this.fb=e,this.activatedRoute=a,this.router=i,this.bankAccounts=[],this.budgets=[],this.change=new o.vpe,this.componentDestroyed=new p.xQ}ngOnInit(){this.form=this.fb.group({budget_id:0,bank_account_id:0}),this.loadBudgetsAndBankAccounts(),this.form.valueChanges.pipe((0,M.R)(this.componentDestroyed)).subscribe(()=>{this.onSubmit()})}loadBudgetsAndBankAccounts(){(0,f.aj)([this.bankAccountService.getBankAccounts(),this.budgetService.getBudgetsWithTransactions(),this.activatedRoute.paramMap.pipe((0,b.U)(this.convertToNumericParams),(0,en.q)(1))]).subscribe(t=>{let n;[this.bankAccounts,this.budgets,n]=t,this.setInitialFormValue(n)})}convertToNumericParams(t){return{budget_id:Number(t.get("budget_id"))||0,bank_account_id:Number(t.get("bank_account_id"))||0}}setInitialFormValue(t){let n=this.initializeWithDefaultValuesIfNeeded(t);this.form.patchValue(n),this.onSubmit()}initializeWithDefaultValuesIfNeeded(t){return{bank_account_id:t.bank_account_id||this.firstBankAccountId(),budget_id:t.budget_id||this.firstBudgetId()}}firstBudgetId(){return this.budgets.length>0?this.budgets[0].id:0}firstBankAccountId(){return this.bankAccounts.length>0?this.bankAccounts[0].id:0}onSubmit(){let t=Object.assign({},this.form.value);this.updateBudgetAndBankAccount(t),this.change.emit(t),this.router.navigate([{budget_id:t.budget_id,bank_account_id:t.bank_account_id}],{relativeTo:this.activatedRoute})}updateBudgetAndBankAccount(t){let n=this.bankAccounts.find(n=>n.id===t.bank_account_id);n&&(t.bankAccount=n);let e=this.budgets.find(n=>n.id===t.budget_id);e&&(t.budget=e)}linkToBudget(){return this.form.value.budget_id?`/budgets/${this.form.value.budget_id}`:"/budgets"}ngOnDestroy(){this.componentDestroyed.next(),this.componentDestroyed.complete()}}return t.\u0275fac=function(n){return new(n||t)(o.Y36(w.A),o.Y36(v.t),o.Y36(F.qu),o.Y36(x.gz),o.Y36(x.F0))},t.\u0275cmp=o.Xpm({type:t,selectors:[["ec-transaction-search-form"]],outputs:{change:"change"},decls:17,vars:4,consts:[[3,"formGroup","ngSubmit"],["fxLayout","row","fxLayoutGap","20px"],["fxFlex","2 0 auto"],["placeholder","Bank Account","formControlName","bank_account_id"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Budget","formControlName","budget_id"],["fxLayout","row","fxLayoutAlign","space-between center"],["mat-raised-button","","type","submit","color","primary"],["color","primary",3,"routerLink"],[3,"value"]],template:function(t,n){1&t&&(o.TgZ(0,"form",0),o.NdJ("ngSubmit",function(){return n.onSubmit()}),o.TgZ(1,"mat-card"),o.TgZ(2,"mat-card-title"),o._uU(3,"Select Transactions to View"),o.qZA(),o.TgZ(4,"mat-card-content"),o.TgZ(5,"div",1),o.TgZ(6,"mat-form-field",2),o.TgZ(7,"mat-select",3),o.YNc(8,an,2,2,"mat-option",4),o.qZA(),o.qZA(),o.TgZ(9,"mat-form-field",2),o.TgZ(10,"mat-select",5),o.YNc(11,on,2,2,"mat-option",4),o.qZA(),o.qZA(),o.qZA(),o.TgZ(12,"div",6),o.TgZ(13,"button",7),o._uU(14," Refresh "),o.qZA(),o.TgZ(15,"a",8),o._uU(16,"Go to Budget"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&t&&(o.Q6J("formGroup",n.form),o.xp6(8),o.Q6J("ngForOf",n.bankAccounts),o.xp6(3),o.Q6J("ngForOf",n.budgets),o.xp6(4),o.Q6J("routerLink",n.linkToBudget()))},directives:[F._Y,F.JL,F.sg,Y.a8,Y.n5,Y.dn,C.xw,C.SQ,D.KE,C.yH,B.gD,F.JJ,F.u,q.sg,C.Wh,N.lW,x.yS,J.ey],styles:["mat-card[_ngcontent-%COMP%]{padding:12px}"]}),t})();var cn=e(10194);function sn(t,n){if(1&t&&(o.ynx(0),o.TgZ(1,"div",0),o.TgZ(2,"span",1),o._uU(3,"Current Budget Balance"),o.qZA(),o.TgZ(4,"span",2),o._uU(5),o.ALo(6,"ecMoney"),o.qZA(),o.qZA(),o.TgZ(7,"div",3),o.TgZ(8,"span",1),o._uU(9,"Difference (Bank vs Budget)"),o.qZA(),o.TgZ(10,"span",2),o._UZ(11,"ec-money-field",4),o.qZA(),o.qZA(),o.BQk()),2&t){const t=o.oxw();o.xp6(5),o.Oqu(o.lcZ(6,3,t.lastBudgetBalance())),o.xp6(6),o.Q6J("value",t.budgetDifference())("highlightPositive",!0)}}function un(t,n){if(1&t&&(o.ynx(0),o.TgZ(1,"div",0),o.TgZ(2,"span",1),o._uU(3,"Unpaid Balance"),o.qZA(),o.TgZ(4,"span",2),o._UZ(5,"ec-money-field",4),o.qZA(),o.qZA(),o.TgZ(6,"div",0),o.TgZ(7,"span",1),o._uU(8,"Unpaid Difference"),o.qZA(),o.TgZ(9,"span",2),o._UZ(10,"ec-money-field",4),o.qZA(),o.qZA(),o.BQk()),2&t){const t=o.oxw();o.xp6(5),o.Q6J("value",t.unpaidBalance())("highlightPositive",!0),o.xp6(5),o.Q6J("value",t.unpaidDifference())("highlightPositive",!0)}}let ln=(()=>{class t{constructor(t){this.settingsService=t}ngOnInit(){this.settingsService.getSettings().subscribe(t=>{this.primary_budget_account_id=t.primary_budget_account_id})}lastBankBalance(){return this.bankAccount?this.bankAccount.closing_balance:0}transactionTotal(){if(!this.transactions)return 0;let t=0,n=0;return this.transactions.forEach(e=>{e.deleted||(t+=e.withdrawal_amount,n+=e.deposit_amount)}),n-t}currentBankBalance(){return this.lastBankBalance()+this.transactionTotal()}showBudgetBalance(){return!!this.bankAccount&&this.bankAccount.id===this.primary_budget_account_id}lastBudgetBalance(){return(0,Kt.M)(this.allocations,"amount")-(0,Kt.M)(this.allocations,"spent")}currentBudgetBalance(){return this.lastBudgetBalance()}budgetDifference(){return this.currentBankBalance()-this.currentBudgetBalance()}showUnpaidBalance(){return!!this.bankAccount&&"credit_card"===this.bankAccount.account_type}unpaidBalance(){if(!this.transactions)return 0;let t=this.transactions.filter(t=>!t.paid);return(0,Kt.M)(t,"net_amount")}unpaidDifference(){return this.currentBankBalance()-this.unpaidBalance()}}return t.\u0275fac=function(n){return new(n||t)(o.Y36(cn.g))},t.\u0275cmp=o.Xpm({type:t,selectors:[["ec-transaction-summary"]],inputs:{bankAccount:"bankAccount",transactions:"transactions",allocations:"allocations"},decls:21,vars:10,consts:[["fxLayout","row"],[1,"heading"],[1,"value"],["fxLayout","row",1,"total"],[3,"value","highlightPositive"],[4,"ngIf"]],template:function(t,n){1&t&&(o.TgZ(0,"mat-card"),o.TgZ(1,"mat-card-content"),o.TgZ(2,"div",0),o.TgZ(3,"span",1),o._uU(4,"Last Bank Balance"),o.qZA(),o.TgZ(5,"span",2),o._uU(6),o.ALo(7,"ecMoney"),o.qZA(),o.qZA(),o.TgZ(8,"div",0),o.TgZ(9,"span",1),o._uU(10,"Transaction Total"),o.qZA(),o.TgZ(11,"span",2),o._uU(12),o.ALo(13,"ecMoney"),o.qZA(),o.qZA(),o.TgZ(14,"div",3),o.TgZ(15,"span",1),o._uU(16,"Current Bank Balance"),o.qZA(),o.TgZ(17,"span",2),o._UZ(18,"ec-money-field",4),o.qZA(),o.qZA(),o.YNc(19,sn,12,5,"ng-container",5),o.YNc(20,un,11,4,"ng-container",5),o.qZA(),o.qZA()),2&t&&(o.xp6(6),o.Oqu(o.lcZ(7,6,n.lastBankBalance())),o.xp6(6),o.Oqu(o.lcZ(13,8,n.transactionTotal())),o.xp6(6),o.Q6J("value",n.currentBankBalance())("highlightPositive",!0),o.xp6(1),o.Q6J("ngIf",n.showBudgetBalance()),o.xp6(1),o.Q6J("ngIf",n.showUnpaidBalance()))},directives:[Y.a8,Y.dn,C.xw,G.x,q.O5],pipes:[Jt.L],styles:[".heading[_ngcontent-%COMP%]{flex:2 0 auto;font-weight:bold}.value[_ngcontent-%COMP%]{flex:1 0 auto;text-align:right}.total[_ngcontent-%COMP%]{font-size:16px;border-top:1px solid black}"]}),t})(),dn=(()=>{class t{constructor(t,n,e,a,i,o){this.transactionService=t,this.transactionDataService=n,this.loadingIndicator=e,this.toolbarService=a,this.messageService=i,this.dialog=o,this.transactions=[],this.allocations=[],this.sinkFundAllocations=[],this.bankAccount={},this.budget={},this.componentDestroyed=new p.xQ}ngOnInit(){this.toolbarService.setHeading("Transactions"),this.transactionDataService.init(),this.transactionDataService.allData$().pipe((0,M.R)(this.componentDestroyed)).subscribe(([t,n,e])=>{this.transactions=t,this.allocations=n,this.sinkFundAllocations=e,this.loadingIndicator.hide()})}refreshTransactions(t={}){this.loadingIndicator.show(),t.bankAccount&&(this.bankAccount=t.bankAccount),t.budget&&(this.budget=t.budget),this.transactionDataService.refresh(t)}refresh(){this.refreshTransactions({budget_id:this.budget.id,bank_account_id:this.bankAccount.id})}save(){this.loadingIndicator.show(),this.transactionService.save(this.transactions,this.bankAccount,this.budget).subscribe(()=>{this.loadingIndicator.hide(),this.transactionList.switchToDisplayMode(),this.refresh(),this.messageService.setMessage("Transactions saved.",5e3)})}cancel(){this.transactionDataService.refresh({bank_account_id:this.bankAccount.id,budget_id:this.budget.id})}showImportForm(){let t=this.dialog.open(O,{width:"350px"});return t.componentInstance.startDate=this.budget.start_date,t.componentInstance.endDate=this.budget.end_date,t.componentInstance.importType=this.bankAccount.import_format,t.afterClosed().subscribe(t=>{t.length>0&&(this.transactions=this.transactions.concat(t))}),t}showTransferForm(){let t=this.dialog.open(Vt,{width:"350px"});return this.budget.allocations=this.allocations,t.componentInstance.setBudget(this.budget),t.afterClosed().subscribe(()=>{this.refresh()}),t}ngOnDestroy(){this.componentDestroyed.next(),this.componentDestroyed.complete(),this.transactionDataService.destroy()}}return t.\u0275fac=function(n){return new(n||t)(o.Y36(Z),o.Y36(k),o.Y36(Wt.T),o.Y36(Xt.S),o.Y36(Nt.e),o.Y36(y.uw))},t.\u0275cmp=o.Xpm({type:t,selectors:[["ec-transactions"]],viewQuery:function(t,n){if(1&t&&o.Gf(Dt,7),2&t){let t;o.iGM(t=o.CRH())&&(n.transactionList=t.first)}},decls:7,vars:9,consts:[[1,"main"],[3,"transactions"],[1,"container"],[3,"change"],[3,"transactions","bankAccount","allocations"],[3,"transactions","allocations","sinkFundAllocations","bankAccount","budget","save","cancel","import","transfer"]],template:function(t,n){1&t&&(o.TgZ(0,"mat-card",0),o.TgZ(1,"mat-card-content"),o._UZ(2,"ec-transaction-calculator",1),o.TgZ(3,"div",2),o.TgZ(4,"ec-transaction-search-form",3),o.NdJ("change",function(t){return n.refreshTransactions(t)}),o.qZA(),o._UZ(5,"ec-transaction-summary",4),o.TgZ(6,"ec-transaction-list",5),o.NdJ("save",function(){return n.save()})("cancel",function(){return n.cancel()})("import",function(){return n.showImportForm()})("transfer",function(){return n.showTransferForm()}),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&t&&(o.xp6(2),o.Q6J("transactions",n.transactions),o.xp6(3),o.Q6J("transactions",n.transactions)("bankAccount",n.bankAccount)("allocations",n.allocations),o.xp6(1),o.Q6J("transactions",n.transactions)("allocations",n.allocations)("sinkFundAllocations",n.sinkFundAllocations)("bankAccount",n.bankAccount)("budget",n.budget))},directives:[Y.a8,Y.dn,nn,rn,ln,Dt],styles:['mat-card-content[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]{height:100%;overflow:auto}.container[_ngcontent-%COMP%]{display:grid;width:100%;grid-template-areas:"selector summary" "list     list";grid-template-rows:175px 1fr;grid-template-columns:1fr 1fr;grid-column-gap:20px;-moz-column-gap:20px;column-gap:20px}@media (max-width: 600px){mat-card.main[_ngcontent-%COMP%]{height:100%}.container[_ngcontent-%COMP%]{display:grid;width:100%;grid-template-areas:"selector" "summary" "list";grid-template-rows:175px 160px 1fr;grid-template-columns:auto}}ec-transaction-search-form[_ngcontent-%COMP%]{grid-area:selector;width:100%}ec-transaction-summary[_ngcontent-%COMP%]{grid-area:summary;width:100%}ec-transaction-list[_ngcontent-%COMP%]{grid-area:list;overflow:auto;width:100%}']}),t})();const mn=[{path:"",canActivate:[e(31265).a],children:[{path:"",component:dn}]}];let hn=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[x.Bz.forChild(mn)]]}),t})(),gn=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[i.m.forRoot()]]}),t})(),pn=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({providers:[Z,k],imports:[[i.m,a.c,g,gn,hn]]}),t})()}}]);