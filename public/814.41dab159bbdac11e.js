"use strict";(self.webpackChunkeverycent=self.webpackChunkeverycent||[]).push([[814],{8814:(I,p,s)=>{s.r(p),s.d(p,{AccountBalancesModule:()=>Y});var h=s(6895),Z=s(6712),A=s(6630),C=s(1265),y=s(7545),t=s(4650),i=s(4006),l=s(5412),_=s(6326),f=s(1769);function B(c,a){if(1&c&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&c){const n=a.$implicit;t.xp6(1),t.hij(" ",n.name," ")}}function v(c,a){if(1&c&&(t.TgZ(0,"td",8)(1,"div",9),t._UZ(2,"ec-money-field",10),t.qZA()()),2&c){const n=a.index;t.xp6(1),t.Q6J("formGroupName",n),t.xp6(1),t.Q6J("editMode",!1)}}function k(c,a){if(1&c&&(t.TgZ(0,"td",8)(1,"div",9),t._UZ(2,"ec-money-field",11),t.qZA()()),2&c){const n=a.index;t.xp6(1),t.Q6J("formGroupName",n),t.xp6(1),t.Q6J("editMode",!0)}}let T=(()=>{class c{constructor(n,e){this.fb=n,this.dialogRef=e,this.bankAccounts=[],this.save=new t.vpe,this.cancel=new t.vpe}ngOnInit(){this.createForm()}createForm(){let n=this.bankAccounts.map(e=>this.fb.group({bank_account_id:e.id,new_balance:e.current_balance,currentBalance:e.current_balance}));this.form=this.fb.group({adjustments:this.fb.array(n)})}saveChanges(){this.save.emit(this.form.value),this.save.complete()}cancelChanges(){this.cancel.emit(),this.cancel.complete(),this.dialogRef.close()}}return c.\u0275fac=function(n){return new(n||c)(t.Y36(i.QS),t.Y36(l.so))},c.\u0275cmp=t.Xpm({type:c,selectors:[["ec-adjust-balances"]],inputs:{bankAccounts:"bankAccounts"},outputs:{save:"save",cancel:"cancel"},decls:21,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"table"],[4,"ngFor","ngForOf"],["formArrayName","adjustments",4,"ngFor","ngForOf"],["mat-dialog-actions",""],[3,"editMode","save","cancel"],["formArrayName","adjustments"],[3,"formGroupName"],["formControlName","currentBalance",3,"editMode"],["formControlName","new_balance",3,"editMode"]],template:function(n,e){1&n&&(t.TgZ(0,"h1",0),t._uU(1,"Adjust Account Balances"),t.qZA(),t.TgZ(2,"div",1)(3,"div",2)(4,"table",3)(5,"thead")(6,"tr")(7,"th"),t._uU(8,"Bank Account"),t.qZA(),t.YNc(9,B,2,1,"th",4),t.qZA()(),t.TgZ(10,"tbody")(11,"tr")(12,"td"),t._uU(13," Current Balance "),t.qZA(),t.YNc(14,v,3,2,"td",5),t.qZA(),t.TgZ(15,"tr")(16,"td"),t._uU(17," New Account Balance "),t.qZA(),t.YNc(18,k,3,2,"td",5),t.qZA()()()()(),t.TgZ(19,"div",6)(20,"ec-edit-actions",7),t.NdJ("save",function(){return e.saveChanges()})("cancel",function(){return e.cancelChanges()}),t.qZA()()),2&n&&(t.xp6(3),t.Q6J("formGroup",e.form),t.xp6(6),t.Q6J("ngForOf",e.bankAccounts),t.xp6(5),t.Q6J("ngForOf",e.bankAccounts),t.xp6(4),t.Q6J("ngForOf",e.bankAccounts),t.xp6(2),t.Q6J("editMode",!0))},dependencies:[h.sg,i.JJ,i.JL,i.sg,i.u,i.x0,i.CE,l.uh,l.xY,l.H8,_.Y,f.x],encapsulation:2}),c})();var x=s(9675),U=s(7369);let d=(()=>{class c{constructor(n){this.apiGateway=n}getAccountBalances$(n){let e="/account_balances";return n&&(e+="?include_closed=true"),this.bankAccounts$=this.apiGateway.get(e),this.bankAccounts$}netWorth(n){let e=0;return n.forEach(o=>{e+=o.current_balance}),e}adjustAccountBalances(n){return n.adjustments=n.adjustments.filter(e=>e.new_balance!==e.currentBalance),this.apiGateway.post("/bank_accounts/manually_adjust_balances",n)}totalAssets(n){return n.filter(e=>"asset"===e.account_category).reduce((e,o)=>e+o.current_balance,0)}totalLiabilities(n){return n.filter(e=>"liability"===e.account_category).reduce((e,o)=>e+o.current_balance,0)}netCurrentCash(n){return n.filter(e=>"current"===e.account_category||"liability"===e.account_category&&e.is_cash).reduce((e,o)=>e+o.current_balance,0)}netCashAssets(n){return n.filter(e=>"asset"===e.account_category&&e.is_cash).reduce((e,o)=>e+o.current_balance,0)}netNonCashAssets(n){return n.filter(e=>("asset"===e.account_category||"liability"===e.account_category)&&!e.is_cash).reduce((e,o)=>e+o.current_balance,0)}}return c.\u0275fac=function(n){return new(n||c)(t.LFG(U.i))},c.\u0275prov=t.Yz7({token:c,factory:c.\u0275fac}),c})();var L=s(8731),u=s(277),M=s(4859),r=s(3546),j=s(455),g=s(1906),b=s(2205);const q=function(c){return{bank_account_id:c}},J=function(c){return["..","transactions",c]};function F(c,a){if(1&c&&(t.TgZ(0,"tr")(1,"td")(2,"a",6),t._uU(3),t.qZA()(),t.TgZ(4,"td",1),t._uU(5),t.qZA(),t.TgZ(6,"td",1),t._uU(7),t.qZA(),t.TgZ(8,"td",1),t._uU(9),t.qZA(),t.TgZ(10,"td",5),t._uU(11),t.ALo(12,"ecMoney"),t.qZA(),t.TgZ(13,"td",5),t._uU(14),t.ALo(15,"ecMoney"),t.qZA(),t.TgZ(16,"td",5),t._uU(17),t.ALo(18,"ecMoney"),t.qZA()()),2&c){const n=a.$implicit;t.xp6(2),t.Q6J("routerLink",t.VKq(16,J,t.VKq(14,q,n.id))),t.xp6(1),t.hij(" ",null==n?null:n.name,""),t.xp6(2),t.Oqu(null==n||null==n.institution?null:n.institution.name),t.xp6(2),t.Oqu(null==n?null:n.account_type),t.xp6(2),t.Oqu(null==n?null:n.account_category),t.xp6(2),t.hij(" ",t.lcZ(12,8,null==n?null:n.closing_balance)," "),t.xp6(3),t.hij(" ",t.lcZ(15,10,null==n?null:n.expected_closing_balance)," "),t.xp6(3),t.hij(" ",t.lcZ(18,12,null==n?null:n.current_balance)," ")}}let N=(()=>{class c{constructor(){this.heading="",this.bankAccounts=[],this.firstBankAccount={id:0,name:""}}ngOnInit(){}ngOnChanges(n){this.firstBankAccount=this.bankAccounts&&this.bankAccounts[0]?this.bankAccounts[0]:{}}closingBalance(){return(0,g.M)(this.bankAccounts,"closing_balance")}expectedClosingBalance(){return(0,g.M)(this.bankAccounts,"expected_closing_balance")}currentBalance(){return(0,g.M)(this.bankAccounts,"current_balance")}}return c.\u0275fac=function(n){return new(n||c)},c.\u0275cmp=t.Xpm({type:c,selectors:[["ec-account-list"]],inputs:{heading:"heading",bankAccounts:"bankAccounts"},features:[t.TTD],decls:42,vars:19,consts:[[1,"table"],[1,"hidden-xs"],[4,"ngFor","ngForOf"],[1,"total"],["colspan","4",1,"hidden-xs","text-right"],[1,"right"],[3,"routerLink"]],template:function(n,e){1&n&&(t.TgZ(0,"mat-card")(1,"mat-card-header"),t._uU(2),t.qZA(),t.TgZ(3,"mat-card-content")(4,"table",0)(5,"thead")(6,"tr")(7,"th"),t._uU(8,"Name"),t.qZA(),t.TgZ(9,"th",1),t._uU(10,"Institution"),t.qZA(),t.TgZ(11,"th",1),t._uU(12,"Account Type"),t.qZA(),t.TgZ(13,"th",1),t._uU(14,"Category"),t.qZA(),t.TgZ(15,"th"),t._uU(16," Balance At: "),t.TgZ(17,"em"),t._uU(18),t.ALo(19,"date"),t.qZA()(),t.TgZ(20,"th"),t._uU(21," Balance At: "),t.TgZ(22,"em"),t._uU(23),t.ALo(24,"date"),t.qZA()(),t.TgZ(25,"th"),t._uU(26,"Current Balance"),t.qZA()()(),t.TgZ(27,"tbody"),t.YNc(28,F,19,18,"tr",2),t.qZA(),t.TgZ(29,"tfoot")(30,"tr",3)(31,"th",4),t._uU(32,"Total"),t.qZA(),t.TgZ(33,"th",5),t._uU(34),t.ALo(35,"ecMoney"),t.qZA(),t.TgZ(36,"th",5),t._uU(37),t.ALo(38,"ecMoney"),t.qZA(),t.TgZ(39,"th",5),t._uU(40),t.ALo(41,"ecMoney"),t.qZA()()()()()()),2&n&&(t.xp6(2),t.Oqu(e.heading),t.xp6(16),t.Oqu(t.xi3(19,7,null==e.firstBankAccount?null:e.firstBankAccount.closing_date,"MMM dd")),t.xp6(5),t.Oqu(t.xi3(24,10,null==e.firstBankAccount?null:e.firstBankAccount.next_closing_date,"MMM dd")),t.xp6(5),t.Q6J("ngForOf",e.bankAccounts),t.xp6(6),t.hij(" ",t.lcZ(35,13,e.closingBalance())," "),t.xp6(3),t.hij(" ",t.lcZ(38,15,e.expectedClosingBalance())," "),t.xp6(3),t.hij(" ",t.lcZ(41,17,e.currentBalance())," "))},dependencies:[h.sg,A.yS,r.a8,r.dk,r.dn,h.uU,b.L],encapsulation:2,changeDetection:0}),c})(),O=(()=>{class c{constructor(n){this.abs=n,this.bankAccounts=[],this.totalAssets=0,this.totalLiabilities=0,this.netCurrentCash=0,this.netCashAssets=0,this.netNonCashAssets=0,this.netWorth=0}ngOnInit(){}ngOnChanges(n){this.updateTotals()}updateTotals(){this.totalAssets=this.abs.totalAssets(this.bankAccounts),this.totalLiabilities=this.abs.totalLiabilities(this.bankAccounts),this.netCurrentCash=this.abs.netCurrentCash(this.bankAccounts),this.netCashAssets=this.abs.netCashAssets(this.bankAccounts),this.netNonCashAssets=this.abs.netNonCashAssets(this.bankAccounts),this.netWorth=this.abs.netWorth(this.bankAccounts)}}return c.\u0275fac=function(n){return new(n||c)(t.Y36(d))},c.\u0275cmp=t.Xpm({type:c,selectors:[["ec-account-balance-totals"]],inputs:{bankAccounts:"bankAccounts"},features:[t.TTD],decls:23,vars:5,consts:[["fxLayout","column",1,"holder"],["fxLayout","row","fxLayoutAlign","end end"],["fxFlex","80"],["fxFlex","20",3,"value"],["fxLayout","row","fxLayoutAlign","end center",1,"net-worth"],["fxLayout","row",1,"net-worth","text-right"],["fxFlex","80","fxFlexAlign","end"],["fxLayout","row","fxLayoutAlign","end center",1,"net-worth","text-right"],["fxLayout","row"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"h3",1)(2,"span",2),t._uU(3,"Total Liabilities"),t.qZA(),t._UZ(4,"ec-money-field",3),t.qZA(),t._UZ(5,"hr"),t.TgZ(6,"h3",4)(7,"span",2),t._uU(8,"Net Current Cash:"),t.qZA(),t._UZ(9,"ec-money-field",3),t.qZA(),t.TgZ(10,"h3",5)(11,"span",6),t._uU(12,"Net Cash Assets:"),t.qZA(),t._UZ(13,"ec-money-field",3),t.qZA(),t.TgZ(14,"h3",7)(15,"span",2),t._uU(16,"Net Non Cash Assets:"),t.qZA(),t._UZ(17,"ec-money-field",3),t.qZA(),t._UZ(18,"hr"),t.TgZ(19,"h2",8)(20,"span",2),t._uU(21,"Net Worth:"),t.qZA(),t._UZ(22,"ec-money-field",3),t.qZA()()),2&n&&(t.xp6(4),t.Q6J("value",e.abs.totalLiabilities(e.bankAccounts)),t.xp6(5),t.Q6J("value",e.abs.netCurrentCash(e.bankAccounts)),t.xp6(4),t.Q6J("value",e.abs.netCashAssets(e.bankAccounts)),t.xp6(4),t.Q6J("value",e.abs.netNonCashAssets(e.bankAccounts)),t.xp6(5),t.Q6J("value",e.abs.netWorth(e.bankAccounts)))},dependencies:[u.xw,u.Wh,u.XD,u.yH,f.x],styles:["div.holder[_ngcontent-%COMP%]{margin:30px}span[_ngcontent-%COMP%], ec-money-field[_ngcontent-%COMP%]{text-align:end}hr[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),c})();const w=[{path:"",canActivate:[C.a],children:[{path:"",component:(()=>{class c{constructor(n,e,o,m){this.toolbarService=n,this.accountBalancesService=e,this.dialog=o,this.messageService=m,this.bankAccounts=[],this.totalAssets=0,this.searchParams={},this.includeClosedAccounts=!1}ngOnInit(){this.toolbarService.setHeading("Account Balances"),this.refreshBankAccountList()}onIncludeClosedChanged(n){this.includeClosedAccounts=n.checked,this.refreshBankAccountList()}refreshBankAccountList(){this.accountBalancesService.getAccountBalances$(this.includeClosedAccounts).subscribe(n=>{this.bankAccounts=n,this.updateBankAccountLists(),this.totalAssets=this.accountBalancesService.totalAssets(this.bankAccounts)})}updateBankAccountLists(){this.currentAccounts=this.bankAccounts.filter(n=>"current"===n.account_category),this.assetAccounts=this.bankAccounts.filter(n=>"asset"===n.account_category),this.cashAssetAccounts=this.bankAccounts.filter(n=>"asset"===n.account_category&&n.is_cash),this.nonCashAssetAccounts=this.bankAccounts.filter(n=>"asset"===n.account_category&&!n.is_cash),this.liabilityAccounts=this.bankAccounts.filter(n=>"liability"===n.account_category),this.creditCardAccounts=this.bankAccounts.filter(n=>"liability"===n.account_category&&n.is_cash),this.loanAccounts=this.bankAccounts.filter(n=>"liability"===n.account_category&&!n.is_cash)}showAdjustAccountBalancesForm(){this.dialogRef=this.dialog.open(T,{maxHeight:600});const n=this.dialogRef.componentInstance;n.bankAccounts=this.bankAccounts,n.save.pipe((0,y.w)(e=>this.accountBalancesService.adjustAccountBalances(e))).subscribe(e=>{this.messageService.setMessage("Balances adjusted."),this.refreshBankAccountList(),this.dialogRef.close()})}}return c.\u0275fac=function(n){return new(n||c)(t.Y36(x.S),t.Y36(d),t.Y36(l.uw),t.Y36(L.e))},c.\u0275cmp=t.Xpm({type:c,selectors:[["ec-account-balances"]],decls:18,vars:10,consts:[[1,"main"],["fxLayout","column"],["fxLayoutAlign","space-between",1,"button-row"],["fxFlexAlign","center end",3,"checked","change"],["mat-raised-button","","color","primary",1,"adjust-balances",3,"click"],["heading","Current Accounts",3,"bankAccounts"],["heading","Cash Assets",3,"bankAccounts"],["heading","Non Cash Assets",3,"bankAccounts"],["fxLayoutAlign","end",1,"total"],["heading","Credit Cards",3,"bankAccounts"],["heading","Loans",3,"bankAccounts"],[3,"bankAccounts"]],template:function(n,e){1&n&&(t.TgZ(0,"mat-card",0)(1,"mat-card-content")(2,"div",1)(3,"div",2)(4,"mat-slide-toggle",3),t.NdJ("change",function(m){return e.onIncludeClosedChanged(m)}),t._uU(5," Include Closed Accounts? "),t.qZA(),t.TgZ(6,"button",4),t.NdJ("click",function(){return e.showAdjustAccountBalancesForm()}),t._uU(7," Adjust Account Balances "),t.qZA()(),t._UZ(8,"ec-account-list",5)(9,"ec-account-list",6)(10,"ec-account-list",7),t.TgZ(11,"div",8)(12,"h3"),t._uU(13),t.ALo(14,"ecMoney"),t.qZA()(),t._UZ(15,"ec-account-list",9)(16,"ec-account-list",10)(17,"ec-account-balance-totals",11),t.qZA()()()),2&n&&(t.xp6(4),t.Q6J("checked",!1),t.xp6(4),t.Q6J("bankAccounts",e.currentAccounts),t.xp6(1),t.Q6J("bankAccounts",e.cashAssetAccounts),t.xp6(1),t.Q6J("bankAccounts",e.nonCashAssetAccounts),t.xp6(3),t.hij("Total Assets: ",t.lcZ(14,8,e.totalAssets),""),t.xp6(2),t.Q6J("bankAccounts",e.creditCardAccounts),t.xp6(1),t.Q6J("bankAccounts",e.loanAccounts),t.xp6(1),t.Q6J("bankAccounts",e.bankAccounts))},dependencies:[u.xw,u.Wh,u.XD,M.lW,r.a8,r.dn,j.Rr,N,O,b.L],styles:[".total[_ngcontent-%COMP%]{margin-right:25px}ec-account-list[_ngcontent-%COMP%]{margin-bottom:5px}.button-row[_ngcontent-%COMP%]{margin-top:15px;margin-bottom:15px}"]}),c})()}]}];let S=(()=>{class c{}return c.\u0275fac=function(n){return new(n||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({imports:[A.Bz.forChild(w),A.Bz]}),c})(),Y=(()=>{class c{}return c.\u0275fac=function(n){return new(n||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({providers:[d],imports:[h.ez,Z.m,S]}),c})()}}]);