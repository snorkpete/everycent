"use strict";(self.webpackChunkeverycent=self.webpackChunkeverycent||[]).push([[895],{4895:(On,Y,s)=>{s.r(Y),s.d(Y,{TransactionsModule:()=>Bn});var ot=s(232),I=s(6712),t=s(4650);let U=(()=>{class e{constructor(){}convertToTransactions(n,a,o){let i=this.convertInputToLines(n),l=i.length/3,u=[];for(let p=0;p<l;p++){let g,m=i[3*p+0],h=i[3*p+1],C=this.extractAmount(i[3*p+2]),d={transaction_date:this.extractDate(h),description:m.trim(),withdrawal_amount:C<0?-1*C:0,deposit_amount:C>0?C:0,status:"unpaid"};g=d.transaction_date instanceof Date?d.transaction_date:new Date(d.transaction_date),d.transaction_date>=a&&d.transaction_date<=o&&u.push(d)}return u}convertInputToLines(n){if(!n)return[];let a=n.trim().split(/[\n]/),o=[];for(let i=0;i<a.length;i++){let c=a[i].match(/(\d+ [A-z]{3})(\u20ac.*(Credit|Debit))/);if(c){let[l,u,p]=c;o.push(`${u} | 12:00`,p)}else o.push(a[i])}return o.filter(i=>""!==i.trim()&&"Reserved"!==i.trim()&&"Extra Card"!==i.trim())}currentDate(){return new Date}extractDate(n){let a=this.currentDate().getFullYear(),o=n.match(/(\d+) ([A-z]{3}) | .+/),[i,c,l]=o;const u=c.padStart(2,"0");return`${a}-${{Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"}[l]}-${u}`}extractAmount(n){let a=n.match(/\u20ac(.*)(Credit|Debit)/),[o,i,c]=a,l=Math.floor(100*Number(i.replace(".","").replace(",",".")));return"Credit"===c?l:-1*l}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),E=(()=>{class e{constructor(){}convertToTransactions(n,a,o){let u,p,m,h,i=new Date(a),c=new Date(o),l=[],A="";return this._convertInputToLines(n).forEach(d=>{if(this.isDate(d))p=this.extractDate(d);else{if(this.isNumber(d)){let g=this.extractNumberParts(d);"+"===g.sign?(h=g.amount,m=0):(h=0,m=g.amount)}else"NL"!==d.substr(0,2)&&(A+=d);this.isEndOfTransaction(d)&&(u={transaction_date:p,description:A,withdrawal_amount:m,deposit_amount:h,status:"unpaid"},(u.transaction_date<i||u.transaction_date>c)&&(u.deleted=!0),0===u.withdrawal_amount&&0===u.deposit_amount&&(u.deleted=!0),u.transaction_date=u.transaction_date.toISOString().substr(0,10),l.push(u),A="",m=0,h=0)}}),l}_convertInputToLines(n){return n?n.split(/[\n]/):[]}isDate(n){return!!n&&(n.match(/(\d\d?) ([A-z]{3}) `(\d\d)/)||this.isNewDateFormat(n))}isNewDateFormat(n){return n.match(/^(\d{2})\-(\d{2})\-(\d{4})/)}extractDate(n){if(!this.isDate(n))return;let a=this.isNewDateFormat(n);return a?new Date(`${a[3]}-${a[2]}-${a[1]}`):new Date(n.replace(/`/g,""))}isNumber(n){let a=n.trim().substr(0,1);return"-"===a||"+"===a||"\u20ac"===a}extractNumberParts(n){"\u20ac"===n.substr(0,1)&&(n=n.substr(1));let a=n.trim().substr(0,1),o=n.substring(1).trim().replace(/\./g,"").replace(/,/g,".");return{sign:a,amount:100*Number(o)}}isEndOfTransaction(n){return this.isNumber(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),$=(()=>{class e{constructor(n,a){this.creditCardImporter=n,this.oldImporter=a}convertFromCreditCardFormat(n,a,o){return this.creditCardImporter.convertToTransactions(n,a,o)}convertFromOldBankFormat(n,a,o){return this.oldImporter.convertToTransactions(n,a,o)}convertFromBankFormat(n,a,o){let u,p,m,h,i=new Date(a),c=new Date(o),l=[],A="",C=this._convertInputToLines(n);return console.log(C),C.forEach(d=>{if(!this.isBlank(d)&&(console.log(d),!this.isSkippableText(d))){if(this.isDescription(d))return void(A=d);if(this.isDate(d))return void(p=this.extractDate(d));if(this.isNumber(d)){let g=this.extractAmount(d);g<0?(m=Math.abs(g),h=0):(m=0,h=g),u={transaction_date:p,description:A,withdrawal_amount:m,deposit_amount:h,status:"paid"},(u.transaction_date<i||u.transaction_date>c)&&(u.deleted=!0),0===u.withdrawal_amount&&0===u.deposit_amount&&(u.deleted=!0),u.transaction_date&&u.transaction_date.toISOString&&(u.transaction_date=u.transaction_date.toISOString().substring(0,10)),l.push(u),A="",m=0,h=0}}}),l}_convertInputToLines(n){return n?n.split(/[\n]/):[]}isDate(n){return!!n&&("today"===n||"yesterday"===n||this.isFormattedDate(n))}isFormattedDate(n){const a={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};let o=n.match(/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{1,2}) ([A-z]{3}) /);return o?{day:o[2],month:a[o[3]],year:this.currentDate().getFullYear()}:(o=n.match(/^([A-z]+) (\d{1,2}), (\d{4})/),!!o&&{month:a[o[1]],day:o[2],year:o[3]})}currentDate(){return new Date}extractDate(n,a=this.currentDate()){if(!this.isDate(n))return;if("today"===n)return a;if("yesterday"===n){let i=new Date(a.valueOf());return i.setDate(i.getDate()-1),i}let o=this.isFormattedDate(n);return new Date(o.year,o.month,o.day,10)}isAmount(n){return!this.isDate(n)&&n.trim().replace(/\,/g,"").match(/([+-]) (\d*.?\d*)/)}extractAmount(n){let a=this.isAmount(n);if(!a)return 0;let[o,i,c]=a,l=Number(c);return l=Math.ceil(100*l),"-"===i?-1*l:l}isBlank(n){return!n||""===n.trim()}isSkippableText(n){return!(2!==n.length&&!n.match(/^(Yesterday|Today|January|February|March|April|May|June|July|August|September|October|November|December)/)&&(this.isDate(n),1))}isDescription(n){return!this.isBlank(n)&&!this.isDate(n)&&!this.isAmount(n)&&n.length>2}isNumber(n){let a=n.trim().substring(0,1);return"-"===a||"+"===a||"\u20ac"===a}isEndOfTransaction(n){return this.isAmount(n)}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(U),t.LFG(E))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),P=(()=>{class e{constructor(){}convertFromCreditCardFormat(n,a,o){throw new Error("not implemented yet")}convertFromBankFormat(n,a,o){return this._convertInputToLines(n).map(c=>this._convertFCBankLineDataToTransaction(c,a,o))}_convertInputToLines(n){return n?n.split(/[\n]/):[]}_convertFCBankLineDataToTransaction(n,a,o){let i={},c=n.split("\t");i.transaction_date=new Date(c[0]),i.description=c[1];let u=c[3];i.withdrawal_amount=this.extractNumberFromDollarString(c[2]),i.deposit_amount=this.extractNumberFromDollarString(u);let p=new Date(a),m=new Date(o);return(i.transaction_date<p||i.transaction_date>m)&&(i.deleted=!0),0===i.withdrawal_amount&&0===i.deposit_amount&&(i.deleted=!0),i}extractNumberFromDollarString(n){if(!n)return 0;let a=n.replace(/\$/g,"");return 100*Number(a.replace(/,/g,""))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),G=(()=>{class e{constructor(){}convertToTransactions(n,a,o,i){return this._convertFromNewTransactionFormat(n,a,o,i)}_convertFromNewTransactionFormat(n,a,o,i){let c=this._convertInputToLines(n),l=this._convertLinesToTransactionData(c);return this._convertTransactionArrayDataToTransactions(l,a,o,i)}_convertInputToLines(n){return n?n.split(/[\n]/):[]}_convertLinesToTransactionData(n){if(n===[])return[];let o=[],i=0,c=[];return n.forEach(l=>{c.push(l),i++,i>=4&&(o.push(c),c=[],i=0)}),o}_convertTransactionArrayDataToTransactions(n,a,o,i){return n.map(c=>this._convertTransactionArrayToTransaction(c,a,o,i))}_convertTransactionArrayToTransaction(n,a,o,i){if(4!==n.length)return{};let c=n[0],u=n[2],p=n[3],m=n[1].match(/^(\d{4})\s+(.*)$/),h="",A="";3!==m.length?(h="",A=""):(h=m[1],A=m[2]);let C=p.match(/^\s*(-?)\$(.*?)\sTTD/),d="",g="";3!==C.length?(d="",g="0"):(d=C[1],g=C[2]);let _={};_.transaction_date=new Date(c+" "+h),_.description=A+" "+u;let at=Number(g.replace(/,/g,""));if(""===d?(_.deposit_amount=100*at,_.withdrawal_amount=0):(_.deposit_amount=0,_.withdrawal_amount=100*at),"credit-card"===i){let Jn=_.withdrawal_amount;_.withdrawal_amount=_.deposit_amount,_.deposit_amount=Jn}let Nn=new Date(a),Ln=new Date(o);return(_.transaction_date<Nn||_.transaction_date>Ln)&&(_.deleted=!0),0===_.withdrawal_amount&&0===_.deposit_amount&&(_.deleted=!0),_}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),it=(()=>{class e{constructor(){}convertFromBankFormat(n,a,o){return this._convertInputToLines(n).map(c=>this.convertLineToTransaction(c,a,o))}_convertInputToLines(n){return n?n.trim().split(/[\n]/):[]}convertLineToTransaction(n,a,o){if(!n)return{};let i=n.trim().split(/[\t]/),c={withdrawal_amount:0,deposit_amount:0,status:"paid"},[l,u,p,m,h,A,C]=i;c.transaction_date=this.extractDate(u),c.description=m;let d=this.extractAmount(C);d<0?c.withdrawal_amount=-1*d:d>0&&(c.deposit_amount=d);let g=new Date(a),_=new Date(o);return(c.transaction_date<g||c.transaction_date>_)&&(c.deleted=!0),0===c.withdrawal_amount&&0===c.deposit_amount&&(c.deleted=!0),c.transaction_date&&c.transaction_date.toISOString&&(c.transaction_date=c.transaction_date.toISOString().substr(0,10)),c}extractDate(n){if(!n)return;let a=n.match(/(\d\d?)-(\d\d)-(\d\d\d\d)/);if(!a)return;let[o,i,c,l]=a;return new Date(Number(l),Number(c)-1,Number(i),10)}extractAmount(n){return 100*Number(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),q=(()=>{class e{constructor(n,a,o,i){this.fcbImporter=n,this.abnAmroImporter=a,this.scotiaImporter=o,this.republicImporter=i}convertToTransactions(n,a,o,i){return"fc-bank"===i?this.fcbImporter.convertFromBankFormat(n,a,o):"fc-creditcard"===i?this.fcbImporter.convertFromCreditCardFormat(n,a,o):"abn-amro-bank"===i?this.abnAmroImporter.convertFromBankFormat(n,a,o):"abn-amro-bank-old"===i?this.abnAmroImporter.convertFromOldBankFormat(n,a,o):"abn-amro-creditcard"===i?this.abnAmroImporter.convertFromCreditCardFormat(n,a,o):"republic-bank"===i?this.republicImporter.convertFromBankFormat(n,a,o):this.scotiaImporter.convertToTransactions(n,a,o,i)}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(P),t.LFG($),t.LFG(G),t.LFG(it))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),rt=[q,P,G,$,E,U],ct=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[...rt],imports:[I.m]}),e})();var F=s(5529),R=s(6053),B=s(4850),H=s(5778),N=s(7545),W=s(7369);let L=(()=>{class e{constructor(n){this.apiGateway=n}getTransactions(n={}){let a=Object.assign({no_bank_account:!0},n);return delete a.budget,delete a.bankAccount,this.apiGateway.get("/transactions",a)}save(n,a,o){let i=this.extractValidTransactionsInBudget(n,o);return this.apiGateway.post("/transactions",{bank_account_id:a.id,budget_id:o.id,transactions:i})}extractValidTransactionsInBudget(n,a){let o=new Date(a.start_date),i=new Date(a.end_date);return n.filter(c=>{let l;return l="string"==typeof c.transaction_date?new Date(c.transaction_date):c.transaction_date,!c.deleted&&l>=o&&l<=i})}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(W.i))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})();var j=s(4900),J=s(6497);let V=(()=>{class e{constructor(n,a,o){this.transactionService=n,this.budgetService=a,this.bankAccountService=o,this.searchParamsSubject=new F.xQ}init(){this.searchParamsSubject=new F.xQ}searchParams$(){return this.searchParamsSubject.asObservable()}budgetId$(){return this.searchParams$().pipe((0,B.U)(n=>n.budget_id))}bankAccountId$(){return this.searchParams$().pipe((0,B.U)(n=>n.bank_account_id))}distinctBankAccountId$(){return this.bankAccountId$().pipe((0,H.x)())}distinctBudgetId$(){return this.budgetId$().pipe((0,H.x)())}transactions$(){return this.searchParams$().pipe((0,N.w)(n=>this.transactionService.getTransactions(n)))}allocations$(){return this.budgetId$().pipe((0,N.w)(n=>this.budgetService.getAllocations(n)))}sinkFundAllocation$(){return this.distinctBankAccountId$().pipe((0,N.w)(n=>this.bankAccountService.getSinkFundAllocations(n)))}refresh(n){this.searchParamsSubject.next(n)}allData$(){return(0,R.aj)(this.transactions$(),this.allocations$(),this.sinkFundAllocation$())}destroy(){this.searchParamsSubject.complete()}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(L),t.LFG(j.t),t.LFG(J.A))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})();var k=s(6630),z=s(7625),v=s(5412),y=s(6895),f=s(4006),x=s(277),M=s(4859),w=s(9549),O=s(4385),Z=s(3238);function st(e,r){if(1&e&&(t.TgZ(0,"mat-option",7),t._uU(1),t.qZA()),2&e){const n=r.$implicit;t.Q6J("value",n.value),t.xp6(1),t.Oqu(n.text)}}let lt=(()=>{class e{constructor(n,a){this.importerService=n,this.dialogRef=a,this.options=[{text:"ABN Amro Bank Account",value:"abn-amro-bank"},{text:"ABN Amro Bank Account (old format)",value:"abn-amro-bank-old"},{text:"ABN Amro Credit Card",value:"abn-amro-creditcard"},{text:"Scotia Bank Account",value:"new-bank-account"},{text:"FCB Bank Account",value:"fc-bank"},{text:"FCB Credit Card (not implemented)",value:"fc-creditcard"},{text:"Republic Bank Account",value:"republic-bank"},{text:"Republic Credit Card (not implemented)",value:"republic-creditcard"}],this.importType="abn-amro-bank",this.import=new t.vpe}ngOnInit(){}importTransactions(){let n=this.importerService.convertToTransactions(this.input,this.startDate,this.endDate,this.importType);this.import.emit(n),this.dialogRef.close(n)}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(q),t.Y36(v.so))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-transaction-importer"]],inputs:{startDate:"startDate",endDate:"endDate",importType:"importType"},outputs:{import:"import"},decls:14,vars:3,consts:[["mat-dialog-title",""],["fxLayout","column","fxFlex",""],["rows","5","cols","10","placeholder","Copy the transactions from your bank here",3,"ngModel","ngModelChange"],["placeholder","Import Format",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"click"],["mat-raised-button","","mat-dialog-close",""],[3,"value"]],template:function(n,a){1&n&&(t.TgZ(0,"h1",0),t._uU(1,"Import Transactions"),t.qZA(),t.TgZ(2,"mat-dialog-content")(3,"div",1)(4,"textarea",2),t.NdJ("ngModelChange",function(i){return a.input=i}),t._uU(5,"        "),t.qZA(),t.TgZ(6,"mat-form-field")(7,"mat-select",3),t.NdJ("ngModelChange",function(i){return a.importType=i}),t.YNc(8,st,2,2,"mat-option",4),t.qZA()()()(),t.TgZ(9,"mat-dialog-actions")(10,"button",5),t.NdJ("click",function(){return a.importTransactions()}),t._uU(11," Import "),t.qZA(),t.TgZ(12,"button",6),t._uU(13,"Cancel"),t.qZA()()),2&n&&(t.xp6(4),t.Q6J("ngModel",a.input),t.xp6(3),t.Q6J("ngModel",a.importType),t.xp6(1),t.Q6J("ngForOf",a.options))},dependencies:[y.sg,f.Fj,f.JJ,f.On,x.xw,x.yH,M.lW,v.ZT,v.uh,v.xY,v.H8,w.KE,O.gD,Z.ey],encapsulation:2}),e})();var b=s(2143),ut=s(2289),T=s(3546),K=s(6709),X=s(1637),dt=s(7333),mt=s(6326),pt=s(5552),_t=s(6786),D=s(1769);function ft(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"mat-checkbox",2),t.NdJ("change",function(o){t.CHM(n);const i=t.oxw();return t.KtG(i.updateInnerValue(o))}),t.qZA()}if(2&e){const n=t.oxw();t.Q6J("formControl",n.control)}}function ht(e,r){if(1&e&&(t.TgZ(0,"span",3),t._uU(1),t.qZA()),2&e){const n=t.oxw();t.xp6(1),t.Oqu(n.paidStatusDisplay)}}let gt=(()=>{class e{constructor(){this.editMode=!1,this.control=new f.p4(!1),this.onChange=n=>{},this.onTouch=()=>{}}get paidStatusDisplay(){return"paid"===this.innerValue?"Yes":"unpaid"===this.innerValue?"No":"Unknown"}get value(){return this.innerValue}set value(n){this.innerValue=n,this.control.setValue("paid"===this.value)}ngOnInit(){}updateInnerValue(n){this.innerValue=n.checked?"paid":"unpaid",this.onChange(this.innerValue)}writeValue(n){this.value=n}registerOnChange(n){this.onChange=n}registerOnTouched(n){this.onTouch=n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-paid-field"]],inputs:{editMode:"editMode",innerValue:"innerValue"},features:[t._Bn([{provide:f.JU,multi:!0,useExisting:(0,t.Gpc)(()=>e)}])],decls:3,vars:2,consts:[["color","primary",3,"formControl","change",4,"ngIf","ngIfElse"],["textDisplay",""],["color","primary",3,"formControl","change"],[1,"value"]],template:function(n,a){if(1&n&&(t.YNc(0,ft,1,1,"mat-checkbox",0),t.YNc(1,ht,2,1,"ng-template",null,1,t.W1O)),2&n){const o=t.MAs(2);t.Q6J("ngIf",a.editMode)("ngIfElse",o)}},dependencies:[y.O5,f.JJ,f.oH,K.oG],encapsulation:2}),e})();var tt=s(8759),Tt=s(3977);function At(e,r){1&e&&t._UZ(0,"th",26)}function Ct(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"td",27),t._uU(1),t.TgZ(2,"mat-checkbox",28),t.NdJ("ngModelChange",function(o){const c=t.CHM(n).$implicit;return t.KtG(c.selected=o)}),t.qZA()()}if(2&e){const n=r.$implicit;t.xp6(1),t.hij(" ",n.item," "),t.xp6(1),t.Q6J("ngModel",n.selected)}}function bt(e,r){1&e&&t._UZ(0,"td",29)}function vt(e,r){1&e&&(t.TgZ(0,"th",30),t._uU(1,"Date"),t.qZA())}function xt(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"td",31)(1,"ec-date-field",32),t.NdJ("ngModelChange",function(o){const c=t.CHM(n).$implicit;return t.KtG(c.transaction_date=o)}),t.qZA()()}if(2&e){const n=r.$implicit,a=t.oxw();t.xp6(1),t.Q6J("editMode",a.isEditMode)("ngModel",n.transaction_date)("ecValidateWithinBudget",a.budget)("errorMessage","test")}}function yt(e,r){1&e&&t._UZ(0,"td",29)}function Mt(e,r){1&e&&(t.TgZ(0,"th",33),t._uU(1," Description "),t.qZA())}function Ft(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"td",27)(1,"ec-text-field",34),t.NdJ("ngModelChange",function(o){const c=t.CHM(n).$implicit;return t.KtG(c.description=o)}),t.qZA()()}if(2&e){const n=r.$implicit,a=t.oxw();t.xp6(1),t.Q6J("editMode",a.isEditMode)("ngModel",n.description)}}function kt(e,r){1&e&&(t.TgZ(0,"td",29),t._uU(1,"Total"),t.qZA())}function wt(e,r){if(1&e&&(t.TgZ(0,"th",35),t._uU(1),t.qZA()),2&e){const n=t.oxw();t.xp6(1),t.hij(" ",n.allocationHeaderName()," ")}}function Zt(e,r){1&e&&t.GkF(0)}function Dt(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"ec-list-field",39),t.NdJ("ngModelChange",function(o){t.CHM(n);const i=t.oxw().$implicit;return t.KtG(i.sink_fund_allocation_id=o)}),t.qZA()}if(2&e){const n=t.oxw().$implicit,a=t.oxw();t.Q6J("editMode",a.isEditMode)("items",a.sinkFundAllocations)("ngModel",n.sink_fund_allocation_id)}}function St(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"ec-list-field",40),t.NdJ("change",function(){t.CHM(n);const o=t.oxw().$implicit,i=t.oxw();return t.KtG(i.updatePaidStatus(o))})("ngModelChange",function(o){t.CHM(n);const i=t.oxw().$implicit;return t.KtG(i.allocation_id=o)}),t.qZA()}if(2&e){const n=t.oxw().$implicit,a=t.oxw();t.Q6J("editMode",a.isEditMode)("items",a.allocations)("ngModel",n.allocation_id)}}function It(e,r){if(1&e&&(t.TgZ(0,"td",27),t.YNc(1,Zt,1,0,"ng-container",36),t.YNc(2,Dt,1,3,"ng-template",null,37,t.W1O),t.YNc(4,St,1,3,"ng-template",null,38,t.W1O),t.qZA()),2&e){const n=t.MAs(3),a=t.MAs(5),o=t.oxw();t.xp6(1),t.Q6J("ngIf",null==o.bankAccount?null:o.bankAccount.is_sink_fund)("ngIfThen",n)("ngIfElse",a)}}function Bt(e,r){1&e&&(t.TgZ(0,"td",29),t._uU(1,"Allocation"),t.qZA())}function Nt(e,r){1&e&&(t.TgZ(0,"th",41),t._uU(1," Withdrawn "),t.qZA())}function Lt(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"td",42)(1,"ec-money-field",34),t.NdJ("ngModelChange",function(o){const c=t.CHM(n).$implicit;return t.KtG(c.withdrawal_amount=o)}),t.qZA()()}if(2&e){const n=r.$implicit,a=t.oxw();t.xp6(1),t.Q6J("editMode",a.isEditMode)("ngModel",n.withdrawal_amount)}}function Jt(e,r){1&e&&t._UZ(0,"td",29)}function Ot(e,r){1&e&&(t.TgZ(0,"th",41),t._uU(1," Deposited "),t.qZA())}function Qt(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"td",42)(1,"ec-money-field",34),t.NdJ("ngModelChange",function(o){const c=t.CHM(n).$implicit;return t.KtG(c.deposit_amount=o)}),t.qZA()()}if(2&e){const n=r.$implicit,a=t.oxw();t.xp6(1),t.Q6J("editMode",a.isEditMode)("ngModel",n.deposit_amount)}}function Yt(e,r){1&e&&t._UZ(0,"td",29)}function Ut(e,r){1&e&&(t.TgZ(0,"th",26),t._uU(1,"Paid?"),t.qZA())}function Et(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"td",43)(1,"ec-paid-field",34),t.NdJ("ngModelChange",function(o){const c=t.CHM(n).$implicit;return t.KtG(c.status=o)}),t.qZA()()}if(2&e){const n=r.$implicit,a=t.oxw();t.xp6(1),t.Q6J("editMode",a.isEditMode)("ngModel",n.status)}}function $t(e,r){1&e&&t._UZ(0,"td",29)}function Pt(e,r){1&e&&(t.TgZ(0,"th",26),t._uU(1," Action "),t.qZA())}function Gt(e,r){if(1&e&&(t.TgZ(0,"td",43),t._UZ(1,"ec-delete-button",44),t.qZA()),2&e){const n=r.$implicit,a=t.oxw();t.xp6(1),t.Q6J("editMode",a.isEditMode)("item",n)}}function qt(e,r){1&e&&t._UZ(0,"td",29)}function Rt(e,r){1&e&&t._UZ(0,"tr",45)}function Ht(e,r){1&e&&t._UZ(0,"tr",46),2&e&&t.Q6J("ecHighlightDeletedFor",r.$implicit)}function Wt(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"button",47),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.addTransaction())}),t._uU(1," Add New Transaction "),t.qZA()}}function jt(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"button",48),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.import.emit())}),t._uU(1," Import Transactions "),t.qZA()}}function Vt(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"button",49),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.transfer.emit())}),t._uU(1," Transfer "),t.qZA()}}let nt=(()=>{class e{constructor(n){this.transactions=[],this.allocations=[],this.sinkFundAllocations=[],this.isEditMode=!1,this.save=new t.vpe,this.transfer=new t.vpe,this.import=new t.vpe,this.cancel=new t.vpe,this.DESKTOP_COLUMNS=["selection","date","description","allocation","withdrawn","deposit","paid","action"],this.MOBILE_COLUMNS=["date","description","allocation","withdrawn","deposit","action"],this.displayedColumns=[],this._mobileQueryListener=a=>{this.displayedColumns=a.matches?this.MOBILE_COLUMNS:this.DESKTOP_COLUMNS},this.mobileQuery=n.matchMedia("(max-width: 600px)"),this.mobileQuery.addListener(this._mobileQueryListener)}ngOnInit(){this._mobileQueryListener(this.mobileQuery)}addTransaction(){this.transactions.push({withdrawal_amount:0,deposit_amount:0,status:this.bankAccount.is_credit_card?"unpaid":"paid"}),this.transactionList.renderRows()}allocationHeaderName(){return this.bankAccount&&this.bankAccount.is_sink_fund?"Sink Fund Allocation":"Allocation"}trackByFn(n,a){return a.id}switchToDisplayMode(){this.isEditMode=!1}linkToBudget(){return this.budget?`/budgets/${this.budget.id}`:"/budgets"}updatePaidStatus(n){n.status=n.allocation_id>0?"paid":"unpaid"}ngOnDestroy(){this.mobileQuery.removeListener(this._mobileQueryListener)}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(ut.vx))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-transaction-list"]],viewQuery:function(n,a){if(1&n&&t.Gf(b.BZ,7),2&n){let o;t.iGM(o=t.CRH())&&(a.transactionList=o.first)}},inputs:{transactions:"transactions",allocations:"allocations",sinkFundAllocations:"sinkFundAllocations",bankAccount:"bankAccount",budget:"budget",isEditMode:"isEditMode"},outputs:{save:"save",transfer:"transfer",import:"import",cancel:"cancel"},decls:43,vars:9,consts:[[1,"table-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource","trackBy"],["matColumnDef","selection"],["mat-header-cell","","style","width:5%;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","style","width:15%;",4,"matCellDef"],["matColumnDef","description"],["mat-header-cell","","style","width:30%;",4,"matHeaderCellDef"],["matColumnDef","allocation"],["mat-header-cell","","style","width:20%;",4,"matHeaderCellDef"],["matColumnDef","withdrawn"],["mat-header-cell","","style","width:10%;","class","right",4,"matHeaderCellDef"],["mat-cell","","class","right",4,"matCellDef"],["matColumnDef","deposit"],["matColumnDef","paid"],["mat-cell","","class","center",4,"matCellDef"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"ecHighlightDeletedFor",4,"matRowDef","matRowDefColumns"],[3,"editMode","editModeChange","save","cancel"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","class","transfer","color","accent",3,"click",4,"ngIf"],["mat-header-cell","",2,"width","5%"],["mat-cell",""],["color","primary",3,"ngModel","ngModelChange"],["mat-footer-cell",""],["mat-header-cell",""],["mat-cell","",2,"width","15%"],[3,"editMode","ngModel","ecValidateWithinBudget","errorMessage","ngModelChange"],["mat-header-cell","",2,"width","30%"],[3,"editMode","ngModel","ngModelChange"],["mat-header-cell","",2,"width","20%"],[4,"ngIf","ngIfThen","ngIfElse"],["sinkFundAllocationField",""],["allocationField",""],[3,"editMode","items","ngModel","ngModelChange"],["groupBy","allocation_category",3,"editMode","items","ngModel","change","ngModelChange"],["mat-header-cell","",1,"right",2,"width","10%"],["mat-cell","",1,"right"],["mat-cell","",1,"center"],[3,"editMode","item"],["mat-header-row",""],["mat-row","",3,"ecHighlightDeletedFor"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","accent",1,"transfer",3,"click"]],template:function(n,a){1&n&&(t.TgZ(0,"mat-card")(1,"mat-card-content")(2,"div",0)(3,"table",1),t.ynx(4,2),t.YNc(5,At,1,0,"th",3),t.YNc(6,Ct,3,2,"td",4),t.YNc(7,bt,1,0,"td",5),t.BQk(),t.ynx(8,6),t.YNc(9,vt,2,0,"th",7),t.YNc(10,xt,2,4,"td",8),t.YNc(11,yt,1,0,"td",5),t.BQk(),t.ynx(12,9),t.YNc(13,Mt,2,0,"th",10),t.YNc(14,Ft,2,2,"td",4),t.YNc(15,kt,2,0,"td",5),t.BQk(),t.ynx(16,11),t.YNc(17,wt,2,1,"th",12),t.YNc(18,It,6,3,"td",4),t.YNc(19,Bt,2,0,"td",5),t.BQk(),t.ynx(20,13),t.YNc(21,Nt,2,0,"th",14),t.YNc(22,Lt,2,2,"td",15),t.YNc(23,Jt,1,0,"td",5),t.BQk(),t.ynx(24,16),t.YNc(25,Ot,2,0,"th",14),t.YNc(26,Qt,2,2,"td",15),t.YNc(27,Yt,1,0,"td",5),t.BQk(),t.ynx(28,17),t.YNc(29,Ut,2,0,"th",3),t.YNc(30,Et,2,2,"td",18),t.YNc(31,$t,1,0,"td",5),t.BQk(),t.ynx(32,19),t.YNc(33,Pt,2,0,"th",3),t.YNc(34,Gt,2,2,"td",18),t.YNc(35,qt,1,0,"td",5),t.BQk(),t.YNc(36,Rt,1,0,"tr",20),t.YNc(37,Ht,1,1,"tr",21),t.qZA()()(),t.TgZ(38,"mat-card-actions")(39,"ec-edit-actions",22),t.NdJ("editModeChange",function(i){return a.isEditMode=i})("save",function(){return a.save.emit(a.transactions)})("cancel",function(){return a.cancel.emit()}),t.YNc(40,Wt,2,0,"button",23),t.YNc(41,jt,2,0,"button",24),t.YNc(42,Vt,2,0,"button",25),t.qZA()()()),2&n&&(t.xp6(3),t.Q6J("dataSource",a.transactions)("trackBy",a.trackByFn),t.xp6(33),t.Q6J("matHeaderRowDef",a.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(2),t.Q6J("editMode",a.isEditMode),t.xp6(1),t.Q6J("ngIf",a.isEditMode),t.xp6(1),t.Q6J("ngIf",a.isEditMode),t.xp6(1),t.Q6J("ngIf",a.isEditMode))},dependencies:[y.O5,f.JJ,f.On,M.lW,T.a8,T.dn,T.hq,K.oG,b.BZ,b.fO,b.as,b.w1,b.Dz,b.nj,b.mD,b.ge,b.ev,b.yh,b.XQ,b.Gk,X.Q,dt.t,mt.Y,pt.O,_t.d,D.x,gt,tt.a,Tt.Q],styles:["table[_ngcontent-%COMP%]{width:100%;table-layout:fixed}ec-money-field[_ngcontent-%COMP%]{text-align:end}td[mat-cell][_ngcontent-%COMP%]{padding-left:5px;padding-right:5px}.mat-form-field-infix[_ngcontent-%COMP%]{width:5px}.menu-heading[_ngcontent-%COMP%]{justify-content:space-between}mat-card-content[_ngcontent-%COMP%]{margin-left:-24px;margin-right:-24px}mat-card[_ngcontent-%COMP%]{height:calc(100% - 48px);overflow:auto;display:flex;flex-direction:column}mat-card-content[_ngcontent-%COMP%]{height:calc(100% - 24px);overflow:auto}"]}),e})();var zt=s(3786);let Kt=(()=>{class e{constructor(n){this.apiGateway=n}transfer(n){return this.apiGateway.post(`/bank_accounts/${n.from}/transfer`,n)}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(W.i))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var et=s(8731),Q=s(2205);const Xt=["amount"];function tn(e,r){if(1&e&&(t.TgZ(0,"mat-option",16),t._uU(1),t.TgZ(2,"em"),t._uU(3),t.ALo(4,"ecMoney"),t.qZA()()),2&e){const n=r.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij("",n.name," "),t.xp6(2),t.hij("(",t.lcZ(4,3,n.current_balance),")")}}function nn(e,r){1&e&&t.GkF(0)}function en(e,r){if(1&e&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&e){const n=r.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij("",n.name," ")}}function an(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"mat-select",17),t.NdJ("ngModelChange",function(o){t.CHM(n);const i=t.oxw();return t.KtG(i.accountTransfer.from_sink_fund_allocation=o)}),t._UZ(1,"mat-option",16),t.YNc(2,en,2,2,"mat-option",2),t.qZA()}if(2&e){const n=t.oxw();t.Q6J("ngModel",n.accountTransfer.from_sink_fund_allocation),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Q6J("ngForOf",n.sinkFundAllocationsFrom)}}function on(e,r){if(1&e&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&e){const n=r.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij("",n.name," ")}}function rn(e,r){if(1&e&&(t.TgZ(0,"mat-optgroup",20),t.YNc(1,on,2,2,"mat-option",2),t.qZA()),2&e){const n=r.$implicit;t.Q6J("label",n.name),t.xp6(1),t.Q6J("ngForOf",n.allocations)}}function cn(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"mat-select",18),t.NdJ("ngModelChange",function(o){t.CHM(n);const i=t.oxw();return t.KtG(i.accountTransfer.from_allocation=o)}),t._UZ(1,"mat-option",16),t.YNc(2,rn,2,2,"mat-optgroup",19),t.qZA()}if(2&e){const n=t.oxw();t.Q6J("ngModel",n.accountTransfer.from_allocation),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Q6J("ngForOf",n.allocationCategories)("ngForTrackBy",n.trackById)}}function sn(e,r){if(1&e&&(t.TgZ(0,"mat-option",16),t._uU(1),t.TgZ(2,"em"),t._uU(3),t.ALo(4,"ecMoney"),t.qZA()()),2&e){const n=r.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij("",n.name," "),t.xp6(2),t.hij("(",t.lcZ(4,3,n.current_balance),")")}}function ln(e,r){1&e&&t.GkF(0)}function un(e,r){if(1&e&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&e){const n=r.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij("",n.name," ")}}function dn(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"mat-select",21),t.NdJ("ngModelChange",function(o){t.CHM(n);const i=t.oxw();return t.KtG(i.accountTransfer.to_sink_fund_allocation=o)}),t._UZ(1,"mat-option",16),t.YNc(2,un,2,2,"mat-option",2),t.qZA()}if(2&e){const n=t.oxw();t.Q6J("ngModel",n.accountTransfer.to_sink_fund_allocation),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Q6J("ngForOf",n.sinkFundAllocationsTo)}}function mn(e,r){if(1&e&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&e){const n=r.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij("",n.name," ")}}function pn(e,r){if(1&e&&(t.TgZ(0,"mat-optgroup",20),t.YNc(1,mn,2,2,"mat-option",2),t.qZA()),2&e){const n=r.$implicit;t.Q6J("label",n.name),t.xp6(1),t.Q6J("ngForOf",n.allocations)}}function _n(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"mat-select",22),t.NdJ("ngModelChange",function(o){t.CHM(n);const i=t.oxw();return t.KtG(i.accountTransfer.to_allocation=o)}),t._UZ(1,"mat-option",16),t.YNc(2,pn,2,2,"mat-optgroup",19),t.qZA()}if(2&e){const n=t.oxw();t.Q6J("ngModel",n.accountTransfer.to_allocation),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Q6J("ngForOf",n.allocationCategories)("ngForTrackBy",n.trackById)}}let fn=(()=>{class e{constructor(n,a,o,i){this.bankAccountService=n,this.transferService=a,this.messageService=o,this.dialogRef=i,this.fromAccount={},this.toAccount={},this.bankAccounts=[],this.budget={},this.allocations=[],this.allocationCategories=[],this.sinkFundAllocationsFrom=[],this.sinkFundAllocationsTo=[],this.accountTransfer={from:0,to:0,amount:0,description:"",date:(new Date).toISOString().substr(0,10)}}ngOnInit(){setTimeout(()=>{this.bankAccountService.getBankAccountsWithBalances().subscribe(n=>this.bankAccounts=n)},0)}findAccountById(n){return this.bankAccounts.find(a=>a.id===n)||{current_balance:0}}setBudget(n){this.budget=n,this.allocations=n.allocations;let a=(0,zt.Z)(this.allocations,"allocation_category_id");this.allocationCategories=Object.keys(a).map(o=>{let i=a[o],c={id:Number(o)};return c.name=i[0].allocation_category.name,c.allocations=i,c}).sort((o,i)=>String(o.name).localeCompare(i.name)),this.accountTransfer.budget_id=this.budget.id}selectFromBankAccount(){const n=this.bankAccounts.find(a=>a.id===this.accountTransfer.from)||{};this.fromAccount=n,n.is_sink_fund?this.bankAccountService.getSinkFundAllocations(n.id).subscribe(a=>this.sinkFundAllocationsFrom=a):this.sinkFundAllocationsFrom=[]}selectToBankAccount(){const n=this.bankAccounts.find(a=>a.id===this.accountTransfer.to)||{};this.toAccount=n,n.is_sink_fund?this.bankAccountService.getSinkFundAllocations(n.id).subscribe(a=>this.sinkFundAllocationsTo=a):this.sinkFundAllocationsTo=[]}newFromBalance(){return this.findAccountById(this.accountTransfer.from).current_balance-this.accountTransfer.amount}newToBalance(){return this.findAccountById(this.accountTransfer.to).current_balance+this.accountTransfer.amount}save(){this.transferService.transfer(this.accountTransfer).subscribe(n=>{this.messageService.setMessage("Transfer completed."),this.dialogRef.close()},n=>{this.messageService.setErrorMessage("Error: "+(n.error&&n.error.reason)||0)})}cancel(){this.dialogRef.close()}trackById(n,a){return a.id}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(J.A),t.Y36(Kt),t.Y36(et.e),t.Y36(v.so))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-transfer-form"]],viewQuery:function(n,a){if(1&n&&t.Gf(Xt,7,D.x),2&n){let o;t.iGM(o=t.CRH())&&(a.amountField=o.first)}},decls:36,vars:24,consts:[["mat-dialog-title",""],["placeholder","From","data-cy-from-field","",3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["align","end"],[4,"ngIf","ngIfThen","ngIfElse"],["sinkFundAllocationFrom",""],["allocationFrom",""],["placeholder","To","data-cy-to-field","",3,"ngModel","ngModelChange","selectionChange"],["sinkFundAllocationTo",""],["allocationTo",""],[3,"editMode","ngModel","ecValidateWithinBudget","errorMessage","ngModelChange"],["data-cy-description-field","","placeholder","Description",3,"editMode","ngModel","ngModelChange"],["data-cy-amount-field","","placeholder","Amount",3,"editMode","ngModel","ngModelChange"],["fxLayout","row","fxLayoutAlign","space-around",1,"actions"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"],[3,"value"],["placeholder","From Sink Fund Allocation",3,"ngModel","ngModelChange"],["placeholder","From Allocation",3,"ngModel","ngModelChange"],[3,"label",4,"ngFor","ngForOf","ngForTrackBy"],[3,"label"],["placeholder","To Sink Fund Allocation",3,"ngModel","ngModelChange"],["placeholder","To Allocation",3,"ngModel","ngModelChange"]],template:function(n,a){if(1&n&&(t.TgZ(0,"h1",0),t._uU(1,"Bank Account Transfer"),t.qZA(),t.TgZ(2,"mat-dialog-content")(3,"mat-form-field")(4,"mat-select",1),t.NdJ("ngModelChange",function(i){return a.accountTransfer.from=i})("selectionChange",function(){return a.selectFromBankAccount()}),t.YNc(5,tn,5,5,"mat-option",2),t.qZA(),t.TgZ(6,"mat-hint",3),t._uU(7),t.ALo(8,"ecMoney"),t.qZA()(),t.TgZ(9,"mat-form-field"),t.YNc(10,nn,1,0,"ng-container",4),t.YNc(11,an,3,3,"ng-template",null,5,t.W1O),t.YNc(13,cn,3,4,"ng-template",null,6,t.W1O),t.qZA(),t.TgZ(15,"mat-form-field")(16,"mat-select",7),t.NdJ("ngModelChange",function(i){return a.accountTransfer.to=i})("selectionChange",function(){return a.selectToBankAccount()}),t.YNc(17,sn,5,5,"mat-option",2),t.qZA(),t.TgZ(18,"mat-hint",3),t._uU(19),t.ALo(20,"ecMoney"),t.qZA()(),t.TgZ(21,"mat-form-field"),t.YNc(22,ln,1,0,"ng-container",4),t.YNc(23,dn,3,3,"ng-template",null,8,t.W1O),t.YNc(25,_n,3,4,"ng-template",null,9,t.W1O),t.qZA(),t.TgZ(27,"ec-date-field",10),t.NdJ("ngModelChange",function(i){return a.accountTransfer.date=i}),t.qZA(),t.TgZ(28,"ec-text-field",11),t.NdJ("ngModelChange",function(i){return a.accountTransfer.description=i}),t.qZA(),t.TgZ(29,"ec-money-field",12),t.NdJ("ngModelChange",function(i){return a.accountTransfer.amount=i}),t.qZA()(),t.TgZ(30,"mat-dialog-actions")(31,"div",13)(32,"button",14),t.NdJ("click",function(){return a.save()}),t._uU(33,"Save"),t.qZA(),t.TgZ(34,"button",15),t.NdJ("click",function(){return a.cancel()}),t._uU(35," Cancel "),t.qZA()()()),2&n){const o=t.MAs(12),i=t.MAs(14),c=t.MAs(24),l=t.MAs(26);t.xp6(4),t.Q6J("ngModel",a.accountTransfer.from),t.xp6(1),t.Q6J("ngForOf",a.bankAccounts),t.xp6(2),t.hij("New Balance: ",t.lcZ(8,20,a.newFromBalance()),""),t.xp6(3),t.Q6J("ngIf",a.fromAccount.is_sink_fund)("ngIfThen",o)("ngIfElse",i),t.xp6(6),t.Q6J("ngModel",a.accountTransfer.to),t.xp6(1),t.Q6J("ngForOf",a.bankAccounts),t.xp6(2),t.hij("New Balance: ",t.lcZ(20,22,a.newToBalance()),""),t.xp6(3),t.Q6J("ngIf",a.toAccount.is_sink_fund)("ngIfThen",c)("ngIfElse",l),t.xp6(5),t.Q6J("editMode",!0)("ngModel",a.accountTransfer.date)("ecValidateWithinBudget",a.budget)("errorMessage","test"),t.xp6(1),t.Q6J("editMode",!0)("ngModel",a.accountTransfer.description),t.xp6(1),t.Q6J("editMode",!0)("ngModel",a.accountTransfer.amount)}},dependencies:[y.sg,y.O5,f.JJ,f.On,x.xw,x.Wh,M.lW,v.uh,v.xY,v.H8,w.KE,w.bx,O.gD,Z.ey,Z.Nv,X.Q,D.x,tt.a,Q.L],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),e})();var hn=s(1161),gn=s(9675),Tn=s(2986);function An(e,r){if(1&e&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&e){const n=r.$implicit;t.Q6J("value",n.id),t.xp6(1),t.Oqu(n.name)}}function Cn(e,r){if(1&e&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&e){const n=r.$implicit;t.Q6J("value",n.id),t.xp6(1),t.Oqu(n.name)}}let bn=(()=>{class e{constructor(n,a,o,i,c){this.bankAccountService=n,this.budgetService=a,this.fb=o,this.activatedRoute=i,this.router=c,this.bankAccounts=[],this.budgets=[],this.change=new t.vpe,this.componentDestroyed=new F.xQ}ngOnInit(){this.form=this.fb.group({budget_id:0,bank_account_id:0}),this.loadBudgetsAndBankAccounts(),this.form.valueChanges.pipe((0,z.R)(this.componentDestroyed)).subscribe(()=>{this.onSubmit()})}loadBudgetsAndBankAccounts(){(0,R.aj)([this.bankAccountService.getBankAccounts(),this.budgetService.getBudgetsWithTransactions(),this.activatedRoute.paramMap.pipe((0,B.U)(this.convertToNumericParams),(0,Tn.q)(1))]).subscribe(n=>{let a;[this.bankAccounts,this.budgets,a]=n,this.setInitialFormValue(a)})}convertToNumericParams(n){return{budget_id:Number(n.get("budget_id"))||0,bank_account_id:Number(n.get("bank_account_id"))||0}}setInitialFormValue(n){let a=this.initializeWithDefaultValuesIfNeeded(n);this.form.patchValue(a),this.onSubmit()}initializeWithDefaultValuesIfNeeded(n){return{bank_account_id:n.bank_account_id||this.firstBankAccountId(),budget_id:n.budget_id||this.firstBudgetId()}}firstBudgetId(){return this.budgets.length>0?this.budgets[0].id:0}firstBankAccountId(){return this.bankAccounts.length>0?this.bankAccounts[0].id:0}onSubmit(){let n=Object.assign({},this.form.value);this.updateBudgetAndBankAccount(n),this.change.emit(n),this.router.navigate([{budget_id:n.budget_id,bank_account_id:n.bank_account_id}],{relativeTo:this.activatedRoute})}updateBudgetAndBankAccount(n){let a=this.bankAccounts.find(i=>i.id===n.bank_account_id);a&&(n.bankAccount=a);let o=this.budgets.find(i=>i.id===n.budget_id);o&&(n.budget=o)}linkToBudget(){return this.form.value.budget_id?`/budgets/${this.form.value.budget_id}`:"/budgets"}ngOnDestroy(){this.componentDestroyed.next(),this.componentDestroyed.complete()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(J.A),t.Y36(j.t),t.Y36(f.QS),t.Y36(k.gz),t.Y36(k.F0))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-transaction-search-form"]],outputs:{change:"change"},decls:17,vars:4,consts:[[3,"formGroup","ngSubmit"],["fxLayout","row","fxLayoutGap","20px"],["fxFlex","2 0 auto"],["placeholder","Bank Account","formControlName","bank_account_id"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Budget","formControlName","budget_id"],["fxLayout","row","fxLayoutAlign","space-between center"],["mat-raised-button","","type","submit","color","primary"],["color","primary",3,"routerLink"],[3,"value"]],template:function(n,a){1&n&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return a.onSubmit()}),t.TgZ(1,"mat-card")(2,"mat-card-title"),t._uU(3,"Select Transactions to View"),t.qZA(),t.TgZ(4,"mat-card-content")(5,"div",1)(6,"mat-form-field",2)(7,"mat-select",3),t.YNc(8,An,2,2,"mat-option",4),t.qZA()(),t.TgZ(9,"mat-form-field",2)(10,"mat-select",5),t.YNc(11,Cn,2,2,"mat-option",4),t.qZA()()(),t.TgZ(12,"div",6)(13,"button",7),t._uU(14," Refresh "),t.qZA(),t.TgZ(15,"a",8),t._uU(16,"Go to Budget"),t.qZA()()()()()),2&n&&(t.Q6J("formGroup",a.form),t.xp6(8),t.Q6J("ngForOf",a.bankAccounts),t.xp6(3),t.Q6J("ngForOf",a.budgets),t.xp6(4),t.Q6J("routerLink",a.linkToBudget()))},dependencies:[y.sg,f._Y,f.JJ,f.JL,f.sg,f.u,k.yS,x.xw,x.SQ,x.Wh,x.yH,M.lW,T.a8,T.dn,T.n5,w.KE,O.gD,Z.ey],styles:["mat-card[_ngcontent-%COMP%]{padding:12px}"]}),e})();var S=s(1906),vn=s(194);function xn(e,r){if(1&e&&(t.ynx(0),t.TgZ(1,"div",0)(2,"span",1),t._uU(3,"Current Budget Balance"),t.qZA(),t.TgZ(4,"span",2),t._uU(5),t.ALo(6,"ecMoney"),t.qZA()(),t.TgZ(7,"div",3)(8,"span",1),t._uU(9,"Difference (Bank vs Budget)"),t.qZA(),t.TgZ(10,"span",2),t._UZ(11,"ec-money-field",4),t.qZA()(),t.BQk()),2&e){const n=t.oxw();t.xp6(5),t.Oqu(t.lcZ(6,3,n.lastBudgetBalance())),t.xp6(6),t.Q6J("value",n.budgetDifference())("highlightPositive",!0)}}function yn(e,r){if(1&e&&(t.ynx(0),t.TgZ(1,"div",0)(2,"span",1),t._uU(3,"Unpaid Balance"),t.qZA(),t.TgZ(4,"span",2),t._UZ(5,"ec-money-field",4),t.qZA()(),t.TgZ(6,"div",0)(7,"span",1),t._uU(8,"Unpaid Difference"),t.qZA(),t.TgZ(9,"span",2),t._UZ(10,"ec-money-field",4),t.qZA()(),t.BQk()),2&e){const n=t.oxw();t.xp6(5),t.Q6J("value",n.unpaidBalance())("highlightPositive",!0),t.xp6(5),t.Q6J("value",n.unpaidDifference())("highlightPositive",!0)}}let Mn=(()=>{class e{constructor(n){this.settingsService=n}ngOnInit(){this.settingsService.getSettings().subscribe(n=>{this.primary_budget_account_id=n.primary_budget_account_id})}lastBankBalance(){return this.bankAccount?this.bankAccount.closing_balance:0}transactionTotal(){if(!this.transactions)return 0;let n=0,a=0;return this.transactions.forEach(o=>{o.deleted||(n+=o.withdrawal_amount,a+=o.deposit_amount)}),a-n}currentBankBalance(){return this.lastBankBalance()+this.transactionTotal()}showBudgetBalance(){return!!this.bankAccount&&this.bankAccount.id===this.primary_budget_account_id}lastBudgetBalance(){return(0,S.M)(this.allocations,"amount")-(0,S.M)(this.allocations,"spent")}currentBudgetBalance(){return this.lastBudgetBalance()}budgetDifference(){return this.currentBankBalance()-this.currentBudgetBalance()}showUnpaidBalance(){return!!this.bankAccount&&"credit_card"===this.bankAccount.account_type}unpaidBalance(){if(!this.transactions)return 0;let n=this.transactions.filter(a=>!a.paid);return(0,S.M)(n,"net_amount")}unpaidDifference(){return this.currentBankBalance()-this.unpaidBalance()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(vn.g))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-transaction-summary"]],inputs:{bankAccount:"bankAccount",transactions:"transactions",allocations:"allocations"},decls:21,vars:10,consts:[["fxLayout","row"],[1,"heading"],[1,"value"],["fxLayout","row",1,"total"],[3,"value","highlightPositive"],[4,"ngIf"]],template:function(n,a){1&n&&(t.TgZ(0,"mat-card")(1,"mat-card-content")(2,"div",0)(3,"span",1),t._uU(4,"Last Bank Balance"),t.qZA(),t.TgZ(5,"span",2),t._uU(6),t.ALo(7,"ecMoney"),t.qZA()(),t.TgZ(8,"div",0)(9,"span",1),t._uU(10,"Transaction Total"),t.qZA(),t.TgZ(11,"span",2),t._uU(12),t.ALo(13,"ecMoney"),t.qZA()(),t.TgZ(14,"div",3)(15,"span",1),t._uU(16,"Current Bank Balance"),t.qZA(),t.TgZ(17,"span",2),t._UZ(18,"ec-money-field",4),t.qZA()(),t.YNc(19,xn,12,5,"ng-container",5),t.YNc(20,yn,11,4,"ng-container",5),t.qZA()()),2&n&&(t.xp6(6),t.Oqu(t.lcZ(7,6,a.lastBankBalance())),t.xp6(6),t.Oqu(t.lcZ(13,8,a.transactionTotal())),t.xp6(6),t.Q6J("value",a.currentBankBalance())("highlightPositive",!0),t.xp6(1),t.Q6J("ngIf",a.showBudgetBalance()),t.xp6(1),t.Q6J("ngIf",a.showUnpaidBalance()))},dependencies:[y.O5,x.xw,T.a8,T.dn,D.x,Q.L],styles:[".heading[_ngcontent-%COMP%]{flex:2 0 auto;font-weight:700}.value[_ngcontent-%COMP%]{flex:1 0 auto;text-align:right}.total[_ngcontent-%COMP%]{font-size:16px;border-top:1px solid black}"]}),e})();function Fn(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"div",1)(1,"mat-card")(2,"mat-card-title"),t._uU(3,"Selected Transaction Total"),t.qZA(),t.TgZ(4,"mat-card-content"),t._uU(5," Total: "),t.TgZ(6,"strong"),t._uU(7),t.ALo(8,"ecMoney"),t.qZA()(),t.TgZ(9,"mat-card-actions",2)(10,"button",3),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.clearSelections())}),t._uU(11," Clear "),t.qZA()()()()}if(2&e){const n=t.oxw();t.xp6(7),t.Oqu(t.lcZ(8,1,n.transactionTotal()))}}let kn=(()=>{class e{constructor(){this.transactions=[]}ngOnInit(){}transactionTotal(){return(0,S.M)(this.selectedTransactions(),"net_amount")}selectedTransactions(){return this.transactions?this.transactions.filter(n=>n.selected):[]}showCalculator(){return this.selectedTransactions().length>0}clearSelections(){this.selectedTransactions().forEach(n=>{n.selected=!1})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-transaction-calculator"]],inputs:{transactions:"transactions"},decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],["fxLayoutAlign","end"],["mat-raised-button","","color","primary",3,"click"]],template:function(n,a){1&n&&t.YNc(0,Fn,12,3,"div",0),2&n&&t.Q6J("ngIf",a.showCalculator())},dependencies:[y.O5,x.Wh,M.lW,T.a8,T.dn,T.n5,T.hq,Q.L],styles:["div.container[_ngcontent-%COMP%]{position:fixed;top:60px;right:60px;z-index:1000}mat-card[_ngcontent-%COMP%]{background:#efdbdb}"]}),e})(),wn=(()=>{class e{constructor(n,a,o,i,c,l){this.transactionService=n,this.transactionDataService=a,this.loadingIndicator=o,this.toolbarService=i,this.messageService=c,this.dialog=l,this.transactions=[],this.allocations=[],this.sinkFundAllocations=[],this.bankAccount={},this.budget={},this.componentDestroyed=new F.xQ}ngOnInit(){this.toolbarService.setHeading("Transactions"),this.transactionDataService.init(),this.transactionDataService.allData$().pipe((0,z.R)(this.componentDestroyed)).subscribe(([n,a,o])=>{this.transactions=n,this.allocations=a,this.sinkFundAllocations=o,this.loadingIndicator.hide()})}refreshTransactions(n={}){this.loadingIndicator.show(),n.bankAccount&&(this.bankAccount=n.bankAccount),n.budget&&(this.budget=n.budget),this.transactionDataService.refresh(n)}refresh(){this.refreshTransactions({budget_id:this.budget.id,bank_account_id:this.bankAccount.id})}save(){this.loadingIndicator.show(),this.transactionService.save(this.transactions,this.bankAccount,this.budget).subscribe(()=>{this.loadingIndicator.hide(),this.transactionList.switchToDisplayMode(),this.refresh(),this.messageService.setMessage("Transactions saved.",5e3)})}cancel(){this.transactionDataService.refresh({bank_account_id:this.bankAccount.id,budget_id:this.budget.id})}showImportForm(){let n=this.dialog.open(lt,{width:"350px"});return n.componentInstance.startDate=this.budget.start_date,n.componentInstance.endDate=this.budget.end_date,n.componentInstance.importType=this.bankAccount.import_format,n.afterClosed().subscribe(a=>{a.length>0&&(this.transactions=this.transactions.concat(a))}),n}showTransferForm(){let n=this.dialog.open(fn,{width:"350px"});return this.budget.allocations=this.allocations,n.componentInstance.setBudget(this.budget),n.afterClosed().subscribe(()=>{this.refresh()}),n}ngOnDestroy(){this.componentDestroyed.next(),this.componentDestroyed.complete(),this.transactionDataService.destroy()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(L),t.Y36(V),t.Y36(hn.T),t.Y36(gn.S),t.Y36(et.e),t.Y36(v.uw))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-transactions"]],viewQuery:function(n,a){if(1&n&&t.Gf(nt,7),2&n){let o;t.iGM(o=t.CRH())&&(a.transactionList=o.first)}},decls:7,vars:9,consts:[[1,"main"],[3,"transactions"],[1,"container"],[3,"change"],[3,"transactions","bankAccount","allocations"],[3,"transactions","allocations","sinkFundAllocations","bankAccount","budget","save","cancel","import","transfer"]],template:function(n,a){1&n&&(t.TgZ(0,"mat-card",0)(1,"mat-card-content"),t._UZ(2,"ec-transaction-calculator",1),t.TgZ(3,"div",2)(4,"ec-transaction-search-form",3),t.NdJ("change",function(i){return a.refreshTransactions(i)}),t.qZA(),t._UZ(5,"ec-transaction-summary",4),t.TgZ(6,"ec-transaction-list",5),t.NdJ("save",function(){return a.save()})("cancel",function(){return a.cancel()})("import",function(){return a.showImportForm()})("transfer",function(){return a.showTransferForm()}),t.qZA()()()()),2&n&&(t.xp6(2),t.Q6J("transactions",a.transactions),t.xp6(3),t.Q6J("transactions",a.transactions)("bankAccount",a.bankAccount)("allocations",a.allocations),t.xp6(1),t.Q6J("transactions",a.transactions)("allocations",a.allocations)("sinkFundAllocations",a.sinkFundAllocations)("bankAccount",a.bankAccount)("budget",a.budget))},dependencies:[T.a8,T.dn,nt,bn,Mn,kn],styles:['mat-card-content[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]{height:100%;overflow:auto}.container[_ngcontent-%COMP%]{display:grid;width:100%;grid-template-areas:"selector summary" "list     list";grid-template-rows:175px 1fr;grid-template-columns:1fr 1fr;grid-column-gap:20px;-moz-column-gap:20px;column-gap:20px}@media (max-width: 600px){mat-card.main[_ngcontent-%COMP%]{height:100%}.container[_ngcontent-%COMP%]{display:grid;width:100%;grid-template-areas:"selector" "summary" "list";grid-template-rows:175px 160px 1fr;grid-template-columns:auto}}ec-transaction-search-form[_ngcontent-%COMP%]{grid-area:selector;width:100%}ec-transaction-summary[_ngcontent-%COMP%]{grid-area:summary;width:100%}ec-transaction-list[_ngcontent-%COMP%]{grid-area:list;overflow:auto;width:100%}']}),e})();const Dn=[{path:"",canActivate:[s(1265).a],children:[{path:"",component:wn}]}];let Sn=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[k.Bz.forChild(Dn)]}),e})(),In=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[I.m.forRoot()]}),e})(),Bn=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[L,V],imports:[I.m,ot.c,ct,In,Sn]}),e})()}}]);