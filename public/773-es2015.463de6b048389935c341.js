"use strict";(self.webpackChunkeverycent=self.webpackChunkeverycent||[]).push([[773],{73773:function(t,e,n){n.r(e),n.d(e,{SinkFundsModule:function(){return ot}});var i=n(10232),o=n(32833),a=n(26215),s=n(37716),c=n(75572);let r=(()=>{class t{constructor(t){this.apiGateway=t,this._currentSinkFund$=new a.X({})}getSinkFunds(){return this.apiGateway.get("/sink_funds")}getCurrent(){return this._currentSinkFund$.asObservable()}refreshSinkFund(t){this.apiGateway.get(`/sink_funds/${t}`).subscribe(t=>{this._currentSinkFund$.next(t)})}save(t){return this.apiGateway.put(`/sink_funds/${t.id}`,t)}transfer(t,e){return this.apiGateway.post(`/sink_funds/${t.id}/transfer_allocation`,e)}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(c.i))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac}),t})();var d=n(54655),l=n(79765),u=n(88002),g=n(45435),f=n(46782),h=n(29675),p=n(93738),Z=n(98295),m=n(67441),v=n(38583),k=n(72458);const A=["field"];function _(t,e){if(1&t&&(s.TgZ(0,"mat-option",3),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.Q6J("value",t.id),s.xp6(1),s.hij(" ",t.name," ")}}let x=(()=>{class t{constructor(){this.sinkFunds=[],this.change=new s.vpe}get value(){return this.field?this.field.value:0}set value(t){this.field.value=t}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-sink-fund-selector"]],viewQuery:function(t,e){if(1&t&&s.Gf(A,7),2&t){let t;s.iGM(t=s.CRH())&&(e.field=t.first)}},inputs:{sinkFunds:"sinkFunds"},outputs:{change:"change"},decls:6,vars:1,consts:[["color","primary","placeholder","Select a sink fund",3,"selectionChange"],["field",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(s.TgZ(0,"mat-card"),s.TgZ(1,"mat-card-content"),s.TgZ(2,"mat-form-field"),s.TgZ(3,"mat-select",0,1),s.NdJ("selectionChange",function(t){return e.change.emit(t)}),s.YNc(5,_,2,2,"mat-option",2),s.qZA(),s.qZA(),s.qZA(),s.qZA()),2&t&&(s.xp6(5),s.Q6J("ngForOf",e.sinkFunds))},directives:[p.a8,p.dn,Z.KE,m.gD,v.sg,k.ey],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),t})();var T=n(57814),b=n(86529),F=n(21906);class M{constructor(t){this.deactivateService=t}sinkFundAllocationsOf(t){return null===t&&void 0===t?[]:t.sink_fund_allocations||[]}totalTarget(t,e){return(0,F.M)(this.sinkFundAllocationsOf(t).filter(t=>t.target>0).filter(t=>this.deactivateService.isItemVisible(t,e)),"target")}totalOutstanding(t,e){return(0,F.M)(this.sinkFundAllocationsOf(t).filter(t=>t.target>0).filter(t=>this.deactivateService.isItemVisible(t,e)),"current_balance")-this.totalTarget(t,e)}totalAssignedBalance(t){return(0,F.M)(this.sinkFundAllocationsOf(t),"current_balance")}unassignedBalance(t){return null===t&&void 0===t?0:t.current_balance-this.totalAssignedBalance(t)}allocationOutstandingAt(t,e){if(null===t&&void 0===t)return 0;let n=t.sink_fund_allocations[e];return n.current_balance-n.target}}var w=n(22238),q=n(3679),y=n(12874),J=n(35618),S=n(57576),U=n(51095),C=n(52205);function O(t,e){if(1&t&&(s.TgZ(0,"mat-option",4),s._uU(1),s.ALo(2,"ecMoney"),s.qZA()),2&t){const t=e.$implicit;s.Q6J("value",t.id),s.xp6(1),s.AsE(" ",t.name," ( ",s.lcZ(2,3,t.current_balance)," ) ")}}function Q(t,e){if(1&t&&(s.TgZ(0,"mat-option",4),s._uU(1),s.ALo(2,"ecMoney"),s.qZA()),2&t){const t=e.$implicit;s.Q6J("value",t.id),s.xp6(1),s.AsE(" ",t.name," - ",s.lcZ(2,3,t.current_balance)," ")}}let N=(()=>{class t{constructor(t,e,n,i){this.dialogRef=t,this.fb=e,this.sinkFundService=n,this.deactivateService=i}ngOnInit(){this.calculator=new M(this.deactivateService),this.transfer=this.fb.group({existing_allocation_id:0,new_allocation_id:0,amount:0})}save(){this.sinkFundService.transfer(this.sinkFund,this.transfer.value).subscribe(t=>{this.sinkFundService.refreshSinkFund(this.sinkFund.id),this.dialogRef.close(t)},t=>alert(t))}cancel(){this.dialogRef.close(!1)}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(w.so),s.Y36(q.qu),s.Y36(r),s.Y36(y.u))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-add-transfer-form"]],inputs:{sinkFund:"sinkFund"},decls:23,vars:12,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["fxLayout","column","fxLayoutAlign","space-between",3,"formGroup"],["placeholder","Transfer From","formControlName","existing_allocation_id"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Transfer To","formControlName","new_allocation_id"],["placeholder","Amount","formControlName","amount","fxFlex","1",3,"editMode"],["mat-dialog-actions",""],["fxLayout","row","fxLayoutAlign","space-around",1,"actions"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(t,e){1&t&&(s.TgZ(0,"h1",0),s._uU(1,"Transfer Money"),s.qZA(),s.TgZ(2,"div",1),s.TgZ(3,"div",2),s.TgZ(4,"mat-form-field"),s.TgZ(5,"mat-select",3),s.TgZ(6,"mat-option",4),s._uU(7),s.ALo(8,"ecMoney"),s.qZA(),s.YNc(9,O,3,5,"mat-option",5),s.qZA(),s.qZA(),s.TgZ(10,"mat-form-field"),s.TgZ(11,"mat-select",6),s.TgZ(12,"mat-option",4),s._uU(13),s.ALo(14,"ecMoney"),s.qZA(),s.YNc(15,Q,3,5,"mat-option",5),s.qZA(),s.qZA(),s._UZ(16,"ec-money-field",7),s.qZA(),s.qZA(),s.TgZ(17,"div",8),s.TgZ(18,"div",9),s.TgZ(19,"button",10),s.NdJ("click",function(){return e.save()}),s._uU(20,"Save"),s.qZA(),s.TgZ(21,"button",11),s.NdJ("click",function(){return e.cancel()}),s._uU(22," Cancel "),s.qZA(),s.qZA(),s.qZA()),2&t&&(s.xp6(3),s.Q6J("formGroup",e.transfer),s.xp6(3),s.Q6J("value",0),s.xp6(1),s.hij(" Unassigned Money - ",s.lcZ(8,8,e.calculator.unassignedBalance(e.sinkFund))," "),s.xp6(2),s.Q6J("ngForOf",e.sinkFund.sink_fund_allocations),s.xp6(3),s.Q6J("value",0),s.xp6(1),s.hij(" Unassigned Money - ",s.lcZ(14,10,e.calculator.unassignedBalance(e.sinkFund))," "),s.xp6(2),s.Q6J("ngForOf",e.sinkFund.sink_fund_allocations),s.xp6(1),s.Q6J("editMode",!0))},directives:[w.uh,w.xY,J.xw,J.Wh,q.JL,q.sg,Z.KE,m.gD,q.JJ,q.u,k.ey,v.sg,S.x,J.yH,w.H8,U.lW],pipes:[C.L],styles:["mat-form-field[_ngcontent-%COMP%], ec-money-field[_ngcontent-%COMP%]{margin-top:24px}div.actions[_ngcontent-%COMP%]{width:100%}ec-money-field[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),t})();var I=n(7736),Y=n(29210),E=n(77001),$=n(45396),D=n(56326),H=n(15552),B=n(78759),P=n(10270),G=n(27333);function L(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"span",1),s.NdJ("click",function(){return s.CHM(t),s.oxw().toggle()}),s._UZ(1,"ec-icon",2),s.qZA()}if(2&t){const t=s.oxw();s.xp6(1),s.Q6J("icon",t.icon)}}let R=(()=>{class t{constructor(){this.editMode=!1}get icon(){return this.item&&this.item.deactivated?T.J.ACTIVATE:T.J.DEACTIVATE}ngOnInit(){}toggle(){this.item.deactivated=!this.item.deactivated,this.item.status=this.item.deactivated?"closed":"open",this.item.unsaved=!0}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-deactivate-button"]],inputs:{item:"item",icon:"icon",editMode:"editMode"},decls:1,vars:1,consts:[[3,"click",4,"ngIf"],[3,"click"],[3,"icon"]],template:function(t,e){1&t&&s.YNc(0,L,2,1,"span",0),2&t&&s.Q6J("ngIf",e.editMode)},directives:[v.O5,P.k],styles:["span[_ngcontent-%COMP%]{cursor:pointer}"]}),t})();function z(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"tr",11),s.TgZ(1,"td"),s.TgZ(2,"ec-text-field",12),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw().$implicit.name=e}),s.qZA(),s.qZA(),s.TgZ(3,"td",13),s.TgZ(4,"div",14),s.TgZ(5,"ec-icon",15),s.NdJ("click",function(){s.CHM(t);const e=s.oxw().$implicit;return s.oxw(2).showTransactionsFor(e)}),s.qZA(),s._UZ(6,"span",16),s.TgZ(7,"div",17),s._UZ(8,"ec-money-field",8),s.qZA(),s.qZA(),s.qZA(),s.TgZ(9,"td",17),s.TgZ(10,"ec-money-field",12),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw().$implicit.target=e}),s.qZA(),s.qZA(),s.TgZ(11,"td",17),s._UZ(12,"ec-money-field",18),s.qZA(),s.TgZ(13,"td"),s.TgZ(14,"ec-text-field",12),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw().$implicit.comment=e}),s.qZA(),s.qZA(),s.TgZ(15,"td"),s.TgZ(16,"ec-text-field",19),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw().$implicit.status=e}),s.qZA(),s.qZA(),s.TgZ(17,"td"),s._UZ(18,"ec-delete-button",20),s._UZ(19,"ec-deactivate-button",20),s.qZA(),s.qZA()}if(2&t){const t=s.oxw().$implicit,e=s.oxw(2);s.Q6J("ecHighlightDeletedFor",t),s.xp6(2),s.Q6J("ngModel",t.name)("editMode",e.isEditMode),s.xp6(3),s.Q6J("icon",e.Icon.SHOW_TRANSACTIONS),s.xp6(3),s.Q6J("value",t.current_balance),s.xp6(2),s.Q6J("ngModel",t.target)("editMode",e.isEditMode),s.xp6(2),s.Q6J("value",0==t.target?0:t.current_balance-t.target),s.xp6(2),s.Q6J("ngModel",t.comment)("editMode",e.isEditMode),s.xp6(2),s.Q6J("ngModel",t.status),s.xp6(2),s.Q6J("item",t)("editMode",e.isEditMode),s.xp6(1),s.Q6J("item",t)("editMode",e.isEditMode)}}function V(t,e){if(1&t&&(s.ynx(0),s.YNc(1,z,20,15,"tr",10),s.BQk()),2&t){const t=e.$implicit,n=s.oxw(2);s.xp6(1),s.Q6J("ngIf",n.deactivateService.isItemVisible(t,n.showDeactivated))}}function j(t,e){if(1&t&&(s.TgZ(0,"table",6),s.TgZ(1,"thead"),s.TgZ(2,"tr"),s.TgZ(3,"th"),s._uU(4,"Goal / Obligation"),s.qZA(),s.TgZ(5,"th"),s._uU(6,"Current Balance"),s.qZA(),s.TgZ(7,"th"),s._uU(8,"Target"),s.qZA(),s.TgZ(9,"th"),s._uU(10,"Outstanding"),s.qZA(),s.TgZ(11,"th"),s._uU(12,"Comment"),s.qZA(),s.TgZ(13,"th"),s._uU(14,"Status"),s.qZA(),s.TgZ(15,"th"),s._uU(16,"Actions"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(17,"tbody"),s.TgZ(18,"tr",7),s.TgZ(19,"td"),s._uU(20,"Sink Fund Account Balance"),s.qZA(),s.TgZ(21,"td"),s._UZ(22,"ec-money-field",8),s.qZA(),s._UZ(23,"td"),s._UZ(24,"td"),s.TgZ(25,"td"),s._uU(26,"Current Account Balance"),s.qZA(),s._UZ(27,"td"),s._UZ(28,"td"),s.qZA(),s.TgZ(29,"tr",7),s.TgZ(30,"td"),s._uU(31,"Unassigned Money"),s.qZA(),s.TgZ(32,"td"),s._UZ(33,"ec-money-field",8),s.qZA(),s._UZ(34,"td"),s._UZ(35,"td"),s.TgZ(36,"td"),s._uU(37,"Money not assigned to any financial goal/obligation"),s.qZA(),s._UZ(38,"td"),s._UZ(39,"td"),s.qZA(),s.YNc(40,V,2,1,"ng-container",9),s.qZA(),s.TgZ(41,"tfoot"),s.TgZ(42,"tr",7),s.TgZ(43,"td"),s._uU(44,"Total"),s.qZA(),s.TgZ(45,"td"),s._UZ(46,"ec-money-field",8),s.qZA(),s.TgZ(47,"td"),s._UZ(48,"ec-money-field",8),s.qZA(),s.TgZ(49,"td"),s._UZ(50,"ec-money-field",8),s.qZA(),s._UZ(51,"td"),s._UZ(52,"td"),s._UZ(53,"td"),s.qZA(),s.qZA(),s.qZA()),2&t){const t=s.oxw();s.ekj("small-screen",t.isSmallScreen),s.xp6(3),s.Udp("width",25,"%"),s.xp6(2),s.Udp("width",10,"%"),s.xp6(2),s.Udp("width",10,"%"),s.xp6(2),s.Udp("width",10,"%"),s.xp6(2),s.Udp("width",20,"%"),s.xp6(2),s.Udp("width",5,"%"),s.xp6(2),s.Udp("width",10,"%"),s.xp6(7),s.Q6J("value",t.sinkFund.current_balance),s.xp6(11),s.Q6J("value",t.calculator.unassignedBalance(t.sinkFund)),s.xp6(7),s.Q6J("ngForOf",t.sinkFund.sink_fund_allocations),s.xp6(6),s.Q6J("value",t.calculator.totalAssignedBalance(t.sinkFund)),s.xp6(2),s.Q6J("value",t.calculator.totalTarget(t.sinkFund,t.showDeactivated)),s.xp6(2),s.Q6J("value",t.calculator.totalOutstanding(t.sinkFund,t.showDeactivated))}}function X(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",21),s.NdJ("click",function(){return s.CHM(t),s.oxw().addObligation()}),s._uU(1," Add Obligation "),s.qZA()}}function W(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",22),s.NdJ("click",function(){return s.CHM(t),s.oxw().showTransferForm()}),s._uU(1," Transfer Money "),s.qZA()}}let K=(()=>{class t{constructor(t,e,n,i,o,a){this.media=t,this.sinkFundService=e,this.transactionService=n,this.dialog=i,this.snackbar=o,this.deactivateService=a,this.Icon=T.J,this.isEditMode=!1,this.showDeactivated=!1}ngOnInit(){this.calculator=new M(this.deactivateService),this.sinkFund={sink_fund_allocations:[]},this.mediaSubscription=this.media.asObservable().subscribe(()=>{this.isSmallScreen=this.media.isActive("xs")})}save(){this.sinkFundService.save(this.sinkFund).subscribe(t=>{this.sinkFund=t,this.isEditMode=!1,this.snackbar.open("Sink fund saved",null,{duration:3e3})},t=>{this.snackbar.open("Not saved: "+JSON.stringify(t),null,{duration:3e3})})}cancel(){this.snackbar.open("Sink fund not saved",null,{duration:1e3})}isAllocationVisible(t){}showTransferForm(){let t=this.dialog.open(N,{width:"350px"});t.componentInstance.sinkFund=this.sinkFund,t.afterClosed().subscribe(t=>{t?this.snackbar.open("Transfer complete.",null,{duration:3e3}):this.snackbar.open("Transfer cancelled.",null,{duration:1500})})}showTransactionsFor(t){let e;this.transactionService.getTransactionsForSinkFundAllocation(t.id).subscribe(n=>{e=this.dialog.open(b.V,{width:"500px"}),e.componentInstance.transactions=n,e.componentInstance.itemName=t.name})}addObligation(){this.sinkFund.sink_fund_allocations.push({amount:0,current_balance:0,target:0,unsaved:!0})}ngOnDestroy(){this.mediaSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(I.u0),s.Y36(r),s.Y36(Y.q),s.Y36(w.uw),s.Y36(E.ux),s.Y36(y.u))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-sink-fund"]],inputs:{sinkFund:"sinkFund"},decls:10,vars:5,consts:[["color","primary",3,"ngModel","ngModelChange"],[1,"fixed"],["class","table",3,"small-screen",4,"ngIf"],[3,"editMode","editModeChange","save","cancel"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],[1,"table"],[1,"total"],[3,"value"],[4,"ngFor","ngForOf"],[3,"ecHighlightDeletedFor",4,"ngIf"],[3,"ecHighlightDeletedFor"],[3,"ngModel","editMode","ngModelChange"],[1,"highlight"],["fxLayout","row","fxLayoutAlign","start center"],[1,"small",3,"icon","click"],["fxFlex",""],[1,"right"],["highlightPositive","true",3,"value"],[3,"ngModel","ngModelChange"],[3,"item","editMode"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&(s.TgZ(0,"mat-card"),s.TgZ(1,"mat-card-content"),s.TgZ(2,"mat-slide-toggle",0),s.NdJ("ngModelChange",function(t){return e.showDeactivated=t}),s._uU(3,"Show Closed Obligations?"),s.qZA(),s.TgZ(4,"div",1),s.YNc(5,j,54,22,"table",2),s.qZA(),s.qZA(),s.TgZ(6,"mat-card-actions"),s.TgZ(7,"ec-edit-actions",3),s.NdJ("editModeChange",function(t){return e.isEditMode=t})("save",function(){return e.save()})("cancel",function(){return e.cancel()}),s.YNc(8,X,2,0,"button",4),s.YNc(9,W,2,0,"button",5),s.qZA(),s.qZA(),s.qZA()),2&t&&(s.xp6(2),s.Q6J("ngModel",e.showDeactivated),s.xp6(3),s.Q6J("ngIf",e.sinkFund),s.xp6(2),s.Q6J("editMode",e.isEditMode),s.xp6(1),s.Q6J("ngIf",e.isEditMode),s.xp6(1),s.Q6J("ngIf",!e.isEditMode))},directives:[p.a8,p.dn,$.Rr,q.JJ,q.On,v.O5,p.hq,D.Y,S.x,v.sg,H.O,B.a,J.xw,J.Wh,P.k,J.yH,G.t,R,U.lW],styles:["div.fixed[_ngcontent-%COMP%]{width:100%;overflow-x:auto}table.table[_ngcontent-%COMP%]{table-layout:fixed;width:100%}table.table.small-screen[_ngcontent-%COMP%]{width:768px}.highlight[_ngcontent-%COMP%]{font-weight:bold;font-size:13px}.total[_ngcontent-%COMP%]{font-weight:bold;font-size:16px;border-top:2px solid black;border-bottom:2px solid black}ec-icon.small[_ngcontent-%COMP%]     .material-icons{font-size:16px;height:16px;width:16px;padding-top:1px;cursor:pointer}"]}),t})();const tt=["selector"];let et=(()=>{class t{constructor(t,e,n,i){this.sinkFundService=t,this.toolbarService=e,this.activatedRoute=n,this.router=i,this.onDestroy$=new l.xQ}ngOnInit(){this.sinkFundService.getSinkFunds().subscribe(t=>{this.sinkFunds=t}),this.activatedRoute.paramMap.pipe((0,u.U)(t=>Number(t.get("sink_fund_id"))),(0,g.h)(t=>t>0),(0,f.R)(this.onDestroy$)).subscribe(t=>this.selectSinkFund(t)),this.toolbarService.setHeading("Sink Fund Obligations"),this.sinkFundService.getCurrent().subscribe(t=>{this.sinkFund=t})}onSinkFundSelect(t){this.router.navigate([this.selector.value],{relativeTo:this.activatedRoute.parent})}selectSinkFund(t){this.selector.value=t,this.sinkFundService.refreshSinkFund(t)}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(r),s.Y36(h.S),s.Y36(d.gz),s.Y36(d.F0))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-sink-funds"]],viewQuery:function(t,e){if(1&t&&s.Gf(tt,7),2&t){let t;s.iGM(t=s.CRH())&&(e.selector=t.first)}},decls:4,vars:2,consts:[[1,"main"],[3,"sinkFunds","change"],["selector",""],[3,"sinkFund"]],template:function(t,e){1&t&&(s.TgZ(0,"mat-card",0),s.TgZ(1,"ec-sink-fund-selector",1,2),s.NdJ("change",function(t){return e.onSinkFundSelect(t)}),s.qZA(),s._UZ(3,"ec-sink-fund",3),s.qZA()),2&t&&(s.xp6(1),s.Q6J("sinkFunds",e.sinkFunds),s.xp6(2),s.Q6J("sinkFund",e.sinkFund))},directives:[p.a8,x,K],encapsulation:2}),t})();const nt=[{path:"",canActivate:[n(31265).a],children:[{path:":sink_fund_id",component:et},{path:"",component:et}]}];let it=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({providers:[],imports:[[d.Bz.forChild(nt)],d.Bz]}),t})(),ot=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({providers:[r],imports:[[o.m,i.c,it]]}),t})()}}]);