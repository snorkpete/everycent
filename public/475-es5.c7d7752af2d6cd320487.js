!function(){"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function n(t,n){for(var e=0;e<n.length;e++){var c=n[e];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function e(t,e,c){return e&&n(t.prototype,e),c&&n(t,c),t}(self.webpackChunkeverycent=self.webpackChunkeverycent||[]).push([[475],{2475:function(n,c,a){a.r(c),a.d(c,{AccountBalancesModule:function(){return Q}});var s=a(38583),o=a(32833),u=a(54655),i=a(31265),r=a(43190),l=a(37716),h=a(3679),A=a(22238),f=a(56326),g=a(57576);function d(t,n){if(1&t&&(l.TgZ(0,"th"),l._uU(1),l.qZA()),2&t){var e=n.$implicit;l.xp6(1),l.hij(" ",e.name," ")}}function Z(t,n){if(1&t&&(l.TgZ(0,"td",8),l.TgZ(1,"div",9),l._UZ(2,"ec-money-field",10),l.qZA(),l.qZA()),2&t){var e=n.index;l.xp6(1),l.Q6J("formGroupName",e),l.xp6(1),l.Q6J("editMode",!1)}}function b(t,n){if(1&t&&(l.TgZ(0,"td",8),l.TgZ(1,"div",9),l._UZ(2,"ec-money-field",11),l.qZA(),l.qZA()),2&t){var e=n.index;l.xp6(1),l.Q6J("formGroupName",e),l.xp6(1),l.Q6J("editMode",!0)}}var p,k=((p=function(){function n(e,c){t(this,n),this.fb=e,this.dialogRef=c,this.bankAccounts=[],this.save=new l.vpe,this.cancel=new l.vpe}return e(n,[{key:"ngOnInit",value:function(){this.createForm()}},{key:"createForm",value:function(){var t=this,n=this.bankAccounts.map(function(n){return t.fb.group({bank_account_id:n.id,new_balance:n.current_balance,currentBalance:n.current_balance})});this.form=this.fb.group({adjustments:this.fb.array(n)})}},{key:"saveChanges",value:function(){this.save.emit(this.form.value),this.save.complete()}},{key:"cancelChanges",value:function(){this.cancel.emit(),this.cancel.complete(),this.dialogRef.close()}}]),n}()).\u0275fac=function(t){return new(t||p)(l.Y36(h.qu),l.Y36(A.so))},p.\u0275cmp=l.Xpm({type:p,selectors:[["ec-adjust-balances"]],inputs:{bankAccounts:"bankAccounts"},outputs:{save:"save",cancel:"cancel"},decls:21,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"table"],[4,"ngFor","ngForOf"],["formArrayName","adjustments",4,"ngFor","ngForOf"],["mat-dialog-actions",""],[3,"editMode","save","cancel"],["formArrayName","adjustments"],[3,"formGroupName"],["formControlName","currentBalance",3,"editMode"],["formControlName","new_balance",3,"editMode"]],template:function(t,n){1&t&&(l.TgZ(0,"h1",0),l._uU(1,"Adjust Account Balances"),l.qZA(),l.TgZ(2,"div",1),l.TgZ(3,"div",2),l.TgZ(4,"table",3),l.TgZ(5,"thead"),l.TgZ(6,"tr"),l.TgZ(7,"th"),l._uU(8,"Bank Account"),l.qZA(),l.YNc(9,d,2,1,"th",4),l.qZA(),l.qZA(),l.TgZ(10,"tbody"),l.TgZ(11,"tr"),l.TgZ(12,"td"),l._uU(13," Current Balance "),l.qZA(),l.YNc(14,Z,3,2,"td",5),l.qZA(),l.TgZ(15,"tr"),l.TgZ(16,"td"),l._uU(17," New Account Balance "),l.qZA(),l.YNc(18,b,3,2,"td",5),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(19,"div",6),l.TgZ(20,"ec-edit-actions",7),l.NdJ("save",function(){return n.saveChanges()})("cancel",function(){return n.cancelChanges()}),l.qZA(),l.qZA()),2&t&&(l.xp6(3),l.Q6J("formGroup",n.form),l.xp6(6),l.Q6J("ngForOf",n.bankAccounts),l.xp6(5),l.Q6J("ngForOf",n.bankAccounts),l.xp6(4),l.Q6J("ngForOf",n.bankAccounts),l.xp6(2),l.Q6J("editMode",!0))},directives:[A.uh,A.xY,h.JL,h.sg,s.sg,A.H8,f.Y,h.CE,h.x0,g.x,h.JJ,h.u],encapsulation:2}),p),_=a(29675),y=a(75572),v=function(){var n=function(){function n(e){t(this,n),this.apiGateway=e}return e(n,[{key:"getAccountBalances$",value:function(t){var n="/account_balances";return t&&(n+="?include_closed=true"),this.bankAccounts$=this.apiGateway.get(n),this.bankAccounts$}},{key:"netWorth",value:function(t){var n=0;return t.forEach(function(t){n+=t.current_balance}),n}},{key:"adjustAccountBalances",value:function(t){return t.adjustments=t.adjustments.filter(function(t){return t.new_balance!==t.currentBalance}),this.apiGateway.post("/bank_accounts/manually_adjust_balances",t)}},{key:"totalAssets",value:function(t){return t.filter(function(t){return"asset"===t.account_category}).reduce(function(t,n){return t+n.current_balance},0)}},{key:"totalLiabilities",value:function(t){return t.filter(function(t){return"liability"===t.account_category}).reduce(function(t,n){return t+n.current_balance},0)}},{key:"netCurrentCash",value:function(t){return t.filter(function(t){return"current"===t.account_category||"liability"===t.account_category&&t.is_cash}).reduce(function(t,n){return t+n.current_balance},0)}},{key:"netCashAssets",value:function(t){return t.filter(function(t){return"asset"===t.account_category&&t.is_cash}).reduce(function(t,n){return t+n.current_balance},0)}},{key:"netNonCashAssets",value:function(t){return t.filter(function(t){return("asset"===t.account_category||"liability"===t.account_category)&&!t.is_cash}).reduce(function(t,n){return t+n.current_balance},0)}}]),n}();return n.\u0275fac=function(t){return new(t||n)(l.LFG(y.i))},n.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac}),n}(),m=a(28731),x=a(93738),T=a(35618),q=a(45396),C=a(51095),U=a(21906),B=a(52205),L=function(t){return{bank_account_id:t}},w=function(t){return["..","transactions",t]};function J(t,n){if(1&t&&(l.TgZ(0,"tr"),l.TgZ(1,"td"),l.TgZ(2,"a",6),l._uU(3),l.qZA(),l.qZA(),l.TgZ(4,"td",1),l._uU(5),l.qZA(),l.TgZ(6,"td",1),l._uU(7),l.qZA(),l.TgZ(8,"td",1),l._uU(9),l.qZA(),l.TgZ(10,"td",5),l._uU(11),l.ALo(12,"ecMoney"),l.qZA(),l.TgZ(13,"td",5),l._uU(14),l.ALo(15,"ecMoney"),l.qZA(),l.TgZ(16,"td",5),l._uU(17),l.ALo(18,"ecMoney"),l.qZA(),l.qZA()),2&t){var e=n.$implicit;l.xp6(2),l.Q6J("routerLink",l.VKq(16,w,l.VKq(14,L,e.id))),l.xp6(1),l.hij(" ",null==e?null:e.name,""),l.xp6(2),l.Oqu(null==e||null==e.institution?null:e.institution.name),l.xp6(2),l.Oqu(null==e?null:e.account_type),l.xp6(2),l.Oqu(null==e?null:e.account_category),l.xp6(2),l.hij(" ",l.lcZ(12,8,null==e?null:e.closing_balance)," "),l.xp6(3),l.hij(" ",l.lcZ(15,10,null==e?null:e.expected_closing_balance)," "),l.xp6(3),l.hij(" ",l.lcZ(18,12,null==e?null:e.current_balance)," ")}}var M=function(){var n=function(){function n(){t(this,n),this.heading="",this.bankAccounts=[],this.firstBankAccount={id:0,name:""}}return e(n,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(t){this.firstBankAccount=this.bankAccounts&&this.bankAccounts[0]?this.bankAccounts[0]:{}}},{key:"closingBalance",value:function(){return(0,U.M)(this.bankAccounts,"closing_balance")}},{key:"expectedClosingBalance",value:function(){return(0,U.M)(this.bankAccounts,"expected_closing_balance")}},{key:"currentBalance",value:function(){return(0,U.M)(this.bankAccounts,"current_balance")}}]),n}();return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=l.Xpm({type:n,selectors:[["ec-account-list"]],inputs:{heading:"heading",bankAccounts:"bankAccounts"},features:[l.TTD],decls:42,vars:19,consts:[[1,"table"],[1,"hidden-xs"],[4,"ngFor","ngForOf"],[1,"total"],["colspan","4",1,"hidden-xs","text-right"],[1,"right"],[3,"routerLink"]],template:function(t,n){1&t&&(l.TgZ(0,"mat-card"),l.TgZ(1,"mat-card-header"),l._uU(2),l.qZA(),l.TgZ(3,"mat-card-content"),l.TgZ(4,"table",0),l.TgZ(5,"thead"),l.TgZ(6,"tr"),l.TgZ(7,"th"),l._uU(8,"Name"),l.qZA(),l.TgZ(9,"th",1),l._uU(10,"Institution"),l.qZA(),l.TgZ(11,"th",1),l._uU(12,"Account Type"),l.qZA(),l.TgZ(13,"th",1),l._uU(14,"Category"),l.qZA(),l.TgZ(15,"th"),l._uU(16," Balance At: "),l.TgZ(17,"em"),l._uU(18),l.ALo(19,"date"),l.qZA(),l.qZA(),l.TgZ(20,"th"),l._uU(21," Balance At: "),l.TgZ(22,"em"),l._uU(23),l.ALo(24,"date"),l.qZA(),l.qZA(),l.TgZ(25,"th"),l._uU(26,"Current Balance"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(27,"tbody"),l.YNc(28,J,19,18,"tr",2),l.qZA(),l.TgZ(29,"tfoot"),l.TgZ(30,"tr",3),l.TgZ(31,"th",4),l._uU(32,"Total"),l.qZA(),l.TgZ(33,"th",5),l._uU(34),l.ALo(35,"ecMoney"),l.qZA(),l.TgZ(36,"th",5),l._uU(37),l.ALo(38,"ecMoney"),l.qZA(),l.TgZ(39,"th",5),l._uU(40),l.ALo(41,"ecMoney"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(2),l.Oqu(n.heading),l.xp6(16),l.Oqu(l.xi3(19,7,null==n.firstBankAccount?null:n.firstBankAccount.closing_date,"MMM dd")),l.xp6(5),l.Oqu(l.xi3(24,10,null==n.firstBankAccount?null:n.firstBankAccount.next_closing_date,"MMM dd")),l.xp6(5),l.Q6J("ngForOf",n.bankAccounts),l.xp6(6),l.hij(" ",l.lcZ(35,13,n.closingBalance())," "),l.xp6(3),l.hij(" ",l.lcZ(38,15,n.expectedClosingBalance())," "),l.xp6(3),l.hij(" ",l.lcZ(41,17,n.currentBalance())," "))},directives:[x.a8,x.dk,x.dn,s.sg,u.yS],pipes:[s.uU,B.L],encapsulation:2,changeDetection:0}),n}(),j=function(){var n=function(){function n(e){t(this,n),this.abs=e,this.bankAccounts=[],this.totalAssets=0,this.totalLiabilities=0,this.netCurrentCash=0,this.netCashAssets=0,this.netNonCashAssets=0,this.netWorth=0}return e(n,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(t){this.updateTotals()}},{key:"updateTotals",value:function(){this.totalAssets=this.abs.totalAssets(this.bankAccounts),this.totalLiabilities=this.abs.totalLiabilities(this.bankAccounts),this.netCurrentCash=this.abs.netCurrentCash(this.bankAccounts),this.netCashAssets=this.abs.netCashAssets(this.bankAccounts),this.netNonCashAssets=this.abs.netNonCashAssets(this.bankAccounts),this.netWorth=this.abs.netWorth(this.bankAccounts)}}]),n}();return n.\u0275fac=function(t){return new(t||n)(l.Y36(v))},n.\u0275cmp=l.Xpm({type:n,selectors:[["ec-account-balance-totals"]],inputs:{bankAccounts:"bankAccounts"},features:[l.TTD],decls:23,vars:5,consts:[["fxLayout","column",1,"holder"],["fxLayout","row","fxLayoutAlign","end end"],["fxFlex","80"],["fxFlex","20",3,"value"],["fxLayout","row","fxLayoutAlign","end center",1,"net-worth"],["fxLayout","row",1,"net-worth","text-right"],["fxFlex","80","fxFlexAlign","end"],["fxLayout","row","fxLayoutAlign","end center",1,"net-worth","text-right"],["fxLayout","row"]],template:function(t,n){1&t&&(l.TgZ(0,"div",0),l.TgZ(1,"h3",1),l.TgZ(2,"span",2),l._uU(3,"Total Liabilities"),l.qZA(),l._UZ(4,"ec-money-field",3),l.qZA(),l._UZ(5,"hr"),l.TgZ(6,"h3",4),l.TgZ(7,"span",2),l._uU(8,"Net Current Cash:"),l.qZA(),l._UZ(9,"ec-money-field",3),l.qZA(),l.TgZ(10,"h3",5),l.TgZ(11,"span",6),l._uU(12,"Net Cash Assets:"),l.qZA(),l._UZ(13,"ec-money-field",3),l.qZA(),l.TgZ(14,"h3",7),l.TgZ(15,"span",2),l._uU(16,"Net Non Cash Assets:"),l.qZA(),l._UZ(17,"ec-money-field",3),l.qZA(),l._UZ(18,"hr"),l.TgZ(19,"h2",8),l.TgZ(20,"span",2),l._uU(21,"Net Worth:"),l.qZA(),l._UZ(22,"ec-money-field",3),l.qZA(),l.qZA()),2&t&&(l.xp6(4),l.Q6J("value",n.abs.totalLiabilities(n.bankAccounts)),l.xp6(5),l.Q6J("value",n.abs.netCurrentCash(n.bankAccounts)),l.xp6(4),l.Q6J("value",n.abs.netCashAssets(n.bankAccounts)),l.xp6(4),l.Q6J("value",n.abs.netNonCashAssets(n.bankAccounts)),l.xp6(5),l.Q6J("value",n.abs.netWorth(n.bankAccounts)))},directives:[T.xw,T.Wh,T.yH,g.x,T.XD],styles:["div.holder[_ngcontent-%COMP%]{margin:30px}span[_ngcontent-%COMP%], ec-money-field[_ngcontent-%COMP%]{text-align:end}hr[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),n}(),N=[{path:"",canActivate:[i.a],children:[{path:"",component:function(){var n=function(){function n(e,c,a,s){t(this,n),this.toolbarService=e,this.accountBalancesService=c,this.dialog=a,this.messageService=s,this.bankAccounts=[],this.totalAssets=0,this.searchParams={},this.includeClosedAccounts=!1}return e(n,[{key:"ngOnInit",value:function(){this.toolbarService.setHeading("Account Balances"),this.refreshBankAccountList()}},{key:"onIncludeClosedChanged",value:function(t){this.includeClosedAccounts=t.checked,this.refreshBankAccountList()}},{key:"refreshBankAccountList",value:function(){var t=this;this.accountBalancesService.getAccountBalances$(this.includeClosedAccounts).subscribe(function(n){t.bankAccounts=n,t.updateBankAccountLists(),t.totalAssets=t.accountBalancesService.totalAssets(t.bankAccounts)})}},{key:"updateBankAccountLists",value:function(){this.currentAccounts=this.bankAccounts.filter(function(t){return"current"===t.account_category}),this.assetAccounts=this.bankAccounts.filter(function(t){return"asset"===t.account_category}),this.cashAssetAccounts=this.bankAccounts.filter(function(t){return"asset"===t.account_category&&t.is_cash}),this.nonCashAssetAccounts=this.bankAccounts.filter(function(t){return"asset"===t.account_category&&!t.is_cash}),this.liabilityAccounts=this.bankAccounts.filter(function(t){return"liability"===t.account_category}),this.creditCardAccounts=this.bankAccounts.filter(function(t){return"liability"===t.account_category&&t.is_cash}),this.loanAccounts=this.bankAccounts.filter(function(t){return"liability"===t.account_category&&!t.is_cash})}},{key:"showAdjustAccountBalancesForm",value:function(){var t=this;this.dialogRef=this.dialog.open(k,{maxHeight:600});var n=this.dialogRef.componentInstance;n.bankAccounts=this.bankAccounts,n.save.pipe((0,r.w)(function(n){return t.accountBalancesService.adjustAccountBalances(n)})).subscribe(function(n){t.messageService.setMessage("Balances adjusted."),t.refreshBankAccountList(),t.dialogRef.close()})}}]),n}();return n.\u0275fac=function(t){return new(t||n)(l.Y36(_.S),l.Y36(v),l.Y36(A.uw),l.Y36(m.e))},n.\u0275cmp=l.Xpm({type:n,selectors:[["ec-account-balances"]],decls:18,vars:10,consts:[[1,"main"],["fxLayout","column"],["fxLayoutAlign","space-between",1,"button-row"],["fxFlexAlign","center end",3,"checked","change"],["mat-raised-button","","color","primary",1,"adjust-balances",3,"click"],["heading","Current Accounts",3,"bankAccounts"],["heading","Cash Assets",3,"bankAccounts"],["heading","Non Cash Assets",3,"bankAccounts"],["fxLayoutAlign","end",1,"total"],["heading","Credit Cards",3,"bankAccounts"],["heading","Loans",3,"bankAccounts"],[3,"bankAccounts"]],template:function(t,n){1&t&&(l.TgZ(0,"mat-card",0),l.TgZ(1,"mat-card-content"),l.TgZ(2,"div",1),l.TgZ(3,"div",2),l.TgZ(4,"mat-slide-toggle",3),l.NdJ("change",function(t){return n.onIncludeClosedChanged(t)}),l._uU(5," Include Closed Accounts? "),l.qZA(),l.TgZ(6,"button",4),l.NdJ("click",function(){return n.showAdjustAccountBalancesForm()}),l._uU(7," Adjust Account Balances "),l.qZA(),l.qZA(),l._UZ(8,"ec-account-list",5),l._UZ(9,"ec-account-list",6),l._UZ(10,"ec-account-list",7),l.TgZ(11,"div",8),l.TgZ(12,"h3"),l._uU(13),l.ALo(14,"ecMoney"),l.qZA(),l.qZA(),l._UZ(15,"ec-account-list",9),l._UZ(16,"ec-account-list",10),l._UZ(17,"ec-account-balance-totals",11),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(4),l.Q6J("checked",!1),l.xp6(4),l.Q6J("bankAccounts",n.currentAccounts),l.xp6(1),l.Q6J("bankAccounts",n.cashAssetAccounts),l.xp6(1),l.Q6J("bankAccounts",n.nonCashAssetAccounts),l.xp6(3),l.hij("Total Assets: ",l.lcZ(14,8,n.totalAssets),""),l.xp6(2),l.Q6J("bankAccounts",n.creditCardAccounts),l.xp6(1),l.Q6J("bankAccounts",n.loanAccounts),l.xp6(1),l.Q6J("bankAccounts",n.bankAccounts))},directives:[x.a8,x.dn,T.xw,T.Wh,q.Rr,T.XD,C.lW,M,j],pipes:[B.L],styles:[".total[_ngcontent-%COMP%]{margin-right:25px}ec-account-list[_ngcontent-%COMP%]{margin-bottom:5px}.button-row[_ngcontent-%COMP%]{margin-top:15px;margin-bottom:15px}"]}),n}()}]}],O=function(){var n=function n(){t(this,n)};return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.oAB({type:n}),n.\u0275inj=l.cJS({providers:[],imports:[[u.Bz.forChild(N)],u.Bz]}),n}(),Q=function(){var n=function n(){t(this,n)};return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.oAB({type:n}),n.\u0275inj=l.cJS({providers:[v],imports:[[s.ez,o.m,O]]}),n}()}}])}();