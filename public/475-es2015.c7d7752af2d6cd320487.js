"use strict";(self.webpackChunkeverycent=self.webpackChunkeverycent||[]).push([[475],{2475:function(t,n,e){e.r(n),e.d(n,{AccountBalancesModule:function(){return N}});var c=e(38583),s=e(32833),a=e(54655),o=e(31265),i=e(43190),u=e(37716),r=e(3679),l=e(22238),h=e(56326),A=e(57576);function d(t,n){if(1&t&&(u.TgZ(0,"th"),u._uU(1),u.qZA()),2&t){const t=n.$implicit;u.xp6(1),u.hij(" ",t.name," ")}}function g(t,n){if(1&t&&(u.TgZ(0,"td",8),u.TgZ(1,"div",9),u._UZ(2,"ec-money-field",10),u.qZA(),u.qZA()),2&t){const t=n.index;u.xp6(1),u.Q6J("formGroupName",t),u.xp6(1),u.Q6J("editMode",!1)}}function Z(t,n){if(1&t&&(u.TgZ(0,"td",8),u.TgZ(1,"div",9),u._UZ(2,"ec-money-field",11),u.qZA(),u.qZA()),2&t){const t=n.index;u.xp6(1),u.Q6J("formGroupName",t),u.xp6(1),u.Q6J("editMode",!0)}}let b=(()=>{class t{constructor(t,n){this.fb=t,this.dialogRef=n,this.bankAccounts=[],this.save=new u.vpe,this.cancel=new u.vpe}ngOnInit(){this.createForm()}createForm(){let t=this.bankAccounts.map(t=>this.fb.group({bank_account_id:t.id,new_balance:t.current_balance,currentBalance:t.current_balance}));this.form=this.fb.group({adjustments:this.fb.array(t)})}saveChanges(){this.save.emit(this.form.value),this.save.complete()}cancelChanges(){this.cancel.emit(),this.cancel.complete(),this.dialogRef.close()}}return t.\u0275fac=function(n){return new(n||t)(u.Y36(r.qu),u.Y36(l.so))},t.\u0275cmp=u.Xpm({type:t,selectors:[["ec-adjust-balances"]],inputs:{bankAccounts:"bankAccounts"},outputs:{save:"save",cancel:"cancel"},decls:21,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"table"],[4,"ngFor","ngForOf"],["formArrayName","adjustments",4,"ngFor","ngForOf"],["mat-dialog-actions",""],[3,"editMode","save","cancel"],["formArrayName","adjustments"],[3,"formGroupName"],["formControlName","currentBalance",3,"editMode"],["formControlName","new_balance",3,"editMode"]],template:function(t,n){1&t&&(u.TgZ(0,"h1",0),u._uU(1,"Adjust Account Balances"),u.qZA(),u.TgZ(2,"div",1),u.TgZ(3,"div",2),u.TgZ(4,"table",3),u.TgZ(5,"thead"),u.TgZ(6,"tr"),u.TgZ(7,"th"),u._uU(8,"Bank Account"),u.qZA(),u.YNc(9,d,2,1,"th",4),u.qZA(),u.qZA(),u.TgZ(10,"tbody"),u.TgZ(11,"tr"),u.TgZ(12,"td"),u._uU(13," Current Balance "),u.qZA(),u.YNc(14,g,3,2,"td",5),u.qZA(),u.TgZ(15,"tr"),u.TgZ(16,"td"),u._uU(17," New Account Balance "),u.qZA(),u.YNc(18,Z,3,2,"td",5),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(19,"div",6),u.TgZ(20,"ec-edit-actions",7),u.NdJ("save",function(){return n.saveChanges()})("cancel",function(){return n.cancelChanges()}),u.qZA(),u.qZA()),2&t&&(u.xp6(3),u.Q6J("formGroup",n.form),u.xp6(6),u.Q6J("ngForOf",n.bankAccounts),u.xp6(5),u.Q6J("ngForOf",n.bankAccounts),u.xp6(4),u.Q6J("ngForOf",n.bankAccounts),u.xp6(2),u.Q6J("editMode",!0))},directives:[l.uh,l.xY,r.JL,r.sg,c.sg,l.H8,h.Y,r.CE,r.x0,A.x,r.JJ,r.u],encapsulation:2}),t})();var p=e(29675),f=e(75572);let _=(()=>{class t{constructor(t){this.apiGateway=t}getAccountBalances$(t){let n="/account_balances";return t&&(n+="?include_closed=true"),this.bankAccounts$=this.apiGateway.get(n),this.bankAccounts$}netWorth(t){let n=0;return t.forEach(t=>{n+=t.current_balance}),n}adjustAccountBalances(t){return t.adjustments=t.adjustments.filter(t=>t.new_balance!==t.currentBalance),this.apiGateway.post("/bank_accounts/manually_adjust_balances",t)}totalAssets(t){return t.filter(t=>"asset"===t.account_category).reduce((t,n)=>t+n.current_balance,0)}totalLiabilities(t){return t.filter(t=>"liability"===t.account_category).reduce((t,n)=>t+n.current_balance,0)}netCurrentCash(t){return t.filter(t=>"current"===t.account_category||"liability"===t.account_category&&t.is_cash).reduce((t,n)=>t+n.current_balance,0)}netCashAssets(t){return t.filter(t=>"asset"===t.account_category&&t.is_cash).reduce((t,n)=>t+n.current_balance,0)}netNonCashAssets(t){return t.filter(t=>("asset"===t.account_category||"liability"===t.account_category)&&!t.is_cash).reduce((t,n)=>t+n.current_balance,0)}}return t.\u0275fac=function(n){return new(n||t)(u.LFG(f.i))},t.\u0275prov=u.Yz7({token:t,factory:t.\u0275fac}),t})();var m=e(28731),k=e(93738),x=e(35618),T=e(45396),q=e(51095),y=e(21906),C=e(52205);const v=function(t){return{bank_account_id:t}},U=function(t){return["..","transactions",t]};function B(t,n){if(1&t&&(u.TgZ(0,"tr"),u.TgZ(1,"td"),u.TgZ(2,"a",6),u._uU(3),u.qZA(),u.qZA(),u.TgZ(4,"td",1),u._uU(5),u.qZA(),u.TgZ(6,"td",1),u._uU(7),u.qZA(),u.TgZ(8,"td",1),u._uU(9),u.qZA(),u.TgZ(10,"td",5),u._uU(11),u.ALo(12,"ecMoney"),u.qZA(),u.TgZ(13,"td",5),u._uU(14),u.ALo(15,"ecMoney"),u.qZA(),u.TgZ(16,"td",5),u._uU(17),u.ALo(18,"ecMoney"),u.qZA(),u.qZA()),2&t){const t=n.$implicit;u.xp6(2),u.Q6J("routerLink",u.VKq(16,U,u.VKq(14,v,t.id))),u.xp6(1),u.hij(" ",null==t?null:t.name,""),u.xp6(2),u.Oqu(null==t||null==t.institution?null:t.institution.name),u.xp6(2),u.Oqu(null==t?null:t.account_type),u.xp6(2),u.Oqu(null==t?null:t.account_category),u.xp6(2),u.hij(" ",u.lcZ(12,8,null==t?null:t.closing_balance)," "),u.xp6(3),u.hij(" ",u.lcZ(15,10,null==t?null:t.expected_closing_balance)," "),u.xp6(3),u.hij(" ",u.lcZ(18,12,null==t?null:t.current_balance)," ")}}let L=(()=>{class t{constructor(){this.heading="",this.bankAccounts=[],this.firstBankAccount={id:0,name:""}}ngOnInit(){}ngOnChanges(t){this.firstBankAccount=this.bankAccounts&&this.bankAccounts[0]?this.bankAccounts[0]:{}}closingBalance(){return(0,y.M)(this.bankAccounts,"closing_balance")}expectedClosingBalance(){return(0,y.M)(this.bankAccounts,"expected_closing_balance")}currentBalance(){return(0,y.M)(this.bankAccounts,"current_balance")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=u.Xpm({type:t,selectors:[["ec-account-list"]],inputs:{heading:"heading",bankAccounts:"bankAccounts"},features:[u.TTD],decls:42,vars:19,consts:[[1,"table"],[1,"hidden-xs"],[4,"ngFor","ngForOf"],[1,"total"],["colspan","4",1,"hidden-xs","text-right"],[1,"right"],[3,"routerLink"]],template:function(t,n){1&t&&(u.TgZ(0,"mat-card"),u.TgZ(1,"mat-card-header"),u._uU(2),u.qZA(),u.TgZ(3,"mat-card-content"),u.TgZ(4,"table",0),u.TgZ(5,"thead"),u.TgZ(6,"tr"),u.TgZ(7,"th"),u._uU(8,"Name"),u.qZA(),u.TgZ(9,"th",1),u._uU(10,"Institution"),u.qZA(),u.TgZ(11,"th",1),u._uU(12,"Account Type"),u.qZA(),u.TgZ(13,"th",1),u._uU(14,"Category"),u.qZA(),u.TgZ(15,"th"),u._uU(16," Balance At: "),u.TgZ(17,"em"),u._uU(18),u.ALo(19,"date"),u.qZA(),u.qZA(),u.TgZ(20,"th"),u._uU(21," Balance At: "),u.TgZ(22,"em"),u._uU(23),u.ALo(24,"date"),u.qZA(),u.qZA(),u.TgZ(25,"th"),u._uU(26,"Current Balance"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(27,"tbody"),u.YNc(28,B,19,18,"tr",2),u.qZA(),u.TgZ(29,"tfoot"),u.TgZ(30,"tr",3),u.TgZ(31,"th",4),u._uU(32,"Total"),u.qZA(),u.TgZ(33,"th",5),u._uU(34),u.ALo(35,"ecMoney"),u.qZA(),u.TgZ(36,"th",5),u._uU(37),u.ALo(38,"ecMoney"),u.qZA(),u.TgZ(39,"th",5),u._uU(40),u.ALo(41,"ecMoney"),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&t&&(u.xp6(2),u.Oqu(n.heading),u.xp6(16),u.Oqu(u.xi3(19,7,null==n.firstBankAccount?null:n.firstBankAccount.closing_date,"MMM dd")),u.xp6(5),u.Oqu(u.xi3(24,10,null==n.firstBankAccount?null:n.firstBankAccount.next_closing_date,"MMM dd")),u.xp6(5),u.Q6J("ngForOf",n.bankAccounts),u.xp6(6),u.hij(" ",u.lcZ(35,13,n.closingBalance())," "),u.xp6(3),u.hij(" ",u.lcZ(38,15,n.expectedClosingBalance())," "),u.xp6(3),u.hij(" ",u.lcZ(41,17,n.currentBalance())," "))},directives:[k.a8,k.dk,k.dn,c.sg,a.yS],pipes:[c.uU,C.L],encapsulation:2,changeDetection:0}),t})(),w=(()=>{class t{constructor(t){this.abs=t,this.bankAccounts=[],this.totalAssets=0,this.totalLiabilities=0,this.netCurrentCash=0,this.netCashAssets=0,this.netNonCashAssets=0,this.netWorth=0}ngOnInit(){}ngOnChanges(t){this.updateTotals()}updateTotals(){this.totalAssets=this.abs.totalAssets(this.bankAccounts),this.totalLiabilities=this.abs.totalLiabilities(this.bankAccounts),this.netCurrentCash=this.abs.netCurrentCash(this.bankAccounts),this.netCashAssets=this.abs.netCashAssets(this.bankAccounts),this.netNonCashAssets=this.abs.netNonCashAssets(this.bankAccounts),this.netWorth=this.abs.netWorth(this.bankAccounts)}}return t.\u0275fac=function(n){return new(n||t)(u.Y36(_))},t.\u0275cmp=u.Xpm({type:t,selectors:[["ec-account-balance-totals"]],inputs:{bankAccounts:"bankAccounts"},features:[u.TTD],decls:23,vars:5,consts:[["fxLayout","column",1,"holder"],["fxLayout","row","fxLayoutAlign","end end"],["fxFlex","80"],["fxFlex","20",3,"value"],["fxLayout","row","fxLayoutAlign","end center",1,"net-worth"],["fxLayout","row",1,"net-worth","text-right"],["fxFlex","80","fxFlexAlign","end"],["fxLayout","row","fxLayoutAlign","end center",1,"net-worth","text-right"],["fxLayout","row"]],template:function(t,n){1&t&&(u.TgZ(0,"div",0),u.TgZ(1,"h3",1),u.TgZ(2,"span",2),u._uU(3,"Total Liabilities"),u.qZA(),u._UZ(4,"ec-money-field",3),u.qZA(),u._UZ(5,"hr"),u.TgZ(6,"h3",4),u.TgZ(7,"span",2),u._uU(8,"Net Current Cash:"),u.qZA(),u._UZ(9,"ec-money-field",3),u.qZA(),u.TgZ(10,"h3",5),u.TgZ(11,"span",6),u._uU(12,"Net Cash Assets:"),u.qZA(),u._UZ(13,"ec-money-field",3),u.qZA(),u.TgZ(14,"h3",7),u.TgZ(15,"span",2),u._uU(16,"Net Non Cash Assets:"),u.qZA(),u._UZ(17,"ec-money-field",3),u.qZA(),u._UZ(18,"hr"),u.TgZ(19,"h2",8),u.TgZ(20,"span",2),u._uU(21,"Net Worth:"),u.qZA(),u._UZ(22,"ec-money-field",3),u.qZA(),u.qZA()),2&t&&(u.xp6(4),u.Q6J("value",n.abs.totalLiabilities(n.bankAccounts)),u.xp6(5),u.Q6J("value",n.abs.netCurrentCash(n.bankAccounts)),u.xp6(4),u.Q6J("value",n.abs.netCashAssets(n.bankAccounts)),u.xp6(4),u.Q6J("value",n.abs.netNonCashAssets(n.bankAccounts)),u.xp6(5),u.Q6J("value",n.abs.netWorth(n.bankAccounts)))},directives:[x.xw,x.Wh,x.yH,A.x,x.XD],styles:["div.holder[_ngcontent-%COMP%]{margin:30px}span[_ngcontent-%COMP%], ec-money-field[_ngcontent-%COMP%]{text-align:end}hr[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),t})();const J=[{path:"",canActivate:[o.a],children:[{path:"",component:(()=>{class t{constructor(t,n,e,c){this.toolbarService=t,this.accountBalancesService=n,this.dialog=e,this.messageService=c,this.bankAccounts=[],this.totalAssets=0,this.searchParams={},this.includeClosedAccounts=!1}ngOnInit(){this.toolbarService.setHeading("Account Balances"),this.refreshBankAccountList()}onIncludeClosedChanged(t){this.includeClosedAccounts=t.checked,this.refreshBankAccountList()}refreshBankAccountList(){this.accountBalancesService.getAccountBalances$(this.includeClosedAccounts).subscribe(t=>{this.bankAccounts=t,this.updateBankAccountLists(),this.totalAssets=this.accountBalancesService.totalAssets(this.bankAccounts)})}updateBankAccountLists(){this.currentAccounts=this.bankAccounts.filter(t=>"current"===t.account_category),this.assetAccounts=this.bankAccounts.filter(t=>"asset"===t.account_category),this.cashAssetAccounts=this.bankAccounts.filter(t=>"asset"===t.account_category&&t.is_cash),this.nonCashAssetAccounts=this.bankAccounts.filter(t=>"asset"===t.account_category&&!t.is_cash),this.liabilityAccounts=this.bankAccounts.filter(t=>"liability"===t.account_category),this.creditCardAccounts=this.bankAccounts.filter(t=>"liability"===t.account_category&&t.is_cash),this.loanAccounts=this.bankAccounts.filter(t=>"liability"===t.account_category&&!t.is_cash)}showAdjustAccountBalancesForm(){this.dialogRef=this.dialog.open(b,{maxHeight:600});const t=this.dialogRef.componentInstance;t.bankAccounts=this.bankAccounts,t.save.pipe((0,i.w)(t=>this.accountBalancesService.adjustAccountBalances(t))).subscribe(t=>{this.messageService.setMessage("Balances adjusted."),this.refreshBankAccountList(),this.dialogRef.close()})}}return t.\u0275fac=function(n){return new(n||t)(u.Y36(p.S),u.Y36(_),u.Y36(l.uw),u.Y36(m.e))},t.\u0275cmp=u.Xpm({type:t,selectors:[["ec-account-balances"]],decls:18,vars:10,consts:[[1,"main"],["fxLayout","column"],["fxLayoutAlign","space-between",1,"button-row"],["fxFlexAlign","center end",3,"checked","change"],["mat-raised-button","","color","primary",1,"adjust-balances",3,"click"],["heading","Current Accounts",3,"bankAccounts"],["heading","Cash Assets",3,"bankAccounts"],["heading","Non Cash Assets",3,"bankAccounts"],["fxLayoutAlign","end",1,"total"],["heading","Credit Cards",3,"bankAccounts"],["heading","Loans",3,"bankAccounts"],[3,"bankAccounts"]],template:function(t,n){1&t&&(u.TgZ(0,"mat-card",0),u.TgZ(1,"mat-card-content"),u.TgZ(2,"div",1),u.TgZ(3,"div",2),u.TgZ(4,"mat-slide-toggle",3),u.NdJ("change",function(t){return n.onIncludeClosedChanged(t)}),u._uU(5," Include Closed Accounts? "),u.qZA(),u.TgZ(6,"button",4),u.NdJ("click",function(){return n.showAdjustAccountBalancesForm()}),u._uU(7," Adjust Account Balances "),u.qZA(),u.qZA(),u._UZ(8,"ec-account-list",5),u._UZ(9,"ec-account-list",6),u._UZ(10,"ec-account-list",7),u.TgZ(11,"div",8),u.TgZ(12,"h3"),u._uU(13),u.ALo(14,"ecMoney"),u.qZA(),u.qZA(),u._UZ(15,"ec-account-list",9),u._UZ(16,"ec-account-list",10),u._UZ(17,"ec-account-balance-totals",11),u.qZA(),u.qZA(),u.qZA()),2&t&&(u.xp6(4),u.Q6J("checked",!1),u.xp6(4),u.Q6J("bankAccounts",n.currentAccounts),u.xp6(1),u.Q6J("bankAccounts",n.cashAssetAccounts),u.xp6(1),u.Q6J("bankAccounts",n.nonCashAssetAccounts),u.xp6(3),u.hij("Total Assets: ",u.lcZ(14,8,n.totalAssets),""),u.xp6(2),u.Q6J("bankAccounts",n.creditCardAccounts),u.xp6(1),u.Q6J("bankAccounts",n.loanAccounts),u.xp6(1),u.Q6J("bankAccounts",n.bankAccounts))},directives:[k.a8,k.dn,x.xw,x.Wh,T.Rr,x.XD,q.lW,L,w],pipes:[C.L],styles:[".total[_ngcontent-%COMP%]{margin-right:25px}ec-account-list[_ngcontent-%COMP%]{margin-bottom:5px}.button-row[_ngcontent-%COMP%]{margin-top:15px;margin-bottom:15px}"]}),t})()}]}];let M=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({providers:[],imports:[[a.Bz.forChild(J)],a.Bz]}),t})(),N=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({providers:[_],imports:[[c.ez,s.m,M]]}),t})()}}]);