!function(){"use strict";function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var a,i,o=[],r=!0,c=!1;try{for(e=e.call(t);!(r=(a=e.next()).done)&&(o.push(a.value),!n||o.length!==n);r=!0);}catch(u){c=!0,i=u}finally{try{r||null==e.return||e.return()}finally{if(c)throw i}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,a=new Array(n);e<n;e++)a[e]=t[e];return a}function e(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function a(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function i(t,n,e){return n&&a(t.prototype,n),e&&a(t,e),t}(self.webpackChunkeverycent=self.webpackChunkeverycent||[]).push([[688],{44688:function(n,a,o){o.r(a),o.d(a,{TransactionsModule:function(){return yn}});var r,c=o(10232),u=o(32833),s=o(37716),l=((r=function(){function n(){e(this,n)}return i(n,[{key:"convertToTransactions",value:function(t,n,e){for(var a=this.convertInputToLines(t),i=a.length/3,o=[],r=0;r<i;r++){var c=a[3*r+0],u=a[3*r+1],s=this.extractAmount(a[3*r+2]),l={transaction_date:this.extractDate(u),description:c.trim(),withdrawal_amount:s<0?-1*s:0,deposit_amount:s>0?s:0,status:"unpaid"};l.transaction_date instanceof Date||new Date(l.transaction_date),l.transaction_date>=n&&l.transaction_date<=e&&o.push(l)}return o}},{key:"convertInputToLines",value:function(n){if(!n)return[];for(var e=n.trim().split(/[\n]/),a=[],i=0;i<e.length;i++){var o=e[i].match(/(\d+ [A-z]{3})(\u20ac.*(Credit|Debit))/);if(o){var r=t(o,3),c=(r[0],r[1]),u=r[2];a.push("".concat(c," | 12:00"),u)}else a.push(e[i])}return a.filter(function(t){return""!==t.trim()&&"Reserved"!==t.trim()&&"Extra Card"!==t.trim()})}},{key:"currentDate",value:function(){return new Date}},{key:"extractDate",value:function(n){var e=this.currentDate().getFullYear(),a=t(n.match(/(\d+) ([A-z]{3}) | .+/),3),i=(a[0],a[1]),o=a[2],r=i.padStart(2,"0");return"".concat(e,"-").concat({Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"}[o],"-").concat(r)}},{key:"extractAmount",value:function(n){var e=t(n.match(/\u20ac(.*)(Credit|Debit)/),3),a=(e[0],e[1]),i=e[2],o=Math.floor(100*Number(a.replace(".","").replace(",",".")));return"Credit"===i?o:-1*o}}]),n}()).\u0275fac=function(t){return new(t||r)},r.\u0275prov=s.Yz7({token:r,factory:r.\u0275fac}),r),d=function(){var t=function(){function t(){e(this,t)}return i(t,[{key:"convertToTransactions",value:function(t,n,e){var a,i,o,r,c=this,u=new Date(n),s=new Date(e),l=[],d="";return this._convertInputToLines(t).forEach(function(t){if(c.isDate(t))i=c.extractDate(t);else{if(c.isNumber(t)){var n=c.extractNumberParts(t);"+"===n.sign?(r=n.amount,o=0):(r=0,o=n.amount)}else"NL"!==t.substr(0,2)&&(d+=t);c.isEndOfTransaction(t)&&(((a={transaction_date:i,description:d,withdrawal_amount:o,deposit_amount:r,status:"unpaid"}).transaction_date<u||a.transaction_date>s)&&(a.deleted=!0),0===a.withdrawal_amount&&0===a.deposit_amount&&(a.deleted=!0),a.transaction_date=a.transaction_date.toISOString().substr(0,10),l.push(a),d="",o=0,r=0)}}),l}},{key:"_convertInputToLines",value:function(t){return t?t.split(/[\n]/):[]}},{key:"isDate",value:function(t){return!!t&&(t.match(/(\d\d?) ([A-z]{3}) `(\d\d)/)||this.isNewDateFormat(t))}},{key:"isNewDateFormat",value:function(t){return t.match(/^(\d{2})\-(\d{2})\-(\d{4})/)}},{key:"extractDate",value:function(t){if(this.isDate(t)){var n=this.isNewDateFormat(t);return n?new Date("".concat(n[3],"-").concat(n[2],"-").concat(n[1])):new Date(t.replace(/`/g,""))}}},{key:"isNumber",value:function(t){var n=t.trim().substr(0,1);return"-"===n||"+"===n||"\u20ac"===n}},{key:"extractNumberParts",value:function(t){"\u20ac"===t.substr(0,1)&&(t=t.substr(1));var n=t.trim().substr(0,1),e=t.substring(1).trim().replace(/\./g,"").replace(/,/g,".");return{sign:n,amount:100*Number(e)}}},{key:"isEndOfTransaction",value:function(t){return this.isNumber(t)}}]),t}();return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac}),t}(),f=function(){var n=function(){function n(t,a){e(this,n),this.creditCardImporter=t,this.oldImporter=a}return i(n,[{key:"convertFromCreditCardFormat",value:function(t,n,e){return this.creditCardImporter.convertToTransactions(t,n,e)}},{key:"convertFromOldBankFormat",value:function(t,n,e){return this.oldImporter.convertToTransactions(t,n,e)}},{key:"convertFromBankFormat",value:function(t,n,e){var a,i,o,r,c=this,u=new Date(n),s=new Date(e),l=[],d="";return this._convertInputToLines(t).forEach(function(t){if(!c.isBlank(t)){if(c.isDate(t))return void(i=c.extractDate(t));if(c.isNumber(t)){var n=c.extractAmount(t);return void(n<0?(o=Math.abs(n),r=0):(o=0,r=n))}c.isDescription(t)&&(d=t),c.isEndOfTransaction(t)&&(((a={transaction_date:i,description:d,withdrawal_amount:o,deposit_amount:r,status:"paid"}).transaction_date<u||a.transaction_date>s)&&(a.deleted=!0),0===a.withdrawal_amount&&0===a.deposit_amount&&(a.deleted=!0),a.transaction_date&&a.transaction_date.toISOString&&(a.transaction_date=a.transaction_date.toISOString().substr(0,10)),l.push(a),d="",o=0,r=0)}}),l}},{key:"_convertInputToLines",value:function(t){return t?t.split(/[\n]/):[]}},{key:"isDate",value:function(t){return!!t&&("today"===t||"yesterday"===t||this.isFormattedDate(t))}},{key:"isFormattedDate",value:function(t){var n={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11},e=t.match(/^(\d{1,2}) ([A-z]+) (\d{4})/);return e?{day:e[1],month:n[e[2]],year:e[3]}:!!(e=t.match(/^([A-z]+) (\d{1,2}), (\d{4})/))&&{month:n[e[1]],day:e[2],year:e[3]}}},{key:"currentDate",value:function(){return new Date}},{key:"extractDate",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentDate();if(this.isDate(t)){if("today"===t)return n;if("yesterday"===t){var e=new Date(n.valueOf());return e.setDate(e.getDate()-1),e}var a=this.isFormattedDate(t);return new Date(a.year,a.month,a.day,10)}}},{key:"isAmount",value:function(t){return!this.isDate(t)&&t.trim().replace(/\./g,"").match(/\u20ac([+-]) (\d*,?\d*)/)}},{key:"extractAmount",value:function(n){var e=this.isAmount(n);if(!e)return 0;var a=t(e,3),i=(a[0],a[1]),o=a[2],r=Number(o.replace(/,/g,"."));return r=Math.round(100*r),"-"===i?-1*r:r}},{key:"isBlank",value:function(t){return!t||""===t.trim()}},{key:"isDescription",value:function(t){return!this.isBlank(t)&&!this.isDate(t)&&!this.isAmount(t)}},{key:"isNumber",value:function(t){var n=t.trim().substr(0,1);return"-"===n||"+"===n||"\u20ac"===n}},{key:"isEndOfTransaction",value:function(t){return this.isDescription(t)}}]),n}();return n.\u0275fac=function(t){return new(t||n)(s.LFG(l),s.LFG(d))},n.\u0275prov=s.Yz7({token:n,factory:n.\u0275fac}),n}(),m=function(){var t=function(){function t(){e(this,t)}return i(t,[{key:"convertFromCreditCardFormat",value:function(t,n,e){throw new Error("not implemented yet")}},{key:"convertFromBankFormat",value:function(t,n,e){var a=this;return this._convertInputToLines(t).map(function(t){return a._convertFCBankLineDataToTransaction(t,n,e)})}},{key:"_convertInputToLines",value:function(t){return t?t.split(/[\n]/):[]}},{key:"_convertFCBankLineDataToTransaction",value:function(t,n,e){var a={},i=t.split("\t");a.transaction_date=new Date(i[0]),a.description=i[1];var o=i[3];a.withdrawal_amount=this.extractNumberFromDollarString(i[2]),a.deposit_amount=this.extractNumberFromDollarString(o);var r=new Date(n),c=new Date(e);return(a.transaction_date<r||a.transaction_date>c)&&(a.deleted=!0),0===a.withdrawal_amount&&0===a.deposit_amount&&(a.deleted=!0),a}},{key:"extractNumberFromDollarString",value:function(t){if(!t)return 0;var n=t.replace(/\$/g,"");return 100*Number(n.replace(/,/g,""))}}]),t}();return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac}),t}(),h=function(){var t=function(){function t(){e(this,t)}return i(t,[{key:"convertToTransactions",value:function(t,n,e,a){return this._convertFromNewTransactionFormat(t,n,e,a)}},{key:"_convertFromNewTransactionFormat",value:function(t,n,e,a){var i=this._convertInputToLines(t),o=this._convertLinesToTransactionData(i);return this._convertTransactionArrayDataToTransactions(o,n,e,a)}},{key:"_convertInputToLines",value:function(t){return t?t.split(/[\n]/):[]}},{key:"_convertLinesToTransactionData",value:function(t){if(t===[])return[];var n=[],e=0,a=[];return t.forEach(function(t){a.push(t),++e>=4&&(n.push(a),a=[],e=0)}),n}},{key:"_convertTransactionArrayDataToTransactions",value:function(t,n,e,a){var i=this;return t.map(function(t){return i._convertTransactionArrayToTransaction(t,n,e,a)})}},{key:"_convertTransactionArrayToTransaction",value:function(t,n,e,a){if(4!==t.length)return{};var i=t[0],o=t[2],r=t[3],c=t[1].match(/^(\d{4})\s+(.*)$/),u="",s="";3!==c.length?(u="",s=""):(u=c[1],s=c[2]);var l=r.match(/^\s*(-?)\$(.*?)\sTTD/),d="",f="";3!==l.length?(d="",f="0"):(d=l[1],f=l[2]);var m={};m.transaction_date=new Date(i+" "+u),m.description=s+" "+o;var h=Number(f.replace(/,/g,""));if(""===d?(m.deposit_amount=100*h,m.withdrawal_amount=0):(m.deposit_amount=0,m.withdrawal_amount=100*h),"credit-card"===a){var g=m.withdrawal_amount;m.withdrawal_amount=m.deposit_amount,m.deposit_amount=g}var p=new Date(n),v=new Date(e);return(m.transaction_date<p||m.transaction_date>v)&&(m.deleted=!0),0===m.withdrawal_amount&&0===m.deposit_amount&&(m.deleted=!0),m}}]),t}();return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac}),t}(),g=function(){var n=function(){function n(){e(this,n)}return i(n,[{key:"convertFromBankFormat",value:function(t,n,e){var a=this;return this._convertInputToLines(t).map(function(t){return a.convertLineToTransaction(t,n,e)})}},{key:"_convertInputToLines",value:function(t){return t?t.trim().split(/[\n]/):[]}},{key:"convertLineToTransaction",value:function(n,e,a){if(!n)return{};var i={withdrawal_amount:0,deposit_amount:0,status:"paid"},o=t(n.trim().split(/[\t]/),7),r=(o[0],o[1]),c=(o[2],o[3]),u=(o[4],o[5],o[6]);i.transaction_date=this.extractDate(r),i.description=c;var s=this.extractAmount(u);s<0?i.withdrawal_amount=-1*s:s>0&&(i.deposit_amount=s);var l=new Date(e),d=new Date(a);return(i.transaction_date<l||i.transaction_date>d)&&(i.deleted=!0),0===i.withdrawal_amount&&0===i.deposit_amount&&(i.deleted=!0),i.transaction_date&&i.transaction_date.toISOString&&(i.transaction_date=i.transaction_date.toISOString().substr(0,10)),i}},{key:"extractDate",value:function(n){if(n){var e=n.match(/(\d\d?)-(\d\d)-(\d\d\d\d)/);if(e){var a=t(e,4),i=(a[0],a[1]),o=a[2],r=a[3];return new Date(Number(r),Number(o)-1,Number(i),10)}}}},{key:"extractAmount",value:function(t){return 100*Number(t)}}]),n}();return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=s.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n}(),p=function(){var t=function(){function t(n,a,i,o){e(this,t),this.fcbImporter=n,this.abnAmroImporter=a,this.scotiaImporter=i,this.republicImporter=o}return i(t,[{key:"convertToTransactions",value:function(t,n,e,a){return"fc-bank"===a?this.fcbImporter.convertFromBankFormat(t,n,e):"fc-creditcard"===a?this.fcbImporter.convertFromCreditCardFormat(t,n,e):"abn-amro-bank"===a?this.abnAmroImporter.convertFromBankFormat(t,n,e):"abn-amro-bank-old"===a?this.abnAmroImporter.convertFromOldBankFormat(t,n,e):"abn-amro-creditcard"===a?this.abnAmroImporter.convertFromCreditCardFormat(t,n,e):"republic-bank"===a?this.republicImporter.convertFromBankFormat(t,n,e):this.scotiaImporter.convertToTransactions(t,n,e,a)}}]),t}();return t.\u0275fac=function(n){return new(n||t)(s.LFG(m),s.LFG(f),s.LFG(h),s.LFG(g))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac}),t}(),v=[p,m,h,f,d,l],k=function(){var t=function t(){e(this,t)};return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({providers:[].concat(v),imports:[[u.m]]}),t}(),y=o(79765),b=o(9112),A=o(88002),_=o(87519),T=o(43190),Z=o(75572),w=function(){var t=function(){function t(n){e(this,t),this.apiGateway=n}return i(t,[{key:"getTransactions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({no_bank_account:!0},t);return delete n.budget,delete n.bankAccount,this.apiGateway.get("/transactions",n)}},{key:"save",value:function(t,n,e){var a=this.extractValidTransactionsInBudget(t,e);return this.apiGateway.post("/transactions",{bank_account_id:n.id,budget_id:e.id,transactions:a})}},{key:"extractValidTransactionsInBudget",value:function(t,n){var e=new Date(n.start_date),a=new Date(n.end_date);return t.filter(function(t){var n;return n="string"==typeof t.transaction_date?new Date(t.transaction_date):t.transaction_date,!t.deleted&&n>=e&&n<=a})}}]),t}();return t.\u0275fac=function(n){return new(n||t)(s.LFG(Z.i))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac}),t}(),x=o(44900),M=o(6497),C=function(){var t=function(){function t(n,a,i){e(this,t),this.transactionService=n,this.budgetService=a,this.bankAccountService=i,this.searchParamsSubject=new y.xQ}return i(t,[{key:"init",value:function(){this.searchParamsSubject=new y.xQ}},{key:"searchParams$",value:function(){return this.searchParamsSubject.asObservable()}},{key:"budgetId$",value:function(){return this.searchParams$().pipe((0,A.U)(function(t){return t.budget_id}))}},{key:"bankAccountId$",value:function(){return this.searchParams$().pipe((0,A.U)(function(t){return t.bank_account_id}))}},{key:"distinctBankAccountId$",value:function(){return this.bankAccountId$().pipe((0,_.x)())}},{key:"distinctBudgetId$",value:function(){return this.budgetId$().pipe((0,_.x)())}},{key:"transactions$",value:function(){var t=this;return this.searchParams$().pipe((0,T.w)(function(n){return t.transactionService.getTransactions(n)}))}},{key:"allocations$",value:function(){var t=this;return this.budgetId$().pipe((0,T.w)(function(n){return t.budgetService.getAllocations(n)}))}},{key:"sinkFundAllocation$",value:function(){var t=this;return this.distinctBankAccountId$().pipe((0,T.w)(function(n){return t.bankAccountService.getSinkFundAllocations(n)}))}},{key:"refresh",value:function(t){this.searchParamsSubject.next(t)}},{key:"allData$",value:function(){return(0,b.aj)(this.transactions$(),this.allocations$(),this.sinkFundAllocation$())}},{key:"destroy",value:function(){this.searchParamsSubject.complete()}}]),t}();return t.\u0275fac=function(n){return new(n||t)(s.LFG(w),s.LFG(x.t),s.LFG(M.A))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac}),t}(),F=o(54655),D=o(46782),B=o(22238),q=o(35618),N=o(3679),J=o(98295),I=o(67441),O=o(38583),S=o(51095),Q=o(72458);function Y(t,n){if(1&t&&(s.TgZ(0,"mat-option",7),s._uU(1),s.qZA()),2&t){var e=n.$implicit;s.Q6J("value",e.value),s.xp6(1),s.Oqu(e.text)}}var U=function(){var t=function(){function t(n,a){e(this,t),this.importerService=n,this.dialogRef=a,this.options=[{text:"ABN Amro Bank Account",value:"abn-amro-bank"},{text:"ABN Amro Bank Account (old format)",value:"abn-amro-bank-old"},{text:"ABN Amro Credit Card",value:"abn-amro-creditcard"},{text:"Scotia Bank Account",value:"new-bank-account"},{text:"FCB Bank Account",value:"fc-bank"},{text:"FCB Credit Card (not implemented)",value:"fc-creditcard"},{text:"Republic Bank Account",value:"republic-bank"},{text:"Republic Credit Card (not implemented)",value:"republic-creditcard"}],this.importType="abn-amro-bank",this.import=new s.vpe}return i(t,[{key:"ngOnInit",value:function(){}},{key:"importTransactions",value:function(){var t=this.importerService.convertToTransactions(this.input,this.startDate,this.endDate,this.importType);this.import.emit(t),this.dialogRef.close(t)}}]),t}();return t.\u0275fac=function(n){return new(n||t)(s.Y36(p),s.Y36(B.so))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-transaction-importer"]],inputs:{startDate:"startDate",endDate:"endDate",importType:"importType"},outputs:{import:"import"},decls:14,vars:3,consts:[["mat-dialog-title",""],["fxLayout","column","fxFlex",""],["rows","5","cols","10","placeholder","Copy the transactions from your bank here",3,"ngModel","ngModelChange"],["placeholder","Import Format",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"click"],["mat-raised-button","","mat-dialog-close",""],[3,"value"]],template:function(t,n){1&t&&(s.TgZ(0,"h1",0),s._uU(1,"Import Transactions"),s.qZA(),s.TgZ(2,"mat-dialog-content"),s.TgZ(3,"div",1),s.TgZ(4,"textarea",2),s.NdJ("ngModelChange",function(t){return n.input=t}),s._uU(5,"        "),s.qZA(),s.TgZ(6,"mat-form-field"),s.TgZ(7,"mat-select",3),s.NdJ("ngModelChange",function(t){return n.importType=t}),s.YNc(8,Y,2,2,"mat-option",4),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(9,"mat-dialog-actions"),s.TgZ(10,"button",5),s.NdJ("click",function(){return n.importTransactions()}),s._uU(11," Import "),s.qZA(),s.TgZ(12,"button",6),s._uU(13,"Cancel"),s.qZA(),s.qZA()),2&t&&(s.xp6(4),s.Q6J("ngModel",n.input),s.xp6(3),s.Q6J("ngModel",n.importType),s.xp6(1),s.Q6J("ngForOf",n.options))},directives:[B.uh,B.xY,q.xw,q.yH,N.Fj,N.JJ,N.On,J.KE,I.gD,O.sg,B.H8,S.lW,B.ZT,Q.ey],encapsulation:2}),t}(),L=o(32789),E=o(65072),$=o(93738),P=o(56326),H=o(7539),j=o(21637),G=o(93977),R=o(78759),z=o(76786),V=o(57576);function W(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"mat-checkbox",2),s.NdJ("change",function(t){return s.CHM(e),s.oxw().updateInnerValue(t)}),s.qZA()}if(2&t){var a=s.oxw();s.Q6J("formControl",a.control)}}function X(t,n){if(1&t&&(s.TgZ(0,"span",3),s._uU(1),s.qZA()),2&t){var e=s.oxw();s.xp6(1),s.Oqu(e.paidStatusDisplay)}}var K=function(){var t=function(){function t(){e(this,t),this.editMode=!1,this.control=new N.NI(!1),this.onChange=function(t){},this.onTouch=function(){}}return i(t,[{key:"paidStatusDisplay",get:function(){return"paid"===this.innerValue?"Yes":"unpaid"===this.innerValue?"No":"Unknown"}},{key:"value",get:function(){return this.innerValue},set:function(t){this.innerValue=t,this.control.setValue("paid"===this.value)}},{key:"ngOnInit",value:function(){}},{key:"updateInnerValue",value:function(t){this.innerValue=t.checked?"paid":"unpaid",this.onChange(this.innerValue)}},{key:"writeValue",value:function(t){this.value=t}},{key:"registerOnChange",value:function(t){this.onChange=t}},{key:"registerOnTouched",value:function(t){this.onTouch=t}}]),t}();return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-paid-field"]],inputs:{editMode:"editMode",innerValue:"innerValue"},features:[s._Bn([{provide:N.JU,multi:!0,useExisting:(0,s.Gpc)(function(){return t})}])],decls:3,vars:2,consts:[["color","primary",3,"formControl","change",4,"ngIf","ngIfElse"],["textDisplay",""],["color","primary",3,"formControl","change"],[1,"value"]],template:function(t,n){if(1&t&&(s.YNc(0,W,1,1,"mat-checkbox",0),s.YNc(1,X,2,1,"ng-template",null,1,s.W1O)),2&t){var e=s.MAs(2);s.Q6J("ngIf",n.editMode)("ngIfElse",e)}},directives:[O.O5,H.oG,N.JJ,N.oH],encapsulation:2}),t}(),tt=o(27333),nt=o(15552);function et(t,n){1&t&&s._UZ(0,"th",26)}function at(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"td",27),s._uU(1),s.TgZ(2,"mat-checkbox",28),s.NdJ("ngModelChange",function(t){return s.CHM(e).$implicit.selected=t}),s.qZA(),s.qZA()}if(2&t){var a=n.$implicit;s.xp6(1),s.hij(" ",a.item," "),s.xp6(1),s.Q6J("ngModel",a.selected)}}function it(t,n){1&t&&s._UZ(0,"td",29)}function ot(t,n){1&t&&(s.TgZ(0,"th",30),s._uU(1,"Date"),s.qZA())}function rt(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"td",31),s.TgZ(1,"ec-date-field",32),s.NdJ("ngModelChange",function(t){return s.CHM(e).$implicit.transaction_date=t}),s.qZA(),s.qZA()}if(2&t){var a=n.$implicit,i=s.oxw();s.xp6(1),s.Q6J("editMode",i.isEditMode)("ngModel",a.transaction_date)("ecValidateWithinBudget",i.budget)("errorMessage","test")}}function ct(t,n){1&t&&s._UZ(0,"td",29)}function ut(t,n){1&t&&(s.TgZ(0,"th",33),s._uU(1," Description "),s.qZA())}function st(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"td",27),s.TgZ(1,"ec-text-field",34),s.NdJ("ngModelChange",function(t){return s.CHM(e).$implicit.description=t}),s.qZA(),s.qZA()}if(2&t){var a=n.$implicit,i=s.oxw();s.xp6(1),s.Q6J("editMode",i.isEditMode)("ngModel",a.description)}}function lt(t,n){1&t&&(s.TgZ(0,"td",29),s._uU(1,"Total"),s.qZA())}function dt(t,n){if(1&t&&(s.TgZ(0,"th",35),s._uU(1),s.qZA()),2&t){var e=s.oxw();s.xp6(1),s.hij(" ",e.allocationHeaderName()," ")}}function ft(t,n){1&t&&s.GkF(0)}function mt(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"ec-list-field",39),s.NdJ("ngModelChange",function(t){return s.CHM(e),s.oxw().$implicit.sink_fund_allocation_id=t}),s.qZA()}if(2&t){var a=s.oxw().$implicit,i=s.oxw();s.Q6J("editMode",i.isEditMode)("items",i.sinkFundAllocations)("ngModel",a.sink_fund_allocation_id)}}function ht(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"ec-list-field",40),s.NdJ("change",function(){s.CHM(e);var t=s.oxw().$implicit;return s.oxw().updatePaidStatus(t)})("ngModelChange",function(t){return s.CHM(e),s.oxw().$implicit.allocation_id=t}),s.qZA()}if(2&t){var a=s.oxw().$implicit,i=s.oxw();s.Q6J("editMode",i.isEditMode)("items",i.allocations)("ngModel",a.allocation_id)}}function gt(t,n){if(1&t&&(s.TgZ(0,"td",27),s.YNc(1,ft,1,0,"ng-container",36),s.YNc(2,mt,1,3,"ng-template",null,37,s.W1O),s.YNc(4,ht,1,3,"ng-template",null,38,s.W1O),s.qZA()),2&t){var e=s.MAs(3),a=s.MAs(5),i=s.oxw();s.xp6(1),s.Q6J("ngIf",null==i.bankAccount?null:i.bankAccount.is_sink_fund)("ngIfThen",e)("ngIfElse",a)}}function pt(t,n){1&t&&(s.TgZ(0,"td",29),s._uU(1,"Allocation"),s.qZA())}function vt(t,n){1&t&&(s.TgZ(0,"th",41),s._uU(1," Withdrawn "),s.qZA())}function kt(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"td",42),s.TgZ(1,"ec-money-field",34),s.NdJ("ngModelChange",function(t){return s.CHM(e).$implicit.withdrawal_amount=t}),s.qZA(),s.qZA()}if(2&t){var a=n.$implicit,i=s.oxw();s.xp6(1),s.Q6J("editMode",i.isEditMode)("ngModel",a.withdrawal_amount)}}function yt(t,n){1&t&&s._UZ(0,"td",29)}function bt(t,n){1&t&&(s.TgZ(0,"th",41),s._uU(1," Deposited "),s.qZA())}function At(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"td",42),s.TgZ(1,"ec-money-field",34),s.NdJ("ngModelChange",function(t){return s.CHM(e).$implicit.deposit_amount=t}),s.qZA(),s.qZA()}if(2&t){var a=n.$implicit,i=s.oxw();s.xp6(1),s.Q6J("editMode",i.isEditMode)("ngModel",a.deposit_amount)}}function _t(t,n){1&t&&s._UZ(0,"td",29)}function Tt(t,n){1&t&&(s.TgZ(0,"th",26),s._uU(1,"Paid?"),s.qZA())}function Zt(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"td",43),s.TgZ(1,"ec-paid-field",34),s.NdJ("ngModelChange",function(t){return s.CHM(e).$implicit.status=t}),s.qZA(),s.qZA()}if(2&t){var a=n.$implicit,i=s.oxw();s.xp6(1),s.Q6J("editMode",i.isEditMode)("ngModel",a.status)}}function wt(t,n){1&t&&s._UZ(0,"td",29)}function xt(t,n){1&t&&(s.TgZ(0,"th",26),s._uU(1," Action "),s.qZA())}function Mt(t,n){if(1&t&&(s.TgZ(0,"td",43),s._UZ(1,"ec-delete-button",44),s.qZA()),2&t){var e=n.$implicit,a=s.oxw();s.xp6(1),s.Q6J("editMode",a.isEditMode)("item",e)}}function Ct(t,n){1&t&&s._UZ(0,"td",29)}function Ft(t,n){1&t&&s._UZ(0,"tr",45)}function Dt(t,n){1&t&&s._UZ(0,"tr",46),2&t&&s.Q6J("ecHighlightDeletedFor",n.$implicit)}function Bt(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"button",47),s.NdJ("click",function(){return s.CHM(e),s.oxw().addTransaction()}),s._uU(1," Add New Transaction "),s.qZA()}}function qt(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"button",48),s.NdJ("click",function(){return s.CHM(e),s.oxw().import.emit()}),s._uU(1," Import Transactions "),s.qZA()}}function Nt(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"button",49),s.NdJ("click",function(){return s.CHM(e),s.oxw().transfer.emit()}),s._uU(1," Transfer "),s.qZA()}}var Jt=function(){var t=function(){function t(n){var a=this;e(this,t),this.transactions=[],this.allocations=[],this.sinkFundAllocations=[],this.isEditMode=!1,this.save=new s.vpe,this.transfer=new s.vpe,this.import=new s.vpe,this.cancel=new s.vpe,this.DESKTOP_COLUMNS=["selection","date","description","allocation","withdrawn","deposit","paid","action"],this.MOBILE_COLUMNS=["date","description","allocation","withdrawn","deposit","action"],this.displayedColumns=[],this._mobileQueryListener=function(t){a.displayedColumns=t.matches?a.MOBILE_COLUMNS:a.DESKTOP_COLUMNS},this.mobileQuery=n.matchMedia("(max-width: 600px)"),this.mobileQuery.addListener(this._mobileQueryListener)}return i(t,[{key:"ngOnInit",value:function(){this._mobileQueryListener(this.mobileQuery)}},{key:"addTransaction",value:function(){this.transactions.push({withdrawal_amount:0,deposit_amount:0,status:this.bankAccount.is_credit_card?"unpaid":"paid"}),this.transactionList.renderRows()}},{key:"allocationHeaderName",value:function(){return this.bankAccount&&this.bankAccount.is_sink_fund?"Sink Fund Allocation":"Allocation"}},{key:"trackByFn",value:function(t,n){return n.id}},{key:"switchToDisplayMode",value:function(){this.isEditMode=!1}},{key:"linkToBudget",value:function(){return this.budget?"/budgets/".concat(this.budget.id):"/budgets"}},{key:"updatePaidStatus",value:function(t){t.status=t.allocation_id>0?"paid":"unpaid"}},{key:"ngOnDestroy",value:function(){this.mobileQuery.removeListener(this._mobileQueryListener)}}]),t}();return t.\u0275fac=function(n){return new(n||t)(s.Y36(E.vx))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-transaction-list"]],viewQuery:function(t,n){var e;(1&t&&s.Gf(L.BZ,7),2&t)&&(s.iGM(e=s.CRH())&&(n.transactionList=e.first))},inputs:{transactions:"transactions",allocations:"allocations",sinkFundAllocations:"sinkFundAllocations",bankAccount:"bankAccount",budget:"budget",isEditMode:"isEditMode"},outputs:{save:"save",transfer:"transfer",import:"import",cancel:"cancel"},decls:43,vars:9,consts:[[1,"table-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource","trackBy"],["matColumnDef","selection"],["mat-header-cell","","style","width:5%;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","style","width:15%;",4,"matCellDef"],["matColumnDef","description"],["mat-header-cell","","style","width:30%;",4,"matHeaderCellDef"],["matColumnDef","allocation"],["mat-header-cell","","style","width:20%;",4,"matHeaderCellDef"],["matColumnDef","withdrawn"],["mat-header-cell","","style","width:10%;","class","right",4,"matHeaderCellDef"],["mat-cell","","class","right",4,"matCellDef"],["matColumnDef","deposit"],["matColumnDef","paid"],["mat-cell","","class","center",4,"matCellDef"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"ecHighlightDeletedFor",4,"matRowDef","matRowDefColumns"],[3,"editMode","editModeChange","save","cancel"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","class","transfer","color","accent",3,"click",4,"ngIf"],["mat-header-cell","",2,"width","5%"],["mat-cell",""],["color","primary",3,"ngModel","ngModelChange"],["mat-footer-cell",""],["mat-header-cell",""],["mat-cell","",2,"width","15%"],[3,"editMode","ngModel","ecValidateWithinBudget","errorMessage","ngModelChange"],["mat-header-cell","",2,"width","30%"],[3,"editMode","ngModel","ngModelChange"],["mat-header-cell","",2,"width","20%"],[4,"ngIf","ngIfThen","ngIfElse"],["sinkFundAllocationField",""],["allocationField",""],[3,"editMode","items","ngModel","ngModelChange"],["groupBy","allocation_category",3,"editMode","items","ngModel","change","ngModelChange"],["mat-header-cell","",1,"right",2,"width","10%"],["mat-cell","",1,"right"],["mat-cell","",1,"center"],[3,"editMode","item"],["mat-header-row",""],["mat-row","",3,"ecHighlightDeletedFor"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","accent",1,"transfer",3,"click"]],template:function(t,n){1&t&&(s.TgZ(0,"mat-card"),s.TgZ(1,"mat-card-content"),s.TgZ(2,"div",0),s.TgZ(3,"table",1),s.ynx(4,2),s.YNc(5,et,1,0,"th",3),s.YNc(6,at,3,2,"td",4),s.YNc(7,it,1,0,"td",5),s.BQk(),s.ynx(8,6),s.YNc(9,ot,2,0,"th",7),s.YNc(10,rt,2,4,"td",8),s.YNc(11,ct,1,0,"td",5),s.BQk(),s.ynx(12,9),s.YNc(13,ut,2,0,"th",10),s.YNc(14,st,2,2,"td",4),s.YNc(15,lt,2,0,"td",5),s.BQk(),s.ynx(16,11),s.YNc(17,dt,2,1,"th",12),s.YNc(18,gt,6,3,"td",4),s.YNc(19,pt,2,0,"td",5),s.BQk(),s.ynx(20,13),s.YNc(21,vt,2,0,"th",14),s.YNc(22,kt,2,2,"td",15),s.YNc(23,yt,1,0,"td",5),s.BQk(),s.ynx(24,16),s.YNc(25,bt,2,0,"th",14),s.YNc(26,At,2,2,"td",15),s.YNc(27,_t,1,0,"td",5),s.BQk(),s.ynx(28,17),s.YNc(29,Tt,2,0,"th",3),s.YNc(30,Zt,2,2,"td",18),s.YNc(31,wt,1,0,"td",5),s.BQk(),s.ynx(32,19),s.YNc(33,xt,2,0,"th",3),s.YNc(34,Mt,2,2,"td",18),s.YNc(35,Ct,1,0,"td",5),s.BQk(),s.YNc(36,Ft,1,0,"tr",20),s.YNc(37,Dt,1,1,"tr",21),s.qZA(),s.qZA(),s.qZA(),s.TgZ(38,"mat-card-actions"),s.TgZ(39,"ec-edit-actions",22),s.NdJ("editModeChange",function(t){return n.isEditMode=t})("save",function(){return n.save.emit(n.transactions)})("cancel",function(){return n.cancel.emit()}),s.YNc(40,Bt,2,0,"button",23),s.YNc(41,qt,2,0,"button",24),s.YNc(42,Nt,2,0,"button",25),s.qZA(),s.qZA(),s.qZA()),2&t&&(s.xp6(3),s.Q6J("dataSource",n.transactions)("trackBy",n.trackByFn),s.xp6(33),s.Q6J("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),s.xp6(1),s.Q6J("matRowDefColumns",n.displayedColumns),s.xp6(2),s.Q6J("editMode",n.isEditMode),s.xp6(1),s.Q6J("ngIf",n.isEditMode),s.xp6(1),s.Q6J("ngIf",n.isEditMode),s.xp6(1),s.Q6J("ngIf",n.isEditMode))},directives:[$.a8,$.dn,L.BZ,L.w1,L.fO,L.Dz,L.mD,L.as,L.nj,$.hq,P.Y,O.O5,L.ge,L.ev,H.oG,N.JJ,N.On,L.yh,j.Q,G.Q,R.a,z.d,V.x,K,tt.t,L.XQ,L.Gk,nt.O,S.lW],styles:["table[_ngcontent-%COMP%]{width:100%;table-layout:fixed}ec-money-field[_ngcontent-%COMP%]{text-align:end}td[mat-cell][_ngcontent-%COMP%]{padding-left:5px;padding-right:5px}.mat-form-field-infix[_ngcontent-%COMP%]{width:5px}.menu-heading[_ngcontent-%COMP%]{justify-content:space-between}mat-card-content[_ngcontent-%COMP%]{margin-left:-24px;margin-right:-24px}mat-card[_ngcontent-%COMP%]{height:calc(100% - 48px);overflow:auto;display:flex;flex-direction:column}mat-card-content[_ngcontent-%COMP%]{height:calc(100% - 24px);overflow:auto}"]}),t}(),It=o(70749),Ot=function(){var t=function(){function t(n){e(this,t),this.apiGateway=n}return i(t,[{key:"transfer",value:function(t){return this.apiGateway.post("/bank_accounts/".concat(t.from,"/transfer"),t)}}]),t}();return t.\u0275fac=function(n){return new(n||t)(s.LFG(Z.i))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),St=o(28731),Qt=o(52205),Yt=["amount"];function Ut(t,n){if(1&t&&(s.TgZ(0,"mat-option",16),s._uU(1),s.TgZ(2,"em"),s._uU(3),s.ALo(4,"ecMoney"),s.qZA(),s.qZA()),2&t){var e=n.$implicit;s.Q6J("value",e.id),s.xp6(1),s.hij("",e.name," "),s.xp6(2),s.hij("(",s.lcZ(4,3,e.current_balance),")")}}function Lt(t,n){1&t&&s.GkF(0)}function Et(t,n){if(1&t&&(s.TgZ(0,"mat-option",16),s._uU(1),s.qZA()),2&t){var e=n.$implicit;s.Q6J("value",e.id),s.xp6(1),s.hij("",e.name," ")}}function $t(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"mat-select",17),s.NdJ("ngModelChange",function(t){return s.CHM(e),s.oxw().accountTransfer.from_sink_fund_allocation=t}),s._UZ(1,"mat-option",16),s.YNc(2,Et,2,2,"mat-option",2),s.qZA()}if(2&t){var a=s.oxw();s.Q6J("ngModel",a.accountTransfer.from_sink_fund_allocation),s.xp6(1),s.Q6J("value",0),s.xp6(1),s.Q6J("ngForOf",a.sinkFundAllocationsFrom)}}function Pt(t,n){if(1&t&&(s.TgZ(0,"mat-option",16),s._uU(1),s.qZA()),2&t){var e=n.$implicit;s.Q6J("value",e.id),s.xp6(1),s.hij("",e.name," ")}}function Ht(t,n){if(1&t&&(s.TgZ(0,"mat-optgroup",20),s.YNc(1,Pt,2,2,"mat-option",2),s.qZA()),2&t){var e=n.$implicit;s.Q6J("label",e.name),s.xp6(1),s.Q6J("ngForOf",e.allocations)}}function jt(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"mat-select",18),s.NdJ("ngModelChange",function(t){return s.CHM(e),s.oxw().accountTransfer.from_allocation=t}),s._UZ(1,"mat-option",16),s.YNc(2,Ht,2,2,"mat-optgroup",19),s.qZA()}if(2&t){var a=s.oxw();s.Q6J("ngModel",a.accountTransfer.from_allocation),s.xp6(1),s.Q6J("value",0),s.xp6(1),s.Q6J("ngForOf",a.allocationCategories)("ngForTrackBy",a.trackById)}}function Gt(t,n){if(1&t&&(s.TgZ(0,"mat-option",16),s._uU(1),s.TgZ(2,"em"),s._uU(3),s.ALo(4,"ecMoney"),s.qZA(),s.qZA()),2&t){var e=n.$implicit;s.Q6J("value",e.id),s.xp6(1),s.hij("",e.name," "),s.xp6(2),s.hij("(",s.lcZ(4,3,e.current_balance),")")}}function Rt(t,n){1&t&&s.GkF(0)}function zt(t,n){if(1&t&&(s.TgZ(0,"mat-option",16),s._uU(1),s.qZA()),2&t){var e=n.$implicit;s.Q6J("value",e.id),s.xp6(1),s.hij("",e.name," ")}}function Vt(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"mat-select",21),s.NdJ("ngModelChange",function(t){return s.CHM(e),s.oxw().accountTransfer.to_sink_fund_allocation=t}),s._UZ(1,"mat-option",16),s.YNc(2,zt,2,2,"mat-option",2),s.qZA()}if(2&t){var a=s.oxw();s.Q6J("ngModel",a.accountTransfer.to_sink_fund_allocation),s.xp6(1),s.Q6J("value",0),s.xp6(1),s.Q6J("ngForOf",a.sinkFundAllocationsTo)}}function Wt(t,n){if(1&t&&(s.TgZ(0,"mat-option",16),s._uU(1),s.qZA()),2&t){var e=n.$implicit;s.Q6J("value",e.id),s.xp6(1),s.hij("",e.name," ")}}function Xt(t,n){if(1&t&&(s.TgZ(0,"mat-optgroup",20),s.YNc(1,Wt,2,2,"mat-option",2),s.qZA()),2&t){var e=n.$implicit;s.Q6J("label",e.name),s.xp6(1),s.Q6J("ngForOf",e.allocations)}}function Kt(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"mat-select",22),s.NdJ("ngModelChange",function(t){return s.CHM(e),s.oxw().accountTransfer.to_allocation=t}),s._UZ(1,"mat-option",16),s.YNc(2,Xt,2,2,"mat-optgroup",19),s.qZA()}if(2&t){var a=s.oxw();s.Q6J("ngModel",a.accountTransfer.to_allocation),s.xp6(1),s.Q6J("value",0),s.xp6(1),s.Q6J("ngForOf",a.allocationCategories)("ngForTrackBy",a.trackById)}}var tn=function(){var t=function(){function t(n,a,i,o){e(this,t),this.bankAccountService=n,this.transferService=a,this.messageService=i,this.dialogRef=o,this.fromAccount={},this.toAccount={},this.bankAccounts=[],this.budget={},this.allocations=[],this.allocationCategories=[],this.sinkFundAllocationsFrom=[],this.sinkFundAllocationsTo=[],this.accountTransfer={from:0,to:0,amount:0,description:"",date:(new Date).toISOString().substr(0,10)}}return i(t,[{key:"ngOnInit",value:function(){var t=this;setTimeout(function(){t.bankAccountService.getBankAccountsWithBalances().subscribe(function(n){return t.bankAccounts=n})},0)}},{key:"findAccountById",value:function(t){return this.bankAccounts.find(function(n){return n.id===t})||{current_balance:0}}},{key:"setBudget",value:function(t){this.budget=t,this.allocations=t.allocations;var n=(0,It.Z)(this.allocations,"allocation_category_id");this.allocationCategories=Object.keys(n).map(function(t){var e=n[t],a={id:Number(t)};return a.name=e[0].allocation_category.name,a.allocations=e,a}).sort(function(t,n){return String(t.name).localeCompare(n.name)}),this.accountTransfer.budget_id=this.budget.id}},{key:"selectFromBankAccount",value:function(){var t=this,n=this.bankAccounts.find(function(n){return n.id===t.accountTransfer.from})||{};this.fromAccount=n,n.is_sink_fund?this.bankAccountService.getSinkFundAllocations(n.id).subscribe(function(n){return t.sinkFundAllocationsFrom=n}):this.sinkFundAllocationsFrom=[]}},{key:"selectToBankAccount",value:function(){var t=this,n=this.bankAccounts.find(function(n){return n.id===t.accountTransfer.to})||{};this.toAccount=n,n.is_sink_fund?this.bankAccountService.getSinkFundAllocations(n.id).subscribe(function(n){return t.sinkFundAllocationsTo=n}):this.sinkFundAllocationsTo=[]}},{key:"newFromBalance",value:function(){return this.findAccountById(this.accountTransfer.from).current_balance-this.accountTransfer.amount}},{key:"newToBalance",value:function(){return this.findAccountById(this.accountTransfer.to).current_balance+this.accountTransfer.amount}},{key:"save",value:function(){var t=this;this.transferService.transfer(this.accountTransfer).subscribe(function(n){t.messageService.setMessage("Transfer completed."),t.dialogRef.close()},function(n){t.messageService.setErrorMessage("Error: "+(n.error&&n.error.reason)||0)})}},{key:"cancel",value:function(){this.dialogRef.close()}},{key:"trackById",value:function(t,n){return n.id}}]),t}();return t.\u0275fac=function(n){return new(n||t)(s.Y36(M.A),s.Y36(Ot),s.Y36(St.e),s.Y36(B.so))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-transfer-form"]],viewQuery:function(t,n){var e;(1&t&&s.Gf(Yt,7,V.x),2&t)&&(s.iGM(e=s.CRH())&&(n.amountField=e.first))},decls:36,vars:24,consts:[["mat-dialog-title",""],["placeholder","From","data-cy-from-field","",3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["align","end"],[4,"ngIf","ngIfThen","ngIfElse"],["sinkFundAllocationFrom",""],["allocationFrom",""],["placeholder","To","data-cy-to-field","",3,"ngModel","ngModelChange","selectionChange"],["sinkFundAllocationTo",""],["allocationTo",""],[3,"editMode","ngModel","ecValidateWithinBudget","errorMessage","ngModelChange"],["data-cy-description-field","","placeholder","Description",3,"editMode","ngModel","ngModelChange"],["data-cy-amount-field","","placeholder","Amount",3,"editMode","ngModel","ngModelChange"],["fxLayout","row","fxLayoutAlign","space-around",1,"actions"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"],[3,"value"],["placeholder","From Sink Fund Allocation",3,"ngModel","ngModelChange"],["placeholder","From Allocation",3,"ngModel","ngModelChange"],[3,"label",4,"ngFor","ngForOf","ngForTrackBy"],[3,"label"],["placeholder","To Sink Fund Allocation",3,"ngModel","ngModelChange"],["placeholder","To Allocation",3,"ngModel","ngModelChange"]],template:function(t,n){if(1&t&&(s.TgZ(0,"h1",0),s._uU(1,"Bank Account Transfer"),s.qZA(),s.TgZ(2,"mat-dialog-content"),s.TgZ(3,"mat-form-field"),s.TgZ(4,"mat-select",1),s.NdJ("ngModelChange",function(t){return n.accountTransfer.from=t})("selectionChange",function(){return n.selectFromBankAccount()}),s.YNc(5,Ut,5,5,"mat-option",2),s.qZA(),s.TgZ(6,"mat-hint",3),s._uU(7),s.ALo(8,"ecMoney"),s.qZA(),s.qZA(),s.TgZ(9,"mat-form-field"),s.YNc(10,Lt,1,0,"ng-container",4),s.YNc(11,$t,3,3,"ng-template",null,5,s.W1O),s.YNc(13,jt,3,4,"ng-template",null,6,s.W1O),s.qZA(),s.TgZ(15,"mat-form-field"),s.TgZ(16,"mat-select",7),s.NdJ("ngModelChange",function(t){return n.accountTransfer.to=t})("selectionChange",function(){return n.selectToBankAccount()}),s.YNc(17,Gt,5,5,"mat-option",2),s.qZA(),s.TgZ(18,"mat-hint",3),s._uU(19),s.ALo(20,"ecMoney"),s.qZA(),s.qZA(),s.TgZ(21,"mat-form-field"),s.YNc(22,Rt,1,0,"ng-container",4),s.YNc(23,Vt,3,3,"ng-template",null,8,s.W1O),s.YNc(25,Kt,3,4,"ng-template",null,9,s.W1O),s.qZA(),s.TgZ(27,"ec-date-field",10),s.NdJ("ngModelChange",function(t){return n.accountTransfer.date=t}),s.qZA(),s.TgZ(28,"ec-text-field",11),s.NdJ("ngModelChange",function(t){return n.accountTransfer.description=t}),s.qZA(),s.TgZ(29,"ec-money-field",12),s.NdJ("ngModelChange",function(t){return n.accountTransfer.amount=t}),s.qZA(),s.qZA(),s.TgZ(30,"mat-dialog-actions"),s.TgZ(31,"div",13),s.TgZ(32,"button",14),s.NdJ("click",function(){return n.save()}),s._uU(33,"Save"),s.qZA(),s.TgZ(34,"button",15),s.NdJ("click",function(){return n.cancel()}),s._uU(35," Cancel "),s.qZA(),s.qZA(),s.qZA()),2&t){var e=s.MAs(12),a=s.MAs(14),i=s.MAs(24),o=s.MAs(26);s.xp6(4),s.Q6J("ngModel",n.accountTransfer.from),s.xp6(1),s.Q6J("ngForOf",n.bankAccounts),s.xp6(2),s.hij("New Balance: ",s.lcZ(8,20,n.newFromBalance()),""),s.xp6(3),s.Q6J("ngIf",n.fromAccount.is_sink_fund)("ngIfThen",e)("ngIfElse",a),s.xp6(6),s.Q6J("ngModel",n.accountTransfer.to),s.xp6(1),s.Q6J("ngForOf",n.bankAccounts),s.xp6(2),s.hij("New Balance: ",s.lcZ(20,22,n.newToBalance()),""),s.xp6(3),s.Q6J("ngIf",n.toAccount.is_sink_fund)("ngIfThen",i)("ngIfElse",o),s.xp6(5),s.Q6J("editMode",!0)("ngModel",n.accountTransfer.date)("ecValidateWithinBudget",n.budget)("errorMessage","test"),s.xp6(1),s.Q6J("editMode",!0)("ngModel",n.accountTransfer.description),s.xp6(1),s.Q6J("editMode",!0)("ngModel",n.accountTransfer.amount)}},directives:[B.uh,B.xY,J.KE,I.gD,N.JJ,N.On,O.sg,J.bx,O.O5,j.Q,R.a,V.x,B.H8,q.xw,q.Wh,S.lW,Q.ey,Q.Nv],pipes:[Qt.L],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),t}(),nn=o(91161),en=o(29675),an=o(21906);function on(t,n){if(1&t){var e=s.EpF();s.TgZ(0,"div",1),s.TgZ(1,"mat-card"),s.TgZ(2,"mat-card-title"),s._uU(3,"Selected Transaction Total"),s.qZA(),s.TgZ(4,"mat-card-content"),s._uU(5," Total: "),s.TgZ(6,"strong"),s._uU(7),s.ALo(8,"ecMoney"),s.qZA(),s.qZA(),s.TgZ(9,"mat-card-actions",2),s.TgZ(10,"button",3),s.NdJ("click",function(){return s.CHM(e),s.oxw().clearSelections()}),s._uU(11," Clear "),s.qZA(),s.qZA(),s.qZA(),s.qZA()}if(2&t){var a=s.oxw();s.xp6(7),s.Oqu(s.lcZ(8,1,a.transactionTotal()))}}var rn=function(){var t=function(){function t(){e(this,t),this.transactions=[]}return i(t,[{key:"ngOnInit",value:function(){}},{key:"transactionTotal",value:function(){return(0,an.M)(this.selectedTransactions(),"net_amount")}},{key:"selectedTransactions",value:function(){return this.transactions?this.transactions.filter(function(t){return t.selected}):[]}},{key:"showCalculator",value:function(){return this.selectedTransactions().length>0}},{key:"clearSelections",value:function(){this.selectedTransactions().forEach(function(t){t.selected=!1})}}]),t}();return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-transaction-calculator"]],inputs:{transactions:"transactions"},decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],["fxLayoutAlign","end"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,n){1&t&&s.YNc(0,on,12,3,"div",0),2&t&&s.Q6J("ngIf",n.showCalculator())},directives:[O.O5,$.a8,$.n5,$.dn,$.hq,q.Wh,S.lW],pipes:[Qt.L],styles:["div.container[_ngcontent-%COMP%]{position:fixed;top:60px;right:60px;z-index:1000}mat-card[_ngcontent-%COMP%]{background:#efdbdb}"]}),t}(),cn=o(15257);function un(t,n){if(1&t&&(s.TgZ(0,"mat-option",9),s._uU(1),s.qZA()),2&t){var e=n.$implicit;s.Q6J("value",e.id),s.xp6(1),s.Oqu(e.name)}}function sn(t,n){if(1&t&&(s.TgZ(0,"mat-option",9),s._uU(1),s.qZA()),2&t){var e=n.$implicit;s.Q6J("value",e.id),s.xp6(1),s.Oqu(e.name)}}var ln=function(){var n=function(){function n(t,a,i,o,r){e(this,n),this.bankAccountService=t,this.budgetService=a,this.fb=i,this.activatedRoute=o,this.router=r,this.bankAccounts=[],this.budgets=[],this.change=new s.vpe,this.componentDestroyed=new y.xQ}return i(n,[{key:"ngOnInit",value:function(){var t=this;this.form=this.fb.group({budget_id:0,bank_account_id:0}),this.loadBudgetsAndBankAccounts(),this.form.valueChanges.pipe((0,D.R)(this.componentDestroyed)).subscribe(function(){t.onSubmit()})}},{key:"loadBudgetsAndBankAccounts",value:function(){var n=this;(0,b.aj)([this.bankAccountService.getBankAccounts(),this.budgetService.getBudgetsWithTransactions(),this.activatedRoute.paramMap.pipe((0,A.U)(this.convertToNumericParams),(0,cn.q)(1))]).subscribe(function(e){var a,i;a=t(e,3),n.bankAccounts=a[0],n.budgets=a[1],i=a[2],n.setInitialFormValue(i)})}},{key:"convertToNumericParams",value:function(t){return{budget_id:Number(t.get("budget_id"))||0,bank_account_id:Number(t.get("bank_account_id"))||0}}},{key:"setInitialFormValue",value:function(t){var n=this.initializeWithDefaultValuesIfNeeded(t);this.form.patchValue(n),this.onSubmit()}},{key:"initializeWithDefaultValuesIfNeeded",value:function(t){return{bank_account_id:t.bank_account_id||this.firstBankAccountId(),budget_id:t.budget_id||this.firstBudgetId()}}},{key:"firstBudgetId",value:function(){return this.budgets.length>0?this.budgets[0].id:0}},{key:"firstBankAccountId",value:function(){return this.bankAccounts.length>0?this.bankAccounts[0].id:0}},{key:"onSubmit",value:function(){var t=Object.assign({},this.form.value);this.updateBudgetAndBankAccount(t),this.change.emit(t),this.router.navigate([{budget_id:t.budget_id,bank_account_id:t.bank_account_id}],{relativeTo:this.activatedRoute})}},{key:"updateBudgetAndBankAccount",value:function(t){var n=this.bankAccounts.find(function(n){return n.id===t.bank_account_id});n&&(t.bankAccount=n);var e=this.budgets.find(function(n){return n.id===t.budget_id});e&&(t.budget=e)}},{key:"linkToBudget",value:function(){return this.form.value.budget_id?"/budgets/".concat(this.form.value.budget_id):"/budgets"}},{key:"ngOnDestroy",value:function(){this.componentDestroyed.next(),this.componentDestroyed.complete()}}]),n}();return n.\u0275fac=function(t){return new(t||n)(s.Y36(M.A),s.Y36(x.t),s.Y36(N.qu),s.Y36(F.gz),s.Y36(F.F0))},n.\u0275cmp=s.Xpm({type:n,selectors:[["ec-transaction-search-form"]],outputs:{change:"change"},decls:17,vars:4,consts:[[3,"formGroup","ngSubmit"],["fxLayout","row","fxLayoutGap","20px"],["fxFlex","2 0 auto"],["placeholder","Bank Account","formControlName","bank_account_id"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Budget","formControlName","budget_id"],["fxLayout","row","fxLayoutAlign","space-between center"],["mat-raised-button","","type","submit","color","primary"],["color","primary",3,"routerLink"],[3,"value"]],template:function(t,n){1&t&&(s.TgZ(0,"form",0),s.NdJ("ngSubmit",function(){return n.onSubmit()}),s.TgZ(1,"mat-card"),s.TgZ(2,"mat-card-title"),s._uU(3,"Select Transactions to View"),s.qZA(),s.TgZ(4,"mat-card-content"),s.TgZ(5,"div",1),s.TgZ(6,"mat-form-field",2),s.TgZ(7,"mat-select",3),s.YNc(8,un,2,2,"mat-option",4),s.qZA(),s.qZA(),s.TgZ(9,"mat-form-field",2),s.TgZ(10,"mat-select",5),s.YNc(11,sn,2,2,"mat-option",4),s.qZA(),s.qZA(),s.qZA(),s.TgZ(12,"div",6),s.TgZ(13,"button",7),s._uU(14," Refresh "),s.qZA(),s.TgZ(15,"a",8),s._uU(16,"Go to Budget"),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA()),2&t&&(s.Q6J("formGroup",n.form),s.xp6(8),s.Q6J("ngForOf",n.bankAccounts),s.xp6(3),s.Q6J("ngForOf",n.budgets),s.xp6(4),s.Q6J("routerLink",n.linkToBudget()))},directives:[N._Y,N.JL,N.sg,$.a8,$.n5,$.dn,q.xw,q.SQ,J.KE,q.yH,I.gD,N.JJ,N.u,O.sg,q.Wh,S.lW,F.yS,Q.ey],styles:["mat-card[_ngcontent-%COMP%]{padding:12px}"]}),n}(),dn=o(10194);function fn(t,n){if(1&t&&(s.ynx(0),s.TgZ(1,"div",0),s.TgZ(2,"span",1),s._uU(3,"Current Budget Balance"),s.qZA(),s.TgZ(4,"span",2),s._uU(5),s.ALo(6,"ecMoney"),s.qZA(),s.qZA(),s.TgZ(7,"div",3),s.TgZ(8,"span",1),s._uU(9,"Difference (Bank vs Budget)"),s.qZA(),s.TgZ(10,"span",2),s._UZ(11,"ec-money-field",4),s.qZA(),s.qZA(),s.BQk()),2&t){var e=s.oxw();s.xp6(5),s.Oqu(s.lcZ(6,3,e.lastBudgetBalance())),s.xp6(6),s.Q6J("value",e.budgetDifference())("highlightPositive",!0)}}function mn(t,n){if(1&t&&(s.ynx(0),s.TgZ(1,"div",0),s.TgZ(2,"span",1),s._uU(3,"Unpaid Balance"),s.qZA(),s.TgZ(4,"span",2),s._UZ(5,"ec-money-field",4),s.qZA(),s.qZA(),s.TgZ(6,"div",0),s.TgZ(7,"span",1),s._uU(8,"Unpaid Difference"),s.qZA(),s.TgZ(9,"span",2),s._UZ(10,"ec-money-field",4),s.qZA(),s.qZA(),s.BQk()),2&t){var e=s.oxw();s.xp6(5),s.Q6J("value",e.unpaidBalance())("highlightPositive",!0),s.xp6(5),s.Q6J("value",e.unpaidDifference())("highlightPositive",!0)}}var hn=function(){var t=function(){function t(n){e(this,t),this.settingsService=n}return i(t,[{key:"ngOnInit",value:function(){var t=this;this.settingsService.getSettings().subscribe(function(n){t.primary_budget_account_id=n.primary_budget_account_id})}},{key:"lastBankBalance",value:function(){return this.bankAccount?this.bankAccount.closing_balance:0}},{key:"transactionTotal",value:function(){if(!this.transactions)return 0;var t=0,n=0;return this.transactions.forEach(function(e){e.deleted||(t+=e.withdrawal_amount,n+=e.deposit_amount)}),n-t}},{key:"currentBankBalance",value:function(){return this.lastBankBalance()+this.transactionTotal()}},{key:"showBudgetBalance",value:function(){return!!this.bankAccount&&this.bankAccount.id===this.primary_budget_account_id}},{key:"lastBudgetBalance",value:function(){return(0,an.M)(this.allocations,"amount")-(0,an.M)(this.allocations,"spent")}},{key:"currentBudgetBalance",value:function(){return this.lastBudgetBalance()}},{key:"budgetDifference",value:function(){return this.currentBankBalance()-this.currentBudgetBalance()}},{key:"showUnpaidBalance",value:function(){return!!this.bankAccount&&"credit_card"===this.bankAccount.account_type}},{key:"unpaidBalance",value:function(){if(!this.transactions)return 0;var t=this.transactions.filter(function(t){return!t.paid});return(0,an.M)(t,"net_amount")}},{key:"unpaidDifference",value:function(){return this.currentBankBalance()-this.unpaidBalance()}}]),t}();return t.\u0275fac=function(n){return new(n||t)(s.Y36(dn.g))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ec-transaction-summary"]],inputs:{bankAccount:"bankAccount",transactions:"transactions",allocations:"allocations"},decls:21,vars:10,consts:[["fxLayout","row"],[1,"heading"],[1,"value"],["fxLayout","row",1,"total"],[3,"value","highlightPositive"],[4,"ngIf"]],template:function(t,n){1&t&&(s.TgZ(0,"mat-card"),s.TgZ(1,"mat-card-content"),s.TgZ(2,"div",0),s.TgZ(3,"span",1),s._uU(4,"Last Bank Balance"),s.qZA(),s.TgZ(5,"span",2),s._uU(6),s.ALo(7,"ecMoney"),s.qZA(),s.qZA(),s.TgZ(8,"div",0),s.TgZ(9,"span",1),s._uU(10,"Transaction Total"),s.qZA(),s.TgZ(11,"span",2),s._uU(12),s.ALo(13,"ecMoney"),s.qZA(),s.qZA(),s.TgZ(14,"div",3),s.TgZ(15,"span",1),s._uU(16,"Current Bank Balance"),s.qZA(),s.TgZ(17,"span",2),s._UZ(18,"ec-money-field",4),s.qZA(),s.qZA(),s.YNc(19,fn,12,5,"ng-container",5),s.YNc(20,mn,11,4,"ng-container",5),s.qZA(),s.qZA()),2&t&&(s.xp6(6),s.Oqu(s.lcZ(7,6,n.lastBankBalance())),s.xp6(6),s.Oqu(s.lcZ(13,8,n.transactionTotal())),s.xp6(6),s.Q6J("value",n.currentBankBalance())("highlightPositive",!0),s.xp6(1),s.Q6J("ngIf",n.showBudgetBalance()),s.xp6(1),s.Q6J("ngIf",n.showUnpaidBalance()))},directives:[$.a8,$.dn,q.xw,V.x,O.O5],pipes:[Qt.L],styles:[".heading[_ngcontent-%COMP%]{flex:2 0 auto;font-weight:bold}.value[_ngcontent-%COMP%]{flex:1 0 auto;text-align:right}.total[_ngcontent-%COMP%]{font-size:16px;border-top:1px solid black}"]}),t}(),gn=function(){var n=function(){function n(t,a,i,o,r,c){e(this,n),this.transactionService=t,this.transactionDataService=a,this.loadingIndicator=i,this.toolbarService=o,this.messageService=r,this.dialog=c,this.transactions=[],this.allocations=[],this.sinkFundAllocations=[],this.bankAccount={},this.budget={},this.componentDestroyed=new y.xQ}return i(n,[{key:"ngOnInit",value:function(){var n=this;this.toolbarService.setHeading("Transactions"),this.transactionDataService.init(),this.transactionDataService.allData$().pipe((0,D.R)(this.componentDestroyed)).subscribe(function(e){var a=t(e,3),i=a[0],o=a[1],r=a[2];n.transactions=i,n.allocations=o,n.sinkFundAllocations=r,n.loadingIndicator.hide()})}},{key:"refreshTransactions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loadingIndicator.show(),t.bankAccount&&(this.bankAccount=t.bankAccount),t.budget&&(this.budget=t.budget),this.transactionDataService.refresh(t)}},{key:"refresh",value:function(){this.refreshTransactions({budget_id:this.budget.id,bank_account_id:this.bankAccount.id})}},{key:"save",value:function(){var t=this;this.loadingIndicator.show(),this.transactionService.save(this.transactions,this.bankAccount,this.budget).subscribe(function(){t.loadingIndicator.hide(),t.transactionList.switchToDisplayMode(),t.refresh(),t.messageService.setMessage("Transactions saved.",5e3)})}},{key:"cancel",value:function(){this.transactionDataService.refresh({bank_account_id:this.bankAccount.id,budget_id:this.budget.id})}},{key:"showImportForm",value:function(){var t=this,n=this.dialog.open(U,{width:"350px"});return n.componentInstance.startDate=this.budget.start_date,n.componentInstance.endDate=this.budget.end_date,n.componentInstance.importType=this.bankAccount.import_format,n.afterClosed().subscribe(function(n){n.length>0&&(t.transactions=t.transactions.concat(n))}),n}},{key:"showTransferForm",value:function(){var t=this,n=this.dialog.open(tn,{width:"350px"});return this.budget.allocations=this.allocations,n.componentInstance.setBudget(this.budget),n.afterClosed().subscribe(function(){t.refresh()}),n}},{key:"ngOnDestroy",value:function(){this.componentDestroyed.next(),this.componentDestroyed.complete(),this.transactionDataService.destroy()}}]),n}();return n.\u0275fac=function(t){return new(t||n)(s.Y36(w),s.Y36(C),s.Y36(nn.T),s.Y36(en.S),s.Y36(St.e),s.Y36(B.uw))},n.\u0275cmp=s.Xpm({type:n,selectors:[["ec-transactions"]],viewQuery:function(t,n){var e;(1&t&&s.Gf(Jt,7),2&t)&&(s.iGM(e=s.CRH())&&(n.transactionList=e.first))},decls:7,vars:9,consts:[[1,"main"],[3,"transactions"],[1,"container"],[3,"change"],[3,"transactions","bankAccount","allocations"],[3,"transactions","allocations","sinkFundAllocations","bankAccount","budget","save","cancel","import","transfer"]],template:function(t,n){1&t&&(s.TgZ(0,"mat-card",0),s.TgZ(1,"mat-card-content"),s._UZ(2,"ec-transaction-calculator",1),s.TgZ(3,"div",2),s.TgZ(4,"ec-transaction-search-form",3),s.NdJ("change",function(t){return n.refreshTransactions(t)}),s.qZA(),s._UZ(5,"ec-transaction-summary",4),s.TgZ(6,"ec-transaction-list",5),s.NdJ("save",function(){return n.save()})("cancel",function(){return n.cancel()})("import",function(){return n.showImportForm()})("transfer",function(){return n.showTransferForm()}),s.qZA(),s.qZA(),s.qZA(),s.qZA()),2&t&&(s.xp6(2),s.Q6J("transactions",n.transactions),s.xp6(3),s.Q6J("transactions",n.transactions)("bankAccount",n.bankAccount)("allocations",n.allocations),s.xp6(1),s.Q6J("transactions",n.transactions)("allocations",n.allocations)("sinkFundAllocations",n.sinkFundAllocations)("bankAccount",n.bankAccount)("budget",n.budget))},directives:[$.a8,$.dn,rn,ln,hn,Jt],styles:['mat-card-content[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]{height:100%;overflow:auto}.container[_ngcontent-%COMP%]{display:grid;width:100%;grid-template-areas:"selector summary" "list     list";grid-template-rows:175px 1fr;grid-template-columns:1fr 1fr;grid-column-gap:20px;-moz-column-gap:20px;column-gap:20px}@media (max-width: 600px){mat-card.main[_ngcontent-%COMP%]{height:100%}.container[_ngcontent-%COMP%]{display:grid;width:100%;grid-template-areas:"selector" "summary" "list";grid-template-rows:175px 160px 1fr;grid-template-columns:auto}}ec-transaction-search-form[_ngcontent-%COMP%]{grid-area:selector;width:100%}ec-transaction-summary[_ngcontent-%COMP%]{grid-area:summary;width:100%}ec-transaction-list[_ngcontent-%COMP%]{grid-area:list;overflow:auto;width:100%}']}),n}(),pn=[{path:"",canActivate:[o(31265).a],children:[{path:"",component:gn}]}],vn=function(){var t=function t(){e(this,t)};return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[F.Bz.forChild(pn)]]}),t}(),kn=function(){var t=function t(){e(this,t)};return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[u.m.forRoot()]]}),t}(),yn=function(){var t=function t(){e(this,t)};return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({providers:[w,C],imports:[[u.m,c.c,k,kn,vn]]}),t}()}}])}();