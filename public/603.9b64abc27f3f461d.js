"use strict";(self.webpackChunkeverycent=self.webpackChunkeverycent||[]).push([[603],{4603:(gt,_,a)=>{a.r(_),a.d(_,{SinkFundsModule:()=>rt});var A=a(232),y=a(6712),b=a(591),t=a(4650),J=a(7369);let g=(()=>{class i{constructor(n){this.apiGateway=n,this._currentSinkFund$=new b.X({})}getSinkFunds(){return this.apiGateway.get("/sink_funds")}getCurrent(){return this._currentSinkFund$.asObservable()}refreshSinkFund(n){this.apiGateway.get(`/sink_funds/${n}`).subscribe(e=>{this._currentSinkFund$.next(e)})}save(n){return this.apiGateway.put(`/sink_funds/${n.id}`,n)}transfer(n,e){return this.apiGateway.post(`/sink_funds/${n.id}/transfer_allocation`,e)}}return i.\u0275fac=function(n){return new(n||i)(t.LFG(J.i))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac}),i})();var f=a(6630),U=a(5529),O=a(4850),Q=a(2198),w=a(7625),N=a(9675),d=a(3546),p=a(7814),I=a(6529),h=a(1906);class v{constructor(o){this.deactivateService=o}sinkFundAllocationsOf(o){return null===o&&void 0===o?[]:o.sink_fund_allocations||[]}totalTarget(o,n){return(0,h.M)(this.sinkFundAllocationsOf(o).filter(e=>e.target>0).filter(e=>this.deactivateService.isItemVisible(e,n)),"target")}totalOutstanding(o,n){return(0,h.M)(this.sinkFundAllocationsOf(o).filter(e=>e.target>0).filter(e=>this.deactivateService.isItemVisible(e,n)),"current_balance")-this.totalTarget(o,n)}totalAssignedBalance(o){return(0,h.M)(this.sinkFundAllocationsOf(o),"current_balance")}unassignedBalance(o){return null===o&&void 0===o?0:o.current_balance-this.totalAssignedBalance(o)}allocationOutstandingAt(o,n){if(null===o&&void 0===o)return 0;let e=o.sink_fund_allocations[n];return e.current_balance-e.target}}var u=a(5412),l=a(4006),F=a(2874),m=a(6895),r=a(277),k=a(4859),S=a(9549),Z=a(4385),C=a(3238),T=a(1769),Y=a(1944);function D(i,o){if(1&i&&(t.TgZ(0,"mat-option",4),t._uU(1),t.ALo(2,"ecMoney"),t.qZA()),2&i){const n=o.$implicit;t.Q6J("value",n.id),t.xp6(1),t.AsE(" ",n.name," ( ",t.lcZ(2,3,n.current_balance)," ) ")}}function B(i,o){if(1&i&&(t.TgZ(0,"mat-option",4),t._uU(1),t.ALo(2,"ecMoney"),t.qZA()),2&i){const n=o.$implicit;t.Q6J("value",n.id),t.xp6(1),t.AsE(" ",n.name," - ",t.lcZ(2,3,n.current_balance)," ")}}let E=(()=>{class i{constructor(n,e,s,c){this.dialogRef=n,this.fb=e,this.sinkFundService=s,this.deactivateService=c}ngOnInit(){this.calculator=new v(this.deactivateService),this.transfer=this.fb.group({existing_allocation_id:0,new_allocation_id:0,amount:0})}save(){this.sinkFundService.transfer(this.sinkFund,this.transfer.value).subscribe(n=>{this.sinkFundService.refreshSinkFund(this.sinkFund.id),this.dialogRef.close(n)},n=>alert(n))}cancel(){this.dialogRef.close(!1)}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(u.so),t.Y36(l.QS),t.Y36(g),t.Y36(F.u))},i.\u0275cmp=t.Xpm({type:i,selectors:[["ec-add-transfer-form"]],inputs:{sinkFund:"sinkFund"},decls:23,vars:12,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["fxLayout","column","fxLayoutAlign","space-between",3,"formGroup"],["placeholder","Transfer From","formControlName","existing_allocation_id"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Transfer To","formControlName","new_allocation_id"],["placeholder","Amount","formControlName","amount","fxFlex","1",3,"editMode"],["mat-dialog-actions",""],["fxLayout","row","fxLayoutAlign","space-around",1,"actions"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(n,e){1&n&&(t.TgZ(0,"h1",0),t._uU(1,"Transfer Money"),t.qZA(),t.TgZ(2,"div",1)(3,"div",2)(4,"mat-form-field")(5,"mat-select",3)(6,"mat-option",4),t._uU(7),t.ALo(8,"ecMoney"),t.qZA(),t.YNc(9,D,3,5,"mat-option",5),t.qZA()(),t.TgZ(10,"mat-form-field")(11,"mat-select",6)(12,"mat-option",4),t._uU(13),t.ALo(14,"ecMoney"),t.qZA(),t.YNc(15,B,3,5,"mat-option",5),t.qZA()(),t._UZ(16,"ec-money-field",7),t.qZA()(),t.TgZ(17,"div",8)(18,"div",9)(19,"button",10),t.NdJ("click",function(){return e.save()}),t._uU(20,"Save"),t.qZA(),t.TgZ(21,"button",11),t.NdJ("click",function(){return e.cancel()}),t._uU(22," Cancel "),t.qZA()()()),2&n&&(t.xp6(3),t.Q6J("formGroup",e.transfer),t.xp6(3),t.Q6J("value",0),t.xp6(1),t.hij(" Unassigned Money - ",t.lcZ(8,8,e.calculator.unassignedBalance(e.sinkFund))," "),t.xp6(2),t.Q6J("ngForOf",e.sinkFund.sink_fund_allocations),t.xp6(3),t.Q6J("value",0),t.xp6(1),t.hij(" Unassigned Money - ",t.lcZ(14,10,e.calculator.unassignedBalance(e.sinkFund))," "),t.xp6(2),t.Q6J("ngForOf",e.sinkFund.sink_fund_allocations),t.xp6(1),t.Q6J("editMode",!0))},dependencies:[m.sg,l.JJ,l.JL,l.sg,l.u,r.xw,r.Wh,r.yH,k.lW,u.uh,u.xY,u.H8,S.KE,Z.gD,C.ey,T.x,Y.L],styles:["mat-form-field[_ngcontent-%COMP%], ec-money-field[_ngcontent-%COMP%]{margin-top:24px}div.actions[_ngcontent-%COMP%]{width:100%}ec-money-field[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),i})();var G=a(8084),$=a(9210),H=a(7009),R=a(455),x=a(270);function q(i,o){if(1&i){const n=t.EpF();t.TgZ(0,"span",1),t.NdJ("click",function(){t.CHM(n);const s=t.oxw();return t.KtG(s.toggle())}),t._UZ(1,"ec-icon",2),t.qZA()}if(2&i){const n=t.oxw();t.xp6(1),t.Q6J("icon",n.icon)}}let P=(()=>{class i{constructor(){this.editMode=!1}get icon(){return this.item&&this.item.deactivated?p.J.ACTIVATE:p.J.DEACTIVATE}ngOnInit(){}toggle(){this.item.deactivated=!this.item.deactivated,this.item.status=this.item.deactivated?"closed":"open",this.item.unsaved=!0}}return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["ec-deactivate-button"]],inputs:{item:"item",icon:"icon",editMode:"editMode"},decls:1,vars:1,consts:[[3,"click",4,"ngIf"],[3,"click"],[3,"icon"]],template:function(n,e){1&n&&t.YNc(0,q,2,1,"span",0),2&n&&t.Q6J("ngIf",e.editMode)},dependencies:[m.O5,x.k],styles:["span[_ngcontent-%COMP%]{cursor:pointer}"]}),i})();var L=a(7333),K=a(6326),j=a(5552),z=a(8759);function V(i,o){if(1&i){const n=t.EpF();t.TgZ(0,"tr",11)(1,"td")(2,"ec-text-field",12),t.NdJ("ngModelChange",function(s){t.CHM(n);const c=t.oxw().$implicit;return t.KtG(c.name=s)}),t.qZA()(),t.TgZ(3,"td",13)(4,"div",14)(5,"ec-icon",15),t.NdJ("click",function(){t.CHM(n);const s=t.oxw().$implicit,c=t.oxw(2);return t.KtG(c.showTransactionsFor(s))}),t.qZA(),t._UZ(6,"span",16),t.TgZ(7,"div",17),t._UZ(8,"ec-money-field",8),t.qZA()()(),t.TgZ(9,"td",17)(10,"ec-money-field",12),t.NdJ("ngModelChange",function(s){t.CHM(n);const c=t.oxw().$implicit;return t.KtG(c.target=s)}),t.qZA()(),t.TgZ(11,"td",17),t._UZ(12,"ec-money-field",18),t.qZA(),t.TgZ(13,"td")(14,"ec-text-field",12),t.NdJ("ngModelChange",function(s){t.CHM(n);const c=t.oxw().$implicit;return t.KtG(c.comment=s)}),t.qZA()(),t.TgZ(15,"td")(16,"ec-text-field",19),t.NdJ("ngModelChange",function(s){t.CHM(n);const c=t.oxw().$implicit;return t.KtG(c.status=s)}),t.qZA()(),t.TgZ(17,"td"),t._UZ(18,"ec-delete-button",20)(19,"ec-deactivate-button",20),t.qZA()()}if(2&i){const n=t.oxw().$implicit,e=t.oxw(2);t.Q6J("ecHighlightDeletedFor",n),t.xp6(2),t.Q6J("ngModel",n.name)("editMode",e.isEditMode),t.xp6(3),t.Q6J("icon",e.Icon.SHOW_TRANSACTIONS),t.xp6(3),t.Q6J("value",n.current_balance),t.xp6(2),t.Q6J("ngModel",n.target)("editMode",e.isEditMode),t.xp6(2),t.Q6J("value",0==n.target?0:n.current_balance-n.target),t.xp6(2),t.Q6J("ngModel",n.comment)("editMode",e.isEditMode),t.xp6(2),t.Q6J("ngModel",n.status),t.xp6(2),t.Q6J("item",n)("editMode",e.isEditMode),t.xp6(1),t.Q6J("item",n)("editMode",e.isEditMode)}}function X(i,o){if(1&i&&(t.ynx(0),t.YNc(1,V,20,15,"tr",10),t.BQk()),2&i){const n=o.$implicit,e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.deactivateService.isItemVisible(n,e.showDeactivated))}}function W(i,o){if(1&i&&(t.TgZ(0,"table",6)(1,"thead")(2,"tr")(3,"th"),t._uU(4,"Goal / Obligation"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Current Balance"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Target"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Outstanding"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Comment"),t.qZA(),t.TgZ(13,"th"),t._uU(14,"Status"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Actions"),t.qZA()()(),t.TgZ(17,"tbody")(18,"tr",7)(19,"td"),t._uU(20,"Sink Fund Account Balance"),t.qZA(),t.TgZ(21,"td"),t._UZ(22,"ec-money-field",8),t.qZA(),t._UZ(23,"td")(24,"td"),t.TgZ(25,"td"),t._uU(26,"Current Account Balance"),t.qZA(),t._UZ(27,"td")(28,"td"),t.qZA(),t.TgZ(29,"tr",7)(30,"td"),t._uU(31,"Unassigned Money"),t.qZA(),t.TgZ(32,"td"),t._UZ(33,"ec-money-field",8),t.qZA(),t._UZ(34,"td")(35,"td"),t.TgZ(36,"td"),t._uU(37,"Money not assigned to any financial goal/obligation"),t.qZA(),t._UZ(38,"td")(39,"td"),t.qZA(),t.YNc(40,X,2,1,"ng-container",9),t.qZA(),t.TgZ(41,"tfoot")(42,"tr",7)(43,"td"),t._uU(44,"Total"),t.qZA(),t.TgZ(45,"td"),t._UZ(46,"ec-money-field",8),t.qZA(),t.TgZ(47,"td"),t._UZ(48,"ec-money-field",8),t.qZA(),t.TgZ(49,"td"),t._UZ(50,"ec-money-field",8),t.qZA(),t._UZ(51,"td")(52,"td")(53,"td"),t.qZA()()()),2&i){const n=t.oxw();t.ekj("small-screen",n.isSmallScreen),t.xp6(3),t.Udp("width",25,"%"),t.xp6(2),t.Udp("width",10,"%"),t.xp6(2),t.Udp("width",10,"%"),t.xp6(2),t.Udp("width",10,"%"),t.xp6(2),t.Udp("width",20,"%"),t.xp6(2),t.Udp("width",5,"%"),t.xp6(2),t.Udp("width",10,"%"),t.xp6(7),t.Q6J("value",n.sinkFund.current_balance),t.xp6(11),t.Q6J("value",n.calculator.unassignedBalance(n.sinkFund)),t.xp6(7),t.Q6J("ngForOf",n.sinkFund.sink_fund_allocations),t.xp6(6),t.Q6J("value",n.calculator.totalAssignedBalance(n.sinkFund)),t.xp6(2),t.Q6J("value",n.calculator.totalTarget(n.sinkFund,n.showDeactivated)),t.xp6(2),t.Q6J("value",n.calculator.totalOutstanding(n.sinkFund,n.showDeactivated))}}function tt(i,o){if(1&i){const n=t.EpF();t.TgZ(0,"button",21),t.NdJ("click",function(){t.CHM(n);const s=t.oxw();return t.KtG(s.addObligation())}),t._uU(1," Add Obligation "),t.qZA()}}function nt(i,o){if(1&i){const n=t.EpF();t.TgZ(0,"button",22),t.NdJ("click",function(){t.CHM(n);const s=t.oxw();return t.KtG(s.showTransferForm())}),t._uU(1," Transfer Money "),t.qZA()}}let et=(()=>{class i{constructor(n,e,s,c,ut,mt){this.media=n,this.sinkFundService=e,this.transactionService=s,this.dialog=c,this.snackbar=ut,this.deactivateService=mt,this.Icon=p.J,this.isEditMode=!1,this.showDeactivated=!1}ngOnInit(){this.calculator=new v(this.deactivateService),this.sinkFund={sink_fund_allocations:[]},this.mediaSubscription=this.media.asObservable().subscribe(()=>{this.isSmallScreen=this.media.isActive("xs")})}save(){this.sinkFundService.save(this.sinkFund).subscribe(n=>{this.sinkFund=n,this.isEditMode=!1,this.snackbar.open("Sink fund saved",null,{duration:3e3})},n=>{this.snackbar.open("Not saved: "+JSON.stringify(n),null,{duration:3e3})})}cancel(){this.snackbar.open("Sink fund not saved",null,{duration:1e3})}isAllocationVisible(n){}showTransferForm(){let n=this.dialog.open(E,{width:"350px"});n.componentInstance.sinkFund=this.sinkFund,n.afterClosed().subscribe(e=>{e?this.snackbar.open("Transfer complete.",null,{duration:3e3}):this.snackbar.open("Transfer cancelled.",null,{duration:1500})})}showTransactionsFor(n){let e;this.transactionService.getTransactionsForSinkFundAllocation(n.id).subscribe(s=>{e=this.dialog.open(I.V,{width:"500px"}),e.componentInstance.transactions=s,e.componentInstance.itemName=n.name})}addObligation(){this.sinkFund.sink_fund_allocations.push({amount:0,current_balance:0,target:0,unsaved:!0})}ngOnDestroy(){this.mediaSubscription.unsubscribe()}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(G.u0),t.Y36(g),t.Y36($.q),t.Y36(u.uw),t.Y36(H.ux),t.Y36(F.u))},i.\u0275cmp=t.Xpm({type:i,selectors:[["ec-sink-fund"]],inputs:{sinkFund:"sinkFund"},decls:10,vars:5,consts:[["color","primary",3,"ngModel","ngModelChange"],[1,"fixed"],["class","table",3,"small-screen",4,"ngIf"],[3,"editMode","editModeChange","save","cancel"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],[1,"table"],[1,"total"],[3,"value"],[4,"ngFor","ngForOf"],[3,"ecHighlightDeletedFor",4,"ngIf"],[3,"ecHighlightDeletedFor"],[3,"ngModel","editMode","ngModelChange"],[1,"highlight"],["fxLayout","row","fxLayoutAlign","start center"],[1,"small",3,"icon","click"],["fxFlex",""],[1,"right"],["highlightPositive","true",3,"value"],[3,"ngModel","ngModelChange"],[3,"item","editMode"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(n,e){1&n&&(t.TgZ(0,"mat-card")(1,"mat-card-content")(2,"mat-slide-toggle",0),t.NdJ("ngModelChange",function(c){return e.showDeactivated=c}),t._uU(3,"Show Closed Obligations?"),t.qZA(),t.TgZ(4,"div",1),t.YNc(5,W,54,22,"table",2),t.qZA()(),t.TgZ(6,"mat-card-actions")(7,"ec-edit-actions",3),t.NdJ("editModeChange",function(c){return e.isEditMode=c})("save",function(){return e.save()})("cancel",function(){return e.cancel()}),t.YNc(8,tt,2,0,"button",4),t.YNc(9,nt,2,0,"button",5),t.qZA()()()),2&n&&(t.xp6(2),t.Q6J("ngModel",e.showDeactivated),t.xp6(3),t.Q6J("ngIf",e.sinkFund),t.xp6(2),t.Q6J("editMode",e.isEditMode),t.xp6(1),t.Q6J("ngIf",e.isEditMode),t.xp6(1),t.Q6J("ngIf",!e.isEditMode))},dependencies:[m.sg,m.O5,l.JJ,l.On,r.xw,r.Wh,r.yH,k.lW,d.a8,d.dn,d.hq,R.Rr,P,L.t,x.k,K.Y,j.O,T.x,z.a],styles:["div.fixed[_ngcontent-%COMP%]{width:100%;overflow-x:auto}table.table[_ngcontent-%COMP%]{table-layout:fixed;width:100%}table.table.small-screen[_ngcontent-%COMP%]{width:768px}.highlight[_ngcontent-%COMP%]{font-weight:700;font-size:13px}.total[_ngcontent-%COMP%]{font-weight:700;font-size:16px;border-top:2px solid black;border-bottom:2px solid black}ec-icon.small[_ngcontent-%COMP%]     .material-icons{font-size:16px;height:16px;width:16px;padding-top:1px;cursor:pointer}"]}),i})();const it=["field"];function ot(i,o){if(1&i&&(t.TgZ(0,"mat-option",3),t._uU(1),t.qZA()),2&i){const n=o.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij(" ",n.name," ")}}let at=(()=>{class i{constructor(){this.sinkFunds=[],this.change=new t.vpe}get value(){return this.field?this.field.value:0}set value(n){this.field.value=n}ngOnInit(){}}return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["ec-sink-fund-selector"]],viewQuery:function(n,e){if(1&n&&t.Gf(it,7),2&n){let s;t.iGM(s=t.CRH())&&(e.field=s.first)}},inputs:{sinkFunds:"sinkFunds"},outputs:{change:"change"},decls:6,vars:1,consts:[["color","primary","placeholder","Select a sink fund",3,"selectionChange"],["field",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,e){1&n&&(t.TgZ(0,"mat-card")(1,"mat-card-content")(2,"mat-form-field")(3,"mat-select",0,1),t.NdJ("selectionChange",function(c){return e.change.emit(c)}),t.YNc(5,ot,2,2,"mat-option",2),t.qZA()()()()),2&n&&(t.xp6(5),t.Q6J("ngForOf",e.sinkFunds))},dependencies:[m.sg,d.a8,d.dn,S.KE,Z.gD,C.ey],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),i})();const st=["selector"];let M=(()=>{class i{constructor(n,e,s,c){this.sinkFundService=n,this.toolbarService=e,this.activatedRoute=s,this.router=c,this.onDestroy$=new U.xQ}ngOnInit(){this.sinkFundService.getSinkFunds().subscribe(n=>{this.sinkFunds=n}),this.activatedRoute.paramMap.pipe((0,O.U)(n=>Number(n.get("sink_fund_id"))),(0,Q.h)(n=>n>0),(0,w.R)(this.onDestroy$)).subscribe(n=>this.selectSinkFund(n)),this.toolbarService.setHeading("Sink Fund Obligations"),this.sinkFundService.getCurrent().subscribe(n=>{this.sinkFund=n})}onSinkFundSelect(n){this.router.navigate([this.selector.value],{relativeTo:this.activatedRoute.parent})}selectSinkFund(n){this.selector.value=n,this.sinkFundService.refreshSinkFund(n)}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(g),t.Y36(N.S),t.Y36(f.gz),t.Y36(f.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["ec-sink-funds"]],viewQuery:function(n,e){if(1&n&&t.Gf(st,7),2&n){let s;t.iGM(s=t.CRH())&&(e.selector=s.first)}},decls:4,vars:2,consts:[[1,"main"],[3,"sinkFunds","change"],["selector",""],[3,"sinkFund"]],template:function(n,e){1&n&&(t.TgZ(0,"mat-card",0)(1,"ec-sink-fund-selector",1,2),t.NdJ("change",function(c){return e.onSinkFundSelect(c)}),t.qZA(),t._UZ(3,"ec-sink-fund",3),t.qZA()),2&n&&(t.xp6(1),t.Q6J("sinkFunds",e.sinkFunds),t.xp6(2),t.Q6J("sinkFund",e.sinkFund))},dependencies:[d.a8,et,at],encapsulation:2}),i})();const lt=[{path:"",canActivate:[a(1265).a],children:[{path:":sink_fund_id",component:M},{path:"",component:M}]}];let dt=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[f.Bz.forChild(lt),f.Bz]}),i})(),rt=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[g],imports:[y.m,A.c,dt]}),i})()}}]);