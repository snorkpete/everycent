"use strict";(self.webpackChunkeverycent=self.webpackChunkeverycent||[]).push([[550],{5550:(te,y,c)=>{c.r(y),c.d(y,{SpecialEventsModule:()=>Kt});var f=c(6895),_=c(6630),N=c(1265),d=c(4006),u=c(5412),t=c(4650),g=c(4859),D=c(1637),x=c(1769),U=c(8759);let w=(()=>{class e{constructor(n,o,a){this.fb=n,this.dialogRef=o,this.data=a,this.editMode=!0,this.form=this.fb.group({name:[a?.name||"",d.kI.required],budget_amount:[a?.budget_amount||0,[d.kI.required,d.kI.min(0)]],start_date:[a?.start_date||null]})}onSubmit(){this.form.valid&&this.dialogRef.close(this.form.value)}onCancel(){this.dialogRef.close()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(d.qu),t.Y36(u.so),t.Y36(u.WI))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-special-event-edit-details-form"]],decls:12,vars:7,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],["formControlName","name","placeholder","Name",3,"editMode","editModeChange"],["formControlName","budget_amount","placeholder","Budget Amount",3,"editMode","editModeChange"],["formControlName","start_date","placeholder","Start Date",3,"editMode","editModeChange"],["align","end"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(n,o){1&n&&(t.TgZ(0,"h2",0),t._uU(1),t.qZA(),t.TgZ(2,"form",1),t.NdJ("ngSubmit",function(){return o.onSubmit()}),t.TgZ(3,"mat-dialog-content")(4,"ec-text-field",2),t.NdJ("editModeChange",function(s){return o.editMode=s}),t.qZA(),t.TgZ(5,"ec-money-field",3),t.NdJ("editModeChange",function(s){return o.editMode=s}),t.qZA(),t.TgZ(6,"ec-date-field",4),t.NdJ("editModeChange",function(s){return o.editMode=s}),t.qZA()(),t.TgZ(7,"mat-dialog-actions",5)(8,"button",6),t.NdJ("click",function(){return o.onCancel()}),t._uU(9,"Cancel"),t.qZA(),t.TgZ(10,"button",7),t._uU(11),t.qZA()()()),2&n&&(t.xp6(1),t.hij("",o.data?"Edit":"Add"," Special Event"),t.xp6(1),t.Q6J("formGroup",o.form),t.xp6(2),t.Q6J("editMode",o.editMode),t.xp6(1),t.Q6J("editMode",o.editMode),t.xp6(1),t.Q6J("editMode",o.editMode),t.xp6(4),t.Q6J("disabled",!o.form.valid),t.xp6(1),t.hij(" ",o.data?"Save":"Add"," "))},dependencies:[d._Y,d.JJ,d.JL,d.sg,d.u,g.lW,u.uh,u.xY,u.H8,D.Q,x.x,U.a],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}"]}),e})();var Y=c(7369);let v=(()=>{class e{constructor(n){this.apiGateway=n}getSpecialEvents(){return this.apiGateway.get("/special_events")}getSpecialEvent(n){return this.apiGateway.get(`/special_events/${n}`)}createSpecialEvent(n){return this.apiGateway.post("/special_events",{special_event:n})}updateSpecialEvent(n,o){return this.apiGateway.put(`/special_events/${n}`,{special_event:o})}updateSpecialEventAllocations(n,o){return this.apiGateway.put(`/special_events/${n}/allocations`,{special_event:o})}deleteSpecialEvent(n){return this.apiGateway.delete(`/special_events/${n}`)}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(Y.i))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var T=c(8731),S=c(1161),m=c(3546),C=c(7392),l=c(2143),E=c(1944);function q(e,i){1&e&&(t.TgZ(0,"th",14),t._uU(1,"Name"),t.qZA())}function O(e,i){if(1&e&&(t.TgZ(0,"td",15),t._uU(1),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(n.name)}}function J(e,i){1&e&&(t.TgZ(0,"th",14),t._uU(1,"Start Date"),t.qZA())}function Q(e,i){if(1&e&&(t.TgZ(0,"td",15),t._uU(1),t.ALo(2,"date"),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,n.start_date))}}function B(e,i){1&e&&(t.TgZ(0,"th",14),t._uU(1,"Budget"),t.qZA())}function R(e,i){if(1&e&&(t.TgZ(0,"td",15),t._uU(1),t.ALo(2,"ecMoney"),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,n.budget_amount))}}function k(e,i){1&e&&(t.TgZ(0,"th",14),t._uU(1,"Actual"),t.qZA())}function I(e,i){if(1&e&&(t.TgZ(0,"td",15),t._uU(1),t.ALo(2,"ecMoney"),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,n.actual_amount))}}function F(e,i){1&e&&(t.TgZ(0,"th",14),t._uU(1,"Difference"),t.qZA())}function P(e,i){if(1&e&&(t.TgZ(0,"td",15),t._UZ(1,"ec-money-field",16),t.qZA()),2&e){const n=i.$implicit,o=t.oxw();t.xp6(1),t.Q6J("value",o.calculateDifference(n))("editMode",!1)}}function $(e,i){1&e&&t._UZ(0,"th",14)}function G(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"td",15)(1,"button",17),t.NdJ("click",function(){const s=t.CHM(n).$implicit,r=t.oxw();return t.KtG(r.viewDetails(s))}),t.TgZ(2,"mat-icon"),t._uU(3,"visibility"),t.qZA()(),t.TgZ(4,"button",18),t.NdJ("click",function(){const s=t.CHM(n).$implicit,r=t.oxw();return t.KtG(r.deleteEvent(s))}),t.TgZ(5,"mat-icon"),t._uU(6,"delete"),t.qZA()()()}}function H(e,i){1&e&&t._UZ(0,"tr",19)}function j(e,i){1&e&&t._UZ(0,"tr",20)}let L=(()=>{class e{constructor(n,o,a,s,r){this.specialEventsService=n,this.router=o,this.dialog=a,this.messageService=s,this.loadingIndicator=r,this.specialEvents=[],this.displayedColumns=["name","start_date","budget","amount","difference","actions"]}ngOnInit(){this.refresh()}calculateDifference(n){return(n.budget_amount||0)-(n.actual_amount||0)}refresh(){this.specialEventsService.getSpecialEvents().subscribe(n=>this.specialEvents=n)}viewDetails(n){this.router.navigate(["/special-events",n.id])}deleteEvent(n){confirm(`Are you sure you want to delete "${n.name}"?`)&&(this.loadingIndicator.show(),this.specialEventsService.deleteSpecialEvent(n.id).subscribe({next:()=>{this.loadingIndicator.hide(),this.messageService.setMessage("Special event deleted successfully.",5e3),this.refresh()},error:o=>{this.loadingIndicator.hide(),this.messageService.setMessage("Error deleting special event.",5e3),console.error("Error deleting special event:",o)}}))}openAddDialog(){this.dialog.open(w,{width:"400px"}).afterClosed().subscribe(o=>{o&&(this.loadingIndicator.show(),this.specialEventsService.createSpecialEvent(o).subscribe({next:()=>{this.loadingIndicator.hide(),this.messageService.setMessage("Special event created successfully.",5e3),this.refresh()},error:a=>{this.loadingIndicator.hide(),this.messageService.setMessage("Error creating special event.",5e3),console.error("Error creating special event:",a)}}))})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(v),t.Y36(_.F0),t.Y36(u.uw),t.Y36(T.e),t.Y36(S.T))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-special-events"]],decls:31,vars:3,consts:[[1,"main"],["mat-table","",1,"mat-elevation-z1",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","start_date"],["matColumnDef","budget"],["matColumnDef","amount"],["matColumnDef","difference"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"value","editMode"],["mat-icon-button","","color","primary","matTooltip","View",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,o){1&n&&(t.TgZ(0,"mat-card",0)(1,"mat-card")(2,"mat-card-title"),t._uU(3,"Special Events"),t.qZA(),t.TgZ(4,"mat-card-content")(5,"table",1),t.ynx(6,2),t.YNc(7,q,2,0,"th",3),t.YNc(8,O,2,1,"td",4),t.BQk(),t.ynx(9,5),t.YNc(10,J,2,0,"th",3),t.YNc(11,Q,3,3,"td",4),t.BQk(),t.ynx(12,6),t.YNc(13,B,2,0,"th",3),t.YNc(14,R,3,3,"td",4),t.BQk(),t.ynx(15,7),t.YNc(16,k,2,0,"th",3),t.YNc(17,I,3,3,"td",4),t.BQk(),t.ynx(18,8),t.YNc(19,F,2,0,"th",3),t.YNc(20,P,2,2,"td",4),t.BQk(),t.ynx(21,9),t.YNc(22,$,1,0,"th",3),t.YNc(23,G,7,0,"td",4),t.BQk(),t.YNc(24,H,1,0,"tr",10),t.YNc(25,j,1,0,"tr",11),t.qZA()(),t.TgZ(26,"mat-card-actions")(27,"button",12),t.NdJ("click",function(){return o.openAddDialog()}),t._uU(28,"Add Special Event"),t.qZA(),t.TgZ(29,"button",13),t.NdJ("click",function(){return o.refresh()}),t._uU(30,"Refresh"),t.qZA()()()()),2&n&&(t.xp6(5),t.Q6J("dataSource",o.specialEvents),t.xp6(19),t.Q6J("matHeaderRowDef",o.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.displayedColumns))},dependencies:[g.lW,m.a8,m.dn,m.n5,m.hq,C.Hw,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,x.x,f.uU,E.L],styles:[".mat-table[_ngcontent-%COMP%]{width:100%}.mat-column-name[_ngcontent-%COMP%]{flex:2}.mat-column-start_date[_ngcontent-%COMP%]{flex:1}.mat-column-budget[_ngcontent-%COMP%], .mat-column-amount[_ngcontent-%COMP%], .mat-column-difference[_ngcontent-%COMP%]{flex:1;text-align:right}.mat-column-actions[_ngcontent-%COMP%]{width:100px;text-align:center}"]}),e})();var z=c(6529),W=c(7814),X=c(9210),K=c(270);function V(e,i){1&e&&(t.TgZ(0,"th",14),t._uU(1,"Allocation"),t.qZA())}function tt(e,i){if(1&e&&(t.TgZ(0,"td",15),t._uU(1),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(n.name)}}function et(e,i){1&e&&(t.TgZ(0,"td",16),t._uU(1,"Total"),t.qZA())}function nt(e,i){1&e&&(t.TgZ(0,"th",14),t._uU(1,"Budget"),t.qZA())}function ot(e,i){if(1&e&&(t.TgZ(0,"td",15),t._uU(1),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(n.budget_name)}}function it(e,i){1&e&&t._UZ(0,"td",17)}function at(e,i){1&e&&(t.TgZ(0,"th",14),t._uU(1,"Category"),t.qZA())}function lt(e,i){if(1&e&&(t.TgZ(0,"td",15),t._uU(1),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(n.allocation_category_name)}}function ct(e,i){1&e&&t._UZ(0,"td",17)}function st(e,i){1&e&&(t.TgZ(0,"th",14),t._uU(1,"Amount"),t.qZA())}function rt(e,i){if(1&e&&(t.TgZ(0,"td",15),t._uU(1),t.ALo(2,"ecMoney"),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,n.amount))}}function dt(e,i){1&e&&t._UZ(0,"td",17)}function mt(e,i){1&e&&(t.TgZ(0,"th",14),t._uU(1,"Spent"),t.qZA())}function pt(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"td",15)(1,"ec-icon",18),t.NdJ("click",function(){const s=t.CHM(n).$implicit,r=t.oxw();return t.KtG(r.showTransactionsFor(s))}),t.qZA(),t._uU(2),t.ALo(3,"ecMoney"),t.qZA()}if(2&e){const n=i.$implicit,o=t.oxw();t.xp6(1),t.Q6J("icon",o.Icon.SHOW_TRANSACTIONS),t.xp6(1),t.hij(" ",t.lcZ(3,2,n.spent)," ")}}function ut(e,i){if(1&e&&(t.TgZ(0,"td",17),t._uU(1),t.ALo(2,"ecMoney"),t.qZA()),2&e){const n=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,n.totalSpent()))}}function _t(e,i){1&e&&t._UZ(0,"th",14)}function ft(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"td",15)(1,"button",20),t.NdJ("click",function(){const s=t.CHM(n).$implicit,r=t.oxw(2);return t.KtG(r.onAction(s))}),t.TgZ(2,"mat-icon"),t._uU(3),t.qZA()()()}if(2&e){const n=t.oxw(2);t.xp6(1),t.Q6J("color",n.actionButtonColor),t.xp6(2),t.Oqu(n.actionButtonIcon)}}function gt(e,i){1&e&&t._UZ(0,"td",17)}function ht(e,i){1&e&&(t.ynx(0,19),t.YNc(1,_t,1,0,"th",2),t.YNc(2,ft,4,2,"td",3),t.YNc(3,gt,1,0,"td",6),t.BQk())}function vt(e,i){1&e&&t._UZ(0,"tr",21)}function Ct(e,i){1&e&&t._UZ(0,"tr",22)}function Et(e,i){1&e&&t._UZ(0,"tr",23)}let M=(()=>{class e{constructor(n,o){this.transactionService=n,this.dialog=o,this.Icon=W.J,this.allocations=[],this.showActionColumn=!1,this.actionButtonIcon="add_circle",this.actionButtonColor="primary",this.action=new t.vpe}get displayedColumns(){const n=["name","budget","category","amount","spent"];return this.showActionColumn&&n.push("action"),n}refresh(){this.table?.renderRows()}onAction(n){this.action.emit(n)}showTransactionsFor(n){let o=this.dialog.open(z.V,{width:"500px"});this.transactionService.transactionsForAllocation(n.id).subscribe(a=>{o.componentInstance.transactions=a,o.componentInstance.itemName=n.name})}totalSpent(){return this.allocations.reduce((n,o)=>n+(o.spent||0),0)}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(X.q),t.Y36(u.uw))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-special-events-allocations-table"]],viewQuery:function(n,o){if(1&n&&t.Gf(l.BZ,5),2&n){let a;t.iGM(a=t.CRH())&&(o.table=a.first)}},inputs:{allocations:"allocations",showActionColumn:"showActionColumn",actionButtonIcon:"actionButtonIcon",actionButtonColor:"actionButtonColor"},outputs:{action:"action"},decls:25,vars:5,consts:[["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","","class","bold",4,"matFooterCellDef"],["matColumnDef","budget"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","category"],["matColumnDef","amount"],["matColumnDef","spent"],["matColumnDef","action",4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-footer-row","","class","footer",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell",""],["mat-footer-cell","",1,"bold"],["mat-footer-cell",""],[1,"small",3,"icon","click"],["matColumnDef","action"],["mat-icon-button","",3,"color","click"],["mat-header-row",""],["mat-row",""],["mat-footer-row","",1,"footer"]],template:function(n,o){1&n&&(t.TgZ(0,"table",0),t.ynx(1,1),t.YNc(2,V,2,0,"th",2),t.YNc(3,tt,2,1,"td",3),t.YNc(4,et,2,0,"td",4),t.BQk(),t.ynx(5,5),t.YNc(6,nt,2,0,"th",2),t.YNc(7,ot,2,1,"td",3),t.YNc(8,it,1,0,"td",6),t.BQk(),t.ynx(9,7),t.YNc(10,at,2,0,"th",2),t.YNc(11,lt,2,1,"td",3),t.YNc(12,ct,1,0,"td",6),t.BQk(),t.ynx(13,8),t.YNc(14,st,2,0,"th",2),t.YNc(15,rt,3,3,"td",3),t.YNc(16,dt,1,0,"td",6),t.BQk(),t.ynx(17,9),t.YNc(18,mt,2,0,"th",2),t.YNc(19,pt,4,4,"td",3),t.YNc(20,ut,3,3,"td",6),t.BQk(),t.YNc(21,ht,4,0,"ng-container",10),t.YNc(22,vt,1,0,"tr",11),t.YNc(23,Ct,1,0,"tr",12),t.YNc(24,Et,1,0,"tr",13),t.qZA()),2&n&&(t.Q6J("dataSource",o.allocations),t.xp6(21),t.Q6J("ngIf",o.showActionColumn),t.xp6(1),t.Q6J("matHeaderRowDef",o.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.displayedColumns),t.xp6(1),t.Q6J("matFooterRowDef",o.displayedColumns))},dependencies:[f.O5,g.lW,C.Hw,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.mD,l.Ke,l.ge,l.ev,l.yh,l.XQ,l.Gk,l.Q2,K.k,E.L],styles:[".mat-table[_ngcontent-%COMP%]{width:100%;margin-top:16px}.mat-column-name[_ngcontent-%COMP%]{flex:2}.mat-column-budget[_ngcontent-%COMP%], .mat-column-category[_ngcontent-%COMP%]{flex:1}.mat-column-amount[_ngcontent-%COMP%], .mat-column-spent[_ngcontent-%COMP%]{flex:1;text-align:right}.mat-column-action[_ngcontent-%COMP%]{width:48px;text-align:center}ec-icon.small[_ngcontent-%COMP%]     .material-icons{font-size:16px;height:16px;width:16px;padding-top:1px;cursor:pointer}.footer[_ngcontent-%COMP%]{font-weight:700;border-top:2px solid grey}.bold[_ngcontent-%COMP%]{font-weight:700}"]}),e})();function At(e,i){if(1&e&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&e){const n=t.oxw();t.xp6(1),t.hij("| Start: ",t.lcZ(2,1,null==n.specialEvent?null:n.specialEvent.start_date),"")}}let Tt=(()=>{class e{constructor(n,o,a,s,r,p){this.route=n,this.router=o,this.specialEventsService=a,this.messageService=s,this.loadingIndicator=r,this.dialog=p,this.allocations=[]}ngOnInit(){this.route.params.subscribe(n=>{const o=n.id;o&&this.loadSpecialEvent(o)})}back(){this.router.navigate(["/special-events"])}loadSpecialEvent(n){this.loadingIndicator.show(),this.specialEventsService.getSpecialEvent(n).subscribe({next:o=>{this.loadingIndicator.hide(),this.specialEvent=o,this.allocations=o.allocations??[]},error:o=>{this.loadingIndicator.hide(),this.messageService.setMessage("Error loading special event.",5e3),console.error("Error loading special event:",o)}})}refresh(){this.specialEvent&&this.loadSpecialEvent(this.specialEvent.id)}adjustAllocations(){this.router.navigate(["allocations"],{relativeTo:this.route})}edit(){this.dialog.open(w,{width:"400px",data:this.specialEvent}).afterClosed().subscribe(o=>{o&&(this.loadingIndicator.show(),this.specialEventsService.updateSpecialEvent(this.specialEvent.id,o).subscribe({next:a=>{this.loadingIndicator.hide(),this.specialEvent=a,this.messageService.setMessage("Special event updated successfully.",5e3)},error:a=>{this.loadingIndicator.hide(),this.messageService.setMessage("Error updating special event.",5e3),console.error("Error updating special event:",a)}}))})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(_.gz),t.Y36(_.F0),t.Y36(v),t.Y36(T.e),t.Y36(S.T),t.Y36(u.uw))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-special-event"]],decls:22,vars:9,consts:[[1,"main"],[4,"ngIf"],["mat-button","","color","primary",3,"click"],[3,"allocations"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"mat-card",0)(1,"mat-card")(2,"mat-card-title"),t._uU(3),t.qZA(),t.TgZ(4,"mat-card-subtitle"),t._uU(5),t.ALo(6,"ecMoney"),t.ALo(7,"ecMoney"),t.YNc(8,At,3,3,"span",1),t.qZA(),t.TgZ(9,"mat-card-content")(10,"button",2),t.NdJ("click",function(){return o.back()}),t.TgZ(11,"mat-icon"),t._uU(12,"arrow_back"),t.qZA(),t._uU(13," Back to Special Events "),t.qZA(),t._UZ(14,"ec-special-events-allocations-table",3),t.qZA(),t.TgZ(15,"mat-card-actions")(16,"button",4),t.NdJ("click",function(){return o.adjustAllocations()}),t._uU(17,"Adjust Allocations"),t.qZA(),t.TgZ(18,"button",4),t.NdJ("click",function(){return o.edit()}),t._uU(19,"Edit Details"),t.qZA(),t.TgZ(20,"button",5),t.NdJ("click",function(){return o.refresh()}),t._uU(21,"Refresh"),t.qZA()()()()),2&n&&(t.xp6(3),t.Oqu(null==o.specialEvent?null:o.specialEvent.name),t.xp6(2),t.AsE(" Budgeted: ",t.lcZ(6,5,null==o.specialEvent?null:o.specialEvent.budget_amount)," | Actual: ",t.lcZ(7,7,null==o.specialEvent?null:o.specialEvent.actual_amount)," "),t.xp6(3),t.Q6J("ngIf",null==o.specialEvent?null:o.specialEvent.start_date),t.xp6(6),t.Q6J("allocations",o.allocations))},dependencies:[f.O5,g.lW,m.a8,m.dn,m.n5,m.$j,m.hq,C.Hw,M,f.uU,E.L],styles:[".mat-table[_ngcontent-%COMP%]{width:100%;margin-top:16px}button[mat-button][_ngcontent-%COMP%]{margin-bottom:16px}"]}),e})();var St=c(5529),Z=c(7625),Zt=c(4900),bt=c(194),yt=c(9549),xt=c(4385),wt=c(3238);const Mt=["specialEventAllocationsTable"],Nt=["addNewAllocationsTable"];function Dt(e,i){if(1&e&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&e){const n=i.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij(" ",n.name," ")}}function Ut(e,i){if(1&e&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&e){const n=i.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij(" ",n.name," ")}}function Yt(e,i){1&e&&(t.TgZ(0,"th",25),t._uU(1,"Name"),t.qZA())}function qt(e,i){if(1&e&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(n.name)}}function Ot(e,i){1&e&&(t.TgZ(0,"th",25),t._uU(1,"Budgeted"),t.qZA())}function Jt(e,i){if(1&e&&(t.TgZ(0,"td",26),t._uU(1),t.ALo(2,"ecMoney"),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,n.amount))}}function Qt(e,i){1&e&&(t.TgZ(0,"th",25),t._uU(1,"Spent"),t.qZA())}function Bt(e,i){if(1&e&&(t.TgZ(0,"td",26),t._uU(1),t.ALo(2,"ecMoney"),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,n.spent))}}function Rt(e,i){1&e&&(t.TgZ(0,"th",25),t._uU(1,"Category"),t.qZA())}function kt(e,i){if(1&e&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.Oqu(null==n.allocation_category?null:n.allocation_category.name)}}function It(e,i){1&e&&t._UZ(0,"th",25)}function Ft(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"td",26)(1,"button",27),t.NdJ("click",function(){const s=t.CHM(n).$implicit,r=t.oxw();return t.KtG(r.addAllocation(s))}),t.TgZ(2,"mat-icon"),t._uU(3,"add_circle"),t.qZA()()()}if(2&e){const n=i.$implicit,o=t.oxw();t.xp6(1),t.Q6J("disabled",o.isAllocationAssigned(n))}}function Pt(e,i){if(1&e&&(t.TgZ(0,"td",28),t._uU(1),t.qZA()),2&e){const n=i.$implicit;t.xp6(1),t.hij(" ",n.name," ")}}function $t(e,i){1&e&&t._UZ(0,"tr",29)}function Gt(e,i){1&e&&t._UZ(0,"tr",30)}function Ht(e,i){1&e&&t._UZ(0,"tr",30)}const jt=function(){return["categoryHeader"]},zt=[{path:"",canActivate:[N.a],children:[{path:"",component:L},{path:":id",component:Tt},{path:":id/allocations",component:(()=>{class e{constructor(n,o,a,s,r,p,A,b){this.fb=n,this.budgetService=o,this.specialEventsService=a,this.route=s,this.router=r,this.messageService=p,this.loadingIndicator=A,this.settingsService=b,this.budgets=[],this.allocations=[],this.allocationCategories=[],this.groupedAllocations=[],this.displayedColumns=["name","amount","spent","add"],this.componentDestroyed=new St.xQ,this.isCategoryRow=(Vt,h)=>h.name&&!h.amount,this.isAllocationRow=(Vt,h)=>!h.name||h.amount}ngOnInit(){this.form=this.fb.group({budget_id:0,allocation_category_id:0}),this.loadBudgets(),this.loadAllocationCategories(),this.route.params.pipe((0,Z.R)(this.componentDestroyed)).subscribe(n=>{if(n.id){const o=Number(n.id);this.specialEventsService.getSpecialEvent(o).subscribe(a=>{this.specialEvent=a,this.specialEvent.allocations||(this.specialEvent.allocations=[])})}}),this.form.valueChanges.pipe((0,Z.R)(this.componentDestroyed)).subscribe(()=>{const n=this.form.get("budget_id").value;n?this.loadAllocations(n):(this.allocations=[],this.groupedAllocations=[]),this.router.navigate([],{relativeTo:this.route,queryParams:{budget_id:this.form.get("budget_id").value,allocation_category_id:this.form.get("allocation_category_id").value},queryParamsHandling:"merge"})}),this.route.queryParams.pipe((0,Z.R)(this.componentDestroyed)).subscribe(n=>{const o=Number(n.budget_id)||0,a=n.allocation_category_id?Number(n.allocation_category_id):null;this.form.patchValue({budget_id:o,allocation_category_id:a})})}ngOnDestroy(){this.componentDestroyed.next(),this.componentDestroyed.complete()}loadBudgets(){this.budgetService.getBudgets().subscribe(n=>{this.budgets=n})}loadAllocations(n){this.budgetService.getBudget(n).subscribe(o=>{this.allocations=o.allocations,this.groupAllocationsByCategory()})}loadAllocationCategories(){this.budgetService.getAllocationCategories().subscribe(n=>{this.allocationCategories=n})}groupAllocationsByCategory(){const n=new Map,o=this.form.get("allocation_category_id").value,a=o?this.allocations.filter(r=>r.allocation_category_id===o):this.allocations,s=a.filter(r=>!r.allocation_category_id);s.length>0&&n.set("Uncategorized",{name:"Uncategorized",allocations:s}),this.allocationCategories.forEach(r=>{const p=r.name,A=a.filter(b=>b.allocation_category_id===r.id);A.length>0&&n.set(p,{name:p,allocations:A})}),this.groupedAllocations=Array.from(n.values()).reduce((r,p)=>(r.push(p),r.push(...p.allocations),r),[])}isAllocationAssigned(n){return this.specialEvent?.allocations?.some(o=>o.id===n.id)||!1}addAllocation(n){this.specialEvent.allocations||(this.specialEvent.allocations=[]),this.isAllocationAssigned(n)||(this.specialEvent.allocations.push(n),this.specialEventAllocationsTable.refresh())}removeAllocation(n){this.specialEvent.allocations&&(this.specialEvent.allocations=this.specialEvent.allocations.filter(o=>o.id!==n.id),this.specialEventAllocationsTable.refresh())}calculateActualAmount(){return this.specialEvent?.allocations?this.specialEvent.allocations.reduce((n,o)=>n+(o.spent||0),0):0}save(){this.loadingIndicator.show();const n=this.specialEvent.allocations.map(o=>o.id);this.specialEventsService.updateSpecialEventAllocations(this.specialEvent.id,{allocation_ids:n,actual_amount:this.calculateActualAmount()}).subscribe({next:o=>{this.loadingIndicator.hide(),this.specialEvent=o,this.messageService.setMessage("Special event updated successfully.",5e3)},error:o=>{this.loadingIndicator.hide(),this.messageService.setMessage("Error updating special event.",5e3),console.error("Error updating special event:",o)}})}cancel(){this.router.navigate(["/special-events",this.specialEvent.id])}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(d.qu),t.Y36(Zt.t),t.Y36(v),t.Y36(_.gz),t.Y36(_.F0),t.Y36(T.e),t.Y36(S.T),t.Y36(bt.g))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ec-special-event-edit-allocations"]],viewQuery:function(n,o){if(1&n&&(t.Gf(Mt,5),t.Gf(Nt,5)),2&n){let a;t.iGM(a=t.CRH())&&(o.specialEventAllocationsTable=a.first),t.iGM(a=t.CRH())&&(o.addNewAllocationsTable=a.first)}},decls:57,vars:24,consts:[[1,"main"],[1,"highlighted"],[3,"allocations","showActionColumn","actionButtonIcon","actionButtonColor","action"],["specialEventAllocationsTable",""],[3,"formGroup"],[1,"filter-row"],["placeholder","Select Budget","formControlName","budget_id"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Filter by Category","formControlName","allocation_category_id"],[3,"value"],["mat-table","",1,"mat-elevation-z1",3,"dataSource","multiTemplateDataRows"],["addNewAllocationsTable",""],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["matColumnDef","spent"],["matColumnDef","category"],["matColumnDef","add"],["matColumnDef","categoryHeader"],["mat-cell","","colspan","4","class","category-header",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary",3,"disabled","click"],["mat-cell","","colspan","4",1,"category-header"],["mat-header-row",""],["mat-row",""]],template:function(n,o){1&n&&(t.TgZ(0,"mat-card",0)(1,"mat-card")(2,"mat-card-title"),t._uU(3),t.qZA(),t.TgZ(4,"mat-card-subtitle"),t._uU(5),t.ALo(6,"ecMoney"),t.TgZ(7,"span",1),t._uU(8,"*"),t.qZA(),t._uU(9),t.ALo(10,"ecMoney"),t.qZA(),t.TgZ(11,"mat-card-content")(12,"h3"),t._uU(13,"Allocations"),t.qZA(),t.TgZ(14,"ec-special-events-allocations-table",2,3),t.NdJ("action",function(s){return o.removeAllocation(s)}),t.qZA()()(),t.TgZ(16,"mat-card")(17,"mat-card-title"),t._uU(18),t.qZA(),t.TgZ(19,"mat-card-content")(20,"form",4)(21,"div",5)(22,"mat-form-field")(23,"mat-select",6),t.YNc(24,Dt,2,2,"mat-option",7),t.qZA()(),t.TgZ(25,"mat-form-field")(26,"mat-select",8)(27,"mat-option",9),t._uU(28,"All Categories"),t.qZA(),t.YNc(29,Ut,2,2,"mat-option",7),t.qZA()()(),t.TgZ(30,"table",10,11),t.ynx(32,12),t.YNc(33,Yt,2,0,"th",13),t.YNc(34,qt,2,1,"td",14),t.BQk(),t.ynx(35,15),t.YNc(36,Ot,2,0,"th",13),t.YNc(37,Jt,3,3,"td",14),t.BQk(),t.ynx(38,16),t.YNc(39,Qt,2,0,"th",13),t.YNc(40,Bt,3,3,"td",14),t.BQk(),t.ynx(41,17),t.YNc(42,Rt,2,0,"th",13),t.YNc(43,kt,2,1,"td",14),t.BQk(),t.ynx(44,18),t.YNc(45,It,1,0,"th",13),t.YNc(46,Ft,4,1,"td",14),t.BQk(),t.ynx(47,19),t.YNc(48,Pt,2,1,"td",20),t.BQk(),t.YNc(49,$t,1,0,"tr",21),t.YNc(50,Gt,1,0,"tr",22),t.YNc(51,Ht,1,0,"tr",22),t.qZA()()(),t.TgZ(52,"mat-card-actions")(53,"button",23),t.NdJ("click",function(){return o.save()}),t._uU(54,"Save"),t.qZA(),t.TgZ(55,"button",24),t.NdJ("click",function(){return o.cancel()}),t._uU(56,"Cancel"),t.qZA()()()()),2&n&&(t.xp6(3),t.Oqu(null==o.specialEvent?null:o.specialEvent.name),t.xp6(2),t.hij(" Budgeted: ",t.lcZ(6,19,null==o.specialEvent?null:o.specialEvent.budget_amount)," | "),t.xp6(4),t.hij("Actual: ",t.lcZ(10,21,o.calculateActualAmount())," "),t.xp6(5),t.Q6J("allocations",null==o.specialEvent?null:o.specialEvent.allocations)("showActionColumn",!0)("actionButtonIcon","delete")("actionButtonColor","warn"),t.xp6(4),t.hij("Assign Allocations to ",null==o.specialEvent?null:o.specialEvent.name,""),t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(4),t.Q6J("ngForOf",o.budgets),t.xp6(3),t.Q6J("value",null),t.xp6(2),t.Q6J("ngForOf",o.allocationCategories),t.xp6(1),t.Q6J("dataSource",o.groupedAllocations)("multiTemplateDataRows",!0),t.xp6(19),t.Q6J("matHeaderRowDef",o.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",t.DdM(23,jt))("matRowDefWhen",o.isCategoryRow),t.xp6(1),t.Q6J("matRowDefColumns",o.displayedColumns)("matRowDefWhen",o.isAllocationRow))},dependencies:[f.sg,d._Y,d.JJ,d.JL,d.sg,d.u,g.lW,m.a8,m.dn,m.n5,m.$j,m.hq,C.Hw,yt.KE,xt.gD,wt.ey,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,M,E.L],styles:[".mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.filter-row[_ngcontent-%COMP%]{display:flex;gap:16px}.filter-row[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{flex:1}.mat-table[_ngcontent-%COMP%]{width:100%}.mat-column-name[_ngcontent-%COMP%]{flex:2}.mat-column-amount[_ngcontent-%COMP%], .mat-column-spent[_ngcontent-%COMP%]{flex:1;text-align:right}.mat-column-category[_ngcontent-%COMP%]{flex:1}.mat-column-add[_ngcontent-%COMP%], .mat-column-remove[_ngcontent-%COMP%]{width:48px;text-align:center}.category-header[_ngcontent-%COMP%]{font-weight:700;background-color:#f5f5f5;padding:8px 16px}.highlighted[_ngcontent-%COMP%]{color:red}"]}),e})()}]}];let Wt=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[_.Bz.forChild(zt),_.Bz]}),e})();var Xt=c(6712);let Kt=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[v],imports:[Xt.m,f.ez,Wt]}),e})()}}]);