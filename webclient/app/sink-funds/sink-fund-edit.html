<div class="row">
    <div class="col-xs-6">
        <h2>Edit Sink Fund: {{ vm.sinkFund.name }}</h2>
    </div>
    <div class="col-sm-6">
        <div class="text-right">
                <label>
                    <input type="checkbox"
                           ng-model="vm.showClosed" />
                    Include Closed Allocations?
                </label>
        </div>
    </div>
</div>


<ec-panel title="Edit Allocations for: {{ vm.sinkFund.name }}" type="primary">
    <table class="table table-bordered rounded fixed-layout">
    <thead>
        <tr class="heading">
            <th style="width:25%;">Name</th>
            <th style="width:10%;" class="text-right">Allocated</th>
            <th style="width:10%;" class="text-right">Spent</th>
            <th style="width:10%;" class="text-right">Remaining</th>
            <th style="width:25%;" class="hidden-xs">Comment</th>
            <th style="width:15%;" class="hidden-xs">Status</th>
            <th style="width:5%;"></th>
        </tr>
    </thead>
    <tfoot>
        <tr class="total">
            <th> Total </th>
            <th class="text-right">
                {{ vm.util.total(vm.sinkFund.sink_fund_allocations, 'amount') | ecToDollars }}
            </th>
            <th class="text-right">
                {{ vm.util.total(vm.sinkFund.sink_fund_allocations, 'spent') | ecToDollars }}
            </th>
            <th class="text-right">
                <ec-amount-formatted amount="vm.accountBalance(vm.sinkFund)">
                </ec-amount-formatted>
            </th>
            <th class="text-right"> </th>
            <th></th>
            <th></th>
        </tr>
    </tfoot>
    <tbody>
        <tr>
            <td>
                <strong> Unassigned Money </strong>
            </td>
            <td class="text-right">
                <strong><ec-amount-formatted amount="vm.unassignedBalance(vm.sinkFund)"></ec-amount-formatted></strong>
            </td>
            <td></td>
            <td class="text-right">
                <strong><ec-amount-formatted amount="vm.unassignedBalance(vm.sinkFund)"></ec-amount-formatted></strong>
            </td>
            <td>
                <strong><em> Money not allocated</em></strong>
            </td>
            <td></td>
            <td></td>
        </tr>
        <tr ng-repeat="sinkFundAllocation in vm.sinkFund.sink_fund_allocations"
            ng-class="{ danger: sinkFundAllocation.deleted, warning: sinkFundAllocation.status === 'closed' }"
            ng-show="vm.isSinkFundAllocationVisible(sinkFundAllocation)">

            <td>
                <span ng-hide="vm.isEditMode" ng-bind="sinkFundAllocation.name"> </span>
                <input type="text" ng-show="vm.isEditMode" ng-model="sinkFundAllocation.name" name="name"></input>
            </td>
            <td class="text-right">
                <span ng-hide="vm.isEditMode" ng-bind="sinkFundAllocation.amount | ecToDollars"></span>
                <input type="text" ng-show="vm.isEditMode" ng-model="sinkFundAllocation.amount" ec-as-dollars></input>
            </td>
            <td class="text-right">
                <span ng-bind="sinkFundAllocation.spent | ecToDollars"></span>
            </td>
            <td class="text-right">
                <ec-amount-formatted amount="sinkFundAllocation.amount-sinkFundAllocation.spent">
                </ec-amount-formatted>
            </td>
            <td>
                <span ng-hide="vm.isEditMode" ng-bind="sinkFundAllocation.comment"></span>
                <input type="text" ng-show="vm.isEditMode" ng-model="sinkFundAllocation.comment"></input>
            </td>
            <td>
                {{ sinkFundAllocation.status }}
            </td>
            <td>
                <span ng-show="vm.isEditMode">
                    <span ng-hide="sinkFundAllocation.deleted"
                          ng-click="vm.markForDeletion(sinkFundAllocation, true)"
                          class="text-danger pull-right pointer">
                        <ec-icon type="trash" tooltip="Delete"></ec-icon>
                    </span>
                    <span ng-show="sinkFundAllocation.deleted"
                          ng-click="vm.markForDeletion(sinkFundAllocation, false)"
                          class="text-success pull-right pointer">
                        <ec-icon type="refresh" tooltip="Undo Delete"></ec-icon>
                    </span>

                    <span ng-show="sinkFundAllocation.status === 'open'"
                          ng-click="vm.markForClosing(sinkFundAllocation)"
                          class="text-warning pull-right pointer">
                        <ec-icon type="remove" tooltip="Close"></ec-icon>
                        &nbsp;
                    </span>
                    <span ng-show="sinkFundAllocation.status === 'closed'"
                          ng-click="vm.markForOpening(sinkFundAllocation)"
                          class="text-warning pull-right pointer">
                        <ec-icon type="folder-open" tooltip="Open"></ec-icon>
                        &nbsp;
                    </span>
                </span>
            </td>
        </tr>
        <tr class="category-action">
            <td colspan="6" ng-show="vm.isEditMode">
                <button class="btn btn-primary" ng-click="vm.addNewSinkFundAllocation()">
                    Add Sink Fund Allocation
                </button>
            </td>
        </tr>
    </tbody>
    </table>

    <div class="row">
        <div class="col-sm-6">
            <span ng-hide="vm.isEditMode">
                <button class="btn btn-primary"
                        ng-click="vm.switchToEditMode()">
                    Make Changes
                </button>
                &nbsp; &nbsp;
                <button class="btn btn-default"
                        ng-click="vm.state.go('sink-funds')">
                    Back to List
                </button>
                &nbsp; &nbsp;
                <button class="btn btn-default"
                    ng-click="vm.state.go('transactions', { bank_account: vm.sinkFund.id })">
                    View Transactions
                </button>
            </span>
        </div>
        <div class="col-sm-6">
            <div class="pull-right" ng-show="vm.isEditMode">
                <button class="btn btn-success"
                        ng-click="vm.saveChanges()">
                    Save Changes
                </button>
                &nbsp;
                &nbsp;
                <button class="btn btn-danger"
                        ng-click="vm.cancelEdit()">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</ec-panel>
