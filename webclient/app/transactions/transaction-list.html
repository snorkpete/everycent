
<div class="row">
    <div class="col-xs-12">
        <h2>Transactions</h2>
    </div>
</div>

<div class="row">
    <div class="col-xs-12">
        <form class="form-horizontal" novalidate name="vm.searchForm"
            ng-submit="vm.refreshTransactions(vm.search)">
            <ec-panel type="primary" title="Select Transactions to View">

                <ec-form-field label="Bank Account" label-width="2"
                               name="bank_account_id"
                               error="vm.searchForm.bank_account_id.$error"
                               field-width="6"
                               type="select"
                               list-of="bank_accounts"
                               ng-required="true"
                               ng-model="vm.search.bank_account_id">
                </ec-form-field>

                <ec-form-field label="Budget" label-width="2"
                               name="budget_id"
                               error="vm.searchForm.budget_id.$error"
                               field-width="6"
                               type="select"
                               list-of="budgets"
                               ng-required="true"
                               ng-model="vm.search.budget_id">
                </ec-form-field>

                <div class="form-group">
                    <div class="col-xs-offset-2 col-xs-2">
                      <button type="submit" class="btn btn-primary">Refresh</button>
                    </div>
                </div>
            </ec-panel>
        </form>
    </div>
</div>

<ec-transaction-loader transactions="vm.transactions"></ec-transaction-loader>

<div class="row">
    <div class="col-xs-12">
        <div style="overflow-y:scroll; position:relative; z-index:9;">
            <table class="table table-bordered clear-background rounded">
            <thead>
                <tr class="heading">
                    <th style="width:20%;">Date</th>
                    <th style="width: 5%;">Ref#</th>
                    <th style="width:25%;">Description</th>
                    <th style="width:15%;">Payee</th>
                    <th style="width:15%;">Allocation</th>
                    <th style="width:5%;">Withdrawn</th>
                    <th style="width:5%;">Deposited</th>
                    <th style="width:10%;"></th>
                </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
        </div>
        <div style="max-height:400px; overflow-y:scroll; position:relative; top:-38px;">
            <table class="table table-bordered clear-background rounded">
            <thead>
                <tr class="heading">
                    <th style="width:20%;"></th>
                    <th style="width: 5%;"></th>
                    <th style="width:25%;"></th>
                    <th style="width:15%;"></th>
                    <th style="width:15%;"></th>
                    <th style="width:5%;"></th>
                    <th style="width:5%;"></th>
                    <th style="width:10%;"></th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="transaction in vm.transactions" ng-class="{ danger: transaction.deleted }">

                    <!-- transaction date -->
                    <td>
                        <input ng-show="transaction.isEditMode" type="date" ng-model="transaction.transaction_date" ec-as-date></input>
                        <span ng-hide="transaction.isEditMode" ng-bind="transaction.transaction_date | date:'fullDate'"></span>
                    </td>

                    <!-- bank_ref -->
                    <td>
                        <input ng-show="transaction.isEditMode" type="text" ng-model="transaction.bank_ref" ></input>
                        <span ng-hide="transaction.isEditMode" ng-bind="transaction.bank_ref"></span>
                    </td>

                    <!-- description -->
                    <td>
                        <input ng-show="transaction.isEditMode" type="text" ng-model="transaction.description" ></input>
                        <span ng-hide="transaction.isEditMode" ng-bind="transaction.description"></span>
                    </td>

                    <!-- payee -->
                    <td>
                        <select ng-show="transaction.isEditMode"
                                ng-model="transaction.payee_id"
                                ng-change="vm.ref.updateReferenceId(transaction, 'payee')"
                                ng-options="payee.name for payee in vm.payees track by payee.id">
                        </select>
                        <span ng-hide="transaction.isEditMode" ng-bind="transaction.payee.name"></span>
                    </td>

                    <!-- allocation -->
                    <td>
                        <select ng-show="transaction.isEditMode"
                                ng-model="transaction.allocation_id"
                                ng-change="vm.ref.updateReferenceId(transaction, 'allocation')"
                                ng-options="allocation.name group by allocation.allocation_category for allocation in vm.allocations track by allocation.id">
                        </select>
                        <span ng-hide="transaction.isEditMode" ng-bind="transaction.allocation.name"></span>
                    </td>

                    <!-- withdrawal amount -->
                    <td class="text-right">
                        <input ng-show="transaction.isEditMode" type="number" ng-model="transaction.withdrawal_amount" ec-as-dollars></input>
                        <span ng-hide="transaction.isEditMode" ng-bind="transaction.withdrawal_amount | ecToDollars"></span>
                    </td>

                    <!-- deposit amount -->
                    <td class="text-right">
                        <input ng-show="transaction.isEditMode" type="number" ng-model="transaction.deposit_amount" ec-as-dollars></input>
                        <span ng-hide="transaction.isEditMode" ng-bind="transaction.deposit_amount | ecToDollars"></span>
                    </td>

                    <td>
                        <span ng-hide="transaction.isEditMode" ng-click="vm.editTransaction(transaction)"
                              class="text-warning pull-right pointer">
                            <ec-icon type="edit"></ec-icon>
                            &nbsp;
                            Edit
                            &nbsp; &nbsp; &nbsp;
                        </span>

                        <span ng-show="transaction.isEditMode">

                            <span ng-hide="vm.allocation.deleted"
                                  ng-click="vm.markForDeletion(transaction, true)"
                                  class="text-danger pull-right pointer">
                                <ec-icon type="trash"></ec-icon>
                            </span>
                            <span ng-show="vm.allocation.deleted"
                                  ng-click="vm.markForDeletion(transaction, false)"
                                  class="text-success pull-right pointer">
                                <ec-icon type="refresh"></ec-icon>
                            </span>

                            <span ng-click="vm.finishEdit(transaction)"
                                  class="text-warning pull-right pointer">
                                <ec-icon type="thumbs-up"></ec-icon>
                                &nbsp;
                                Done
                                &nbsp; &nbsp; &nbsp;
                            </span>
                        </span>
                    </td>

                </tr>
            </tbody>
            </table>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xs-1">
        <button class="btn btn-primary"
                ng-click="vm.addTransaction()">
            Add Transaction
        </button>
    </div>
</div>

<br/>
<div class="row">
    <div class="col-xs-12">
        <span class="pull-right">
            <button class="btn btn-success"
                    ng-click="vm.saveChanges()">
                Save Changes
            </button>

            &nbsp; &nbsp; &nbsp;

            <button class="btn btn-danger"
                    ng-click="vm.cancelEdit()">
                Cancel
            </button>
        </span>
    </div>
</div>

<br/>
